<?php
	session_start();
	include("configurarIdiomaJS.php");
	include("conexionBD.php");
	
	$consulta="SELECT idTipoTelefono,tipoTelefono FROM 1006_tipoTelefono";
	$arrTelefonosCParticipante=$con->obtenerFilasArreglo($consulta);
	
	$consulta="SELECT id__378_tablaDinamica,nacionalidad FROM _378_tablaDinamica WHERE id__378_tablaDinamica<>1 ORDER BY nacionalidad";
	$arrNacionalidades=$con->obtenerFilasArreglo($consulta);
	
	$listParteProcesal="";
	$consulta="SELECT id__5_tablaDinamica,
	if((SELECT nombreSingular FROM _5_aliasTiposFiguras WHERE idFigura=t.id__5_tablaDinamica AND materia='".$tipoMateria."') is null
			,nombreTipo,(SELECT nombreSingular FROM _5_aliasTiposFiguras WHERE idFigura=t.id__5_tablaDinamica AND materia='".$tipoMateria."')) as nombreTipo, naturalezaFigura
			 FROM _5_tablaDinamica t order by nombreTipo";
	$arrTipoFigura=$con->obtenerFilasArreglo($consulta);
	
	$arrParteProcesal="";
	
	$res=$con->obtenerFilas($consulta);
	while($filaFigura=mysql_fetch_row($res))
	{
		$consulta="SELECT idDetalle,etiquetaDetalle FROM _5_gDetallesTipo WHERE idReferencia=".$filaFigura[0];
		$arrDetalles=$con->obtenerFilasArreglo($consulta);
		$consulta="SELECT idOpcion FROM _5_tiposFiguras WHERE idPadre=".$filaFigura[0];
		$listFiguras=$con->obtenerListaValores($consulta);
		$o="['".$filaFigura[0]."','".cv($filaFigura[1])."',".$arrDetalles.",'".$listFiguras."','".$filaFigura[2]."']";
		if($arrParteProcesal=="")
			$arrParteProcesal=$o;
		else
			$arrParteProcesal.=",".$o;
		
		
	}
	
	$consulta="SELECT idGenero,genero FROM 1005_generoUsuario";
	$arrGeneroCP=$con->obtenerFilasArreglo($consulta);
	
	$consulta="SELECT id__31_tablaDinamica,estadoCivil FROM _31_tablaDinamica";
	$arrEstadoCivil=$con->obtenerFilasArreglo($consulta);
	
	$consulta="SELECT id__32_tablaDinamica,UPPER(tipoIdentificacion) FROM _32_tablaDinamica WHERE id__32_tablaDinamica NOT IN(19,9999,13,17) ORDER BY tipoIdentificacion";
	$arrTipoIdentificacion=$con->obtenerFilasArreglo($consulta);
	$consulta="SELECT cveEstado,estado FROM 820_estados ORDER BY estado";
	$arrEstadosCParticipante=$con->obtenerFilasArreglo($consulta);
	
	
	$consulta="SELECT id__857_tablaDinamica,medidaCautelar FROM _857_tablaDinamica WHERE tipoMedida=5 ORDER BY id__857_tablaDinamica";
	$arrGrupoEtnico=$con->obtenerFilasArreglo($consulta);
	
	$consulta="SELECT id__857_tablaDinamica,medidaCautelar FROM _857_tablaDinamica WHERE tipoMedida=6 ORDER BY id__857_tablaDinamica";
	$arrDiscapacidad=$con->obtenerFilasArreglo($consulta);
?>
var arrGrupoEtnico=<?php echo $arrGrupoEtnico?>;
var arrDiscapacidad=<?php echo $arrDiscapacidad?>;
var esBusquedaPersona=false;
var idPersonaEncontrada=-1;
var listPartes='-1';
var ajuste=0;
var arrTelefonosCParticipante=<?php echo $arrTelefonosCParticipante?>;
var arrEstadosCParticipante=<?php echo $arrEstadosCParticipante?>;
var arrTipoIdentificacionCP=<?php echo $arrTipoIdentificacion ?>;
var arrEstadoCivilCP=<?php echo $arrEstadoCivil?>;
var arrGeneroCP=<?php echo $arrGeneroCP?>;
var arrParteProcesalCP=[<?php echo $arrParteProcesal ?>];
var arrNacionalidadesCP=<?php echo $arrNacionalidades?>;

if(typeof(arrParteProcesal)=='undefined')
{
	arrParteProcesal=arrParteProcesalCP;
}

function agregarParticipanteVentana(tipoParticipante,nombreTipo,objConf)
{
	var posFila=existeValorMatriz(arrParteProcesal,tipoParticipante);
	var naturaleza=arrParteProcesal[posFila][4];

	esBusquedaPersona=false;
    idPersonaEncontrada=-1;
	ajuste=0;
	if(objConf)
    {
    	if(objConf.ocultaCURP)
        {
        	ajuste+=30;
        }
        
        if((objConf.ocultaRFC)&&(objConf.ocultaCedula))
        {
        	ajuste+=30;
        }
        
       /* if((objConf.ocultaCURP)&&(objConf.ocultaRFC)&&(objConf.ocultaCedula))
        {
        	ajuste+=10;
        }*/
        
        
    }

	var nTipo='';
	
   
    var cmbFiguraJuridica=crearComboExt('cmbFiguraJuridica',arrTipoFigura,200,15,150);  
    cmbFiguraJuridica.setValue(tipoParticipante);
    cmbFiguraJuridica.on('select',function(cmb,registro)
    								{
                                    	gEx('arbolSujetosRelacion').getRootNode().reload();
                                    }
    					)
    
    
	

	
	var cmbDetalle=crearComboExt('cmbDetalle',[],460,15,150);
   	cmbDetalle.hide();

	var cmbNacionalidad=crearComboExt('cmbNacionalidad',arrNacionalidadesCP,160,135,200);
    cmbNacionalidad.hide();
    
    cmbNacionalidad.on('select',function(cmb,registro)				
    							{
                                	if(registro.data.id=='77777')
                                    {
                                    	gEx('lblNacionalidadEspecifique').show();
                                        gEx('txtOtraNacionalidad').show();
                                    }
                                    else
                                    {
                                    	gEx('lblNacionalidadEspecifique').hide();
                                        gEx('txtOtraNacionalidad').hide();
                                        gEx('txtOtraNacionalidad').setValue('');
                                    }
                                }
    				)
    
    
	var cmbGenero=crearComboExt('cmbGenero',arrGeneroCP,95,195,130);
    var cmbEstadoCivil=crearComboExt('cmbEstadoCivil',arrEstadoCivilCP,95,225,160);
    cmbEstadoCivil.hide();
    
    var cmbIdentificacion=crearComboExt('cmbIdentificacion',arrTipoIdentificacionCP,200,75,180);
   	cmbIdentificacion.setValue(arrTipoIdentificacionCP[0][0]);
    cmbIdentificacion.on('select',function(cmb,registro)					
    								{
                                    	buscarPersona(gEx('txtEspecifique').getValue(),registro);
                                    }
    						)
                            
                            
	var cmbEstadoCParticipante=crearComboExt('cmbEstadoCParticipante',arrEstadosCParticipante,105,65,170);
    cmbEstadoCParticipante.on('select',obtenerMunicipiosCParticipante);
    var cmbMunicipioCParticipante=crearComboExt('cmbMunicipioCParticipante',[],425,65,180);                            
	var cmbGrupoEtnico=crearComboExt('cmbGrupoEtnico',arrGrupoEtnico,110,225,180);  
    var cmbDiscapacidad=crearComboExt('cmbDiscapacidad',arrDiscapacidad,460,225,180);  
    
    
    

    
                             
	var form = new Ext.form.FormPanel(	
										{
											baseCls: 'x-plain',
											layout:'absolute',
											defaultType: 'label',
											items: 	[
                                            			{
                                                        	xtype:'tabpanel',
                                                            x:0,
                                                            y:0,
                                                            id:'tblPersona',
                                                            border:true,
                                                            baseCls: 'x-plain',
                                                            width:665,
                                                            height:460,
                                                            activeTab:1,
                                                            items:	[
                                                            			{
                                                                        	xtype:'panel',
                                                                            defaultType: 'label',
                                                                            layout:'absolute',
                                                                            baseCls: 'x-plain',
                                                                            title:'Datos generales',
                                                                            items:	[
                                                                            			{
                                                                                            x:10,
                                                                                            y:20,
                                                                                            html:'Sujeto Procesal: <span style="color:#F00">*</span>'
                                                                                        },
                                                                                        cmbFiguraJuridica,
                                                                                        {
                                                                                        	x:375,
                                                                                            y:20,
                                                                                            hidden:!((tipoProceso=='6')&&(tipoParticipante=='7')),
                                                                                            html:'<span style="color:#F00">*</span>Accionante es la persona que vulnera los derechos'
                                                                                        },
                                                                                        cmbDetalle,
                                                                                        
                                                                                        {
                                                                                            x:10,
                                                                                            y:50,
                                                                                            html:'Tipo de persona:'
                                                                                        },
                                                                                        {
                                                                                            xtype:'radio',
                                                                                            x:200,
                                                                                            y:45,
                                                                                            id: 'tipoPersona_1',
                                                                                            name: 'tipoPersona',
                                                                                            inputValue: 1,
                                                                                            checked:true,
                                                                                            listeners:	{
                                                                                                            check:tipoPersonaCheckCP
                                                                                                        },
                                                                                            boxLabel: 'Natural'
                                                                                        }, 
                                                                                        {
                                                                                            xtype:'radio',
                                                                                            x:300,
                                                                                            y:45,
                                                                                            id: 'tipoPersona_2',
                                                                                            name: 'tipoPersona',
                                                                                            inputValue: 2,
                                                                                            listeners:	{
                                                                                                            check:tipoPersonaCheckCP
                                                                                                        },
                                                                                            boxLabel: 'Jur&iacute;dica'
                                                                                        },
                                                                                        {
                                                                                            x:10,
                                                                                            y:80,
                                                                                            id:'lblIdentificacion',
                                                                                            xtype:'label',
                                                                                            html:'Identificaci&oacute;n presentada: <span style="color:#F00">*</span>'
                            
                                                                                            
                                                                                        },
                                                                                        cmbIdentificacion,
                                                                                        {
                                                                                        	x:230,
                                                                                            y:75,
                                                                                            hidden:true,
                                                                                            id:'txtNIT',
                                                                                            xtype:'textfield',
                                                                                            width:150
                                                                                        },
                                                                                        {
                                                                                            x:400,
                                                                                            y:80,
                                                                                            id:'lblNoIdentificacion',
                                                                                            xtype:'label',
                                                                                            html:'No. de Identificaci&oacute;n: <span style="color:#F00">*</span>'
                            
                                                                                            
                                                                                        },
                                                                                        {
                                                                                            xtype:'textfield',
                                                                                            x:530,
                                                                                            y:75,
                                                                                            id:'txtEspecifique',
                                                                                            width:120,
                                                                                            enableKeyEvents :true,
                                                                                            listeners:	{
                                                                                                            keypress:function(txt,e)
                                                                                                                {

                                                                                                                    if(e.charCode=='46')
                                                                                                                    {
                                                                                                                    	e.stopEvent( );
                                                                                                                    	return;
                                                                                                                    }
                                                                                                                    if(e.charCode=='13')
                                                                                                                    {
                                                                                                                        if(txt.getValue()=='')
                                                                                                                            return;
                                                                                                                       
                                                                                                                        if(txt.ultimaBusqueda!=txt.getValue())
                                                                                                                        {
                                                                                                                        	txt.ultimaBusqueda=txt.getValue();
                                                                                                                            buscarPersona(txt.getValue(),cmbIdentificacion.getValue());
                                                                                                                        }
                                                                                                                    }
                                                                                                                },
                                                                                                            blur:function(txt)
                                                                                                                {
                                                                                                                    if(txt.getValue()=='')
                                                                                                                        return;
                                                                                                                    
                                                                                                                    if(txt.ultimaBusqueda!=txt.getValue())
                                                                                                                    {
                                                                                                                    	txt.ultimaBusqueda=txt.getValue();
                                                                                                                        buscarPersona(txt.getValue(),cmbIdentificacion.getValue());
                                                                                                                    }
                                                                                                                    
                                                                                                                }
                                                                                                        }
                                                                                        },
                                                                                        
                                                                                         {
                                                                                              x:10,
                                                                                              y:110,
                                                                                              id:'lblNacionalidad',
                                                                                              html:'Â¿Es de nacionalidad colombiana?:'
                                                                                          },
                                                                                          {
                                                                                              xtype:'radio',
                                                                                              checked:true,
                                                                                              name:'nacionalidad',
                                                                                              id: 'nacionalidad_1',
                                                                                              inputValue: 1,
                                                                                              x:200,
                                                                                              y:105,
                                                                                              listeners:	{
                                                                                                              check:tipoNacionalidadCheckCP
                                                                                                          },
                                                                                              boxLabel: 'S&iacute;'
                                                                                          }, 
                                                                                          {	
                                                                                              xtype:'radio',
                                                                                              name:'nacionalidad',
                                                                                              id: 'nacionalidad_0',
                                                                                              inputValue: 0,
                                                                                              x:300,
                                                                                              y:105,
                                                                                              listeners:	{
                                                                                                              check:tipoNacionalidadCheckCP
                                                                                                          },
                                                                                              boxLabel: 'No'
                                                                                          }, 
                                                                                          {
                                                                                              xtype:'radio',
                                                                                              name:'nacionalidad',
                                                                                              id: 'nacionalidad_2',
                                                                                              inputValue: 2,
                                                                                              x:380,
                                                                                              y:105,
                                                                                              listeners:	{
                                                                                                              check:tipoNacionalidadCheckCP
                                                                                                          },
                                                                                              boxLabel: 'Colombiana / Otro'
                                                                                          }, 
                                                                                          {
                                                                                              xtype:'radio',
                                                                                              name:'nacionalidad',
                                                                                              id: 'nacionalidad_3',
                                                                                              inputValue: 3,
                                                                                              x:520,
                                                                                              y:105,
                                                                                              listeners:	{
                                                                                                              check:tipoNacionalidadCheckCP
                                                                                                          },
                                                                                              boxLabel: 'No especificada'
                                                                                          },
                                                                                          {
                                                                                              x:10,
                                                                                              y:140,
                                                                                              hidden:true,
                                                                                              id:'lblNacionalidadIndique',
                                                                                              html:'Indique la nacionalidad:'
                                                                                          },
                                                                                          cmbNacionalidad,
                                                                                          {
                                                                                              x:380,
                                                                                              y:140,
                                                                                              hidden:true,
                                                                                              id:'lblNacionalidadEspecifique',
                                                                                              html:'Especifique:'
                                                                                          },
                                                                                          {
                                                                                              x:460,
                                                                                              y:135,
                                                                                              hidden:true,
                                                                                              width:190,
                                                                                              xtype:'textfield',
                                                                                              id:'txtOtraNacionalidad'
                                                                                          },
                                                                                        
                                                                                        	 {
                                                                                                  x:10,
                                                                                                  y:170,
                                                                                                  id:'lblNombre',
                                                                                                  html:'Nombre: <span style="color:#F00">*</span>'
                                                                                              },
                                                                                              {
                                                                                                  xtype:'textfield',
                                                                                                  width:130,
                                                                                                  id:'txtNombre',
                                                                                                  x:95,
                                                                                                  y:165
                                                                                              },
                                                                                              {
                                                                                                  x:10,
                                                                                                  y:110,
                                                                                                  hidden:true,
                                                                                                  id:'lblRazonSocial',
                                                                                                  html:'Raz&oacute;n Social: <span style="color:#F00">*</span>'
                                                                                              },
                                                                                              {
                                                                                                  xtype:'textfield',
                                                                                                  width:400,
                                                                                                  hidden:true,
                                                                                                  id:'txtRazonSocial',
                                                                                                  x:200,
                                                                                                  y:105
                                                                                              },
                                                                                              {
                                                                                                  x:255,
                                                                                                  y:170,
                                                                                                  id:'lblApPaterno',
                                                                                                  html:'Primer Apellido: <span style="color:#F00">*</span>'
                                                                                              },
                                                                                              {
                                                                                                  xtype:'textfield',
                                                                                                  width:95,
                                                                                                  id:'txtApPaterno',
                                                                                                  x:350,
                                                                                                  y:165
                                                                                              },
                                                                                              {
                                                                                                  x:460,
                                                                                                  y:170,
                                                                                                  id:'lblApMaterno',
                                                                                                  html:'Segundo Apellido:'
                                                                                              },
                                                                                              {
                                                                                                  xtype:'textfield',
                                                                                                  width:95,
                                                                                                  id:'txtApMaterno',
                                                                                                  x:565,
                                                                                                  y:165
                                                                                              },
                                                                                              {
                                                                                                  x:10,
                                                                                                  y:200,
                                                                                                  id:'lblGenero',
                                                                                                  html:'G&eacute;nero: <span style="color:#F00">*</span>'
                                                                                              },
                                                                                              cmbGenero,
                                                                                              {
                                                                                                  x:255,
                                                                                                  y:200,
                                                                                                  id:'lblFechaNac',
                                                                                                  html:'Fecha Nac.:'
                                                                                              },
                                                                                              {
                                                                                                  x:350,
                                                                                                  y:195,
                                                                                                  width:95,
                                                                                                  xtype:'datefield',
                                                                                                  id:'fechaNacimiento',
                                                                                                  maxValue:'<?php echo date("Y-m-d")?>',
                                                                                                  listeners:	{
                                                                                                                  change:function(dte)
                                                                                                                          {
                                                                                                                              var edad=calcularEdadParticipante(dte.getValue());
                                                                                                                              gEx('txtEdad').setValue(edad);
                                                                                                                          }
                                                                                                              }
                                                                                              },
                                                                                              {
                                                                                                  x:460,
                                                                                                  y:200,
                                                                                                  id:'lblEdad',
                                                                                                  html:'Edad:'
                                                                                              },
                                                                                              {
                                                                                                  xtype:'numberfield',
                                                                                                  width:60,
                                                                                                  x:565,
                                                                                                  y:195,
                                                                                                  id:'txtEdad'
                                                                                              },
                                                                                              {
                                                                                                  x:10,
                                                                                                  y:230,
                                                                                                  id:'lblGrupoEtnico',
                                                                                                  html:'Grupo &Eacute;tnico:'
                                                                                              },
                                                                                              cmbGrupoEtnico,
                                                                                              {
                                                                                                  x:350,
                                                                                                  y:230,
                                                                                                  id:'lblDiscapacidad',
                                                                                                  html:'Discapacidad:'
                                                                                              },
                                                                                              cmbDiscapacidad,
                                                                                              {
                                                                                                    x:10,
                                                                                                    y:260,
                                                                                                    id:'lblCorreoElectronico',
                                                                                                    xtype:'label',
                                                                                                    html:'Correo Electr&oacute;nico de Contacto: <span style="color:#F00">*</span>'
                                    
                                                                                                    
                                                                                                },
                                                                                                {
                                                                                                    x:200,
                                                                                                    y:255,
                                                                                                    xtype:'textfield',
                                                                                                    width:350,
                                                                                                    id:'txtMail1',
                                                                                                     listeners:	{
                                                                                                                    keypress:function(txt,e)
                                                                                                                        {
        
                                                                                                                            if(e.charCode=='46')
                                                                                                                            {
                                                                                                                                e.stopEvent( );
                                                                                                                                return;
                                                                                                                            }
                                                                                                                            if(e.charCode=='13')
                                                                                                                            {
                                                                                                                                if(txt.getValue()=='')
                                                                                                                                    return;
                                                                                                                               
                                                                                                                                if(txt.ultimaBusqueda!=txt.getValue())
                                                                                                                                {
                                                                                                                                    txt.ultimaBusqueda=txt.getValue();
                                                                                                                                    buscarPersona(txt.getValue(),0);
                                                                                                                                }
                                                                                                                            }
                                                                                                                        },
                                                                                                                    blur:function(txt)
                                                                                                                        {
                                                                                                                            if(txt.getValue()=='')
                                                                                                                                return;
                                                                                                                            
                                                                                                                            if(txt.ultimaBusqueda!=txt.getValue())
                                                                                                                            {
                                                                                                                                txt.ultimaBusqueda=txt.getValue();
                                                                                                                                buscarPersona(txt.getValue(),0);
                                                                                                                            }
                                                                                                                            
                                                                                                                        }
                                                                                                                }
                                                                                                },
                                                                                                {
                                                                                                    x:10,
                                                                                                    y:290,
                                                                                                    xtype:'label',
                                                                                                    id:'lblCorreoElectronico2',
                                                                                                    html:'Confirme Correo Electr&oacute;nico: <span style="color:#F00">*</span>'
                                    
                                                                                                    
                                                                                                },
                                                                                                 {
                                                                                                    x:200,
                                                                                                    y:285,
                                                                                                    xtype:'textfield',
                                                                                                    width:350,
                                                                                                    id:'txtMail2'
                                                                                                },
                                                                                              
																								{
                                                                                                    x:10,
                                                                                                    y:320,
                                                                                                    hidden:naturaleza=='D',
                                                                                                    id:'lblAceptaNotificacion',
                                                                                                    xtype:'label',
                                                                                                    html:'Â¿Acepta la Notificaci&oacute;n por Correo Electr&oacute;nico?: <span style="color:#F00">*</span>'
                                    
                                                                                                    
                                                                                                },                                                                                              
                                                                                              	 {
                                                                                                      xtype:'radio',
                                                                                                      checked:true,
                                                                                                      hidden:naturaleza=='D',
                                                                                                      name:'aceptaNotificacion',
                                                                                                      id: 'aceptaNotificacion_1',
                                                                                                      inputValue: 1,
                                                                                                      x:300,
                                                                                                      y:315,
                                                                                                      listeners:	{
                                                                                                                      //check:tipoNacionalidadCheckCP
                                                                                                                  	},
                                                                                                      boxLabel: 'S&iacute;'
                                                                                                  }, 
                                                                                                  {	
                                                                                                      xtype:'radio',
                                                                                                      hidden:naturaleza=='D',
                                                                                                      name:'aceptaNotificacion',
                                                                                                      id: 'aceptaNotificacion_0',
                                                                                                      inputValue: 0,
                                                                                                      x:380,
                                                                                                      y:315,
                                                                                                      listeners:	{
                                                                                                                      //check:tipoNacionalidadCheckCP
                                                                                                                  	},
                                                                                                      boxLabel: 'No'
                                                                                                  }, 
                                                                                              	{
                                                                                                    x:10,
                                                                                                    y:345,
                                                                                                    hidden:naturaleza=='D',
                                                                                                    id:'lblCorreoLeyenda',
                                                                                                    xtype:'label',
                                                                                                    html:'<span style="color:#F00">*</span> Al aceptar, implica recibir la informaci&oacute;n por correo electr&oacute;nico y realizar las actuaciones en la plataformas SIUGJ'
                                    
                                                                                                    
                                                                                                }, 
                                                                                              {
                                                                                                  x:10,
                                                                                                  y:230,
                                                                                                  hidden:true,
                                                                                                  id:'lblEdoCivil',
                                                                                                  html:'Estado civil:'
                                                                                              },
                                                                                              cmbEstadoCivil
                                                                                        
                                                                                        
                                                                            			
                                                                                        
                                                                            		]
                                                                        },
                                                                        
                                                                        {
                                                                        	xtype:'panel',
                                                                            defaultType: 'label',
                                                                            layout:'absolute',
                                                                            baseCls: 'x-plain',
                                                                            title:'Datos de contacto',
                                                                            items:	[
                                                                            			{
                                                                                            x:10,
                                                                                            y:10,
                                                                                            id:'lblDireccion',
                                                                                            html:'Direcci&oacute;n:'
                                                                                        },
                                                                                        {
                                                                                            x:105,
                                                                                            y:5,
                                                                                            xtype:'textfield',
                                                                                            width:410,
                                                                                            id:'txtCalleCParticipante'
                                                                                        },
                                                                                        {
                                                                                            x:500,
                                                                                            y:10,
                                                                                            hidden:true,
                                                                                            html:'No. Ext:'
                                                                                        },
                                                                                        {
                                                                                            x:560,
                                                                                            y:5,
                                                                                            xtype:'textfield',
                                                                                            width:95,hidden:true,
                                                                                            id:'txtNoExtCParticipante'
                                                                                        },
                                                                                        {
                                                                                            x:10,
                                                                                            y:40,
                                                                                            hidden:true,
                                                                                            html:'No. Int:'
                                                                                        },
                                                                                        {
                                                                                            x:70,
                                                                                            y:35,
                                                                                            xtype:'textfield',
                                                                                            width:120,
                                                                                            hidden:true,
                                                                                            id:'txtNoIntCParticipante'
                                                                                        },
                                                                                        {
                                                                                            x:10,
                                                                                            y:40,
                                                                                            hidden:true,
                                                                                            html:'Barrio:'
                                                                                        },
                                                                                        {
                                                                                            x:105,
                                                                                            y:35,
                                                                                            xtype:'textfield',
                                                                                            width:160,
                                                                                            hidden:true,
                                                                                            id:'txtColoniaCParticipante'
                                                                                        },
                                                                                        {
                                                                                            x:10,
                                                                                            y:40,
                                                                                            html:'C&oacute;digo Postal:'
                                                                                        },
                                                                                        {
                                                                                            x:105,
                                                                                            y:35,
                                                                                            xtype:'textfield',
                                                                                            width:95,
                                                                                            id:'txtCPCParticipante'
                                                                                        },
                                                                                        {
                                                                                            x:10,
                                                                                            y:70,
                                                                                            html:'Departamento:'
                                                                                        },
                                                                                        cmbEstadoCParticipante,
                                                                                        
                                                                                        {
                                                                                            x:355,
                                                                                            y:70,
                                                                                            html:'Ciudad:'
                                                                                        },
                                                                                       cmbMunicipioCParticipante,
                                                                                        {
                                                                                            x:10,
                                                                                            y:100,
                                                                                            hidden:true,
                                                                                            html:'Localidad:'
                                                                                        },
                                                                                        {
                                                                                            x:105,
                                                                                            y:95,
                                                                                            xtype:'textfield',
                                                                                            width:230,
                                                                                             hidden:true,
                                                                                            id:'txtLocalidadCParticipante'
                                                                                        },
                                                                                        {
                                                                                            x:10,
                                                                                            y:100,
                                                                                            html:'Entre la calle:'
                                                                                        },
                                                                                        {
                                                                                            x:105,
                                                                                            y:95,
                                                                                            xtype:'textfield',
                                                                                            width:230,
                                                                                            id:'txtEntreCalleCParticipante'
                                                                                        },
                                                                                        {
                                                                                            x:355,
                                                                                            y:100,
                                                                                            html:'y la calle:'
                                                                                        },
                                                                                        {
                                                                                            x:430,
                                                                                            y:95,
                                                                                            xtype:'textfield',
                                                                                            width:230,
                                                                                            id:'txtYCalleCParticipante'
                                                                                        },
                                                                                        {
                                                                                            x:10,
                                                                                            y:130,
                                                                                            html:'Otras referencias:'
                                                                                        },
                                                                                        {
                                                                                            x:130,
                                                                                            y:125,
                                                                                            xtype:'textarea',
                                                                                            width:530,
                                                                                            height:35,
                                                                                            
                                                                                            id:'txtReferenciasCParticipante'
                                                                                        },
                                                                                        crearGridTelefonoCParticipante()
                                                                                    	
                                                                            		]
                                                                        }
                                                            		]
                                                        },
                                                        crearArbolSujetosProcesalesRelacion((objConf && objConf.idActividad)?objConf.idActividad:-1,(objConf && objConf.idParticipante)?objConf.idParticipante:-1)
                                            			
                                                        
                                                        
													]
										}
									);
	
	var ventanaAM = new Ext.Window(
									{
                                    	id:'vParticipante',
										title: 'Agregar Sujeto Procesal',
										width: 940,
										height:460,
										layout: 'fit',
										plain:true,
										modal:true,
										bodyStyle:'padding:5px;',
										buttonAlign:'center',
										items: form,
										listeners : {
													show : {
																buffer : 10,
																fn : function() 
																{
                                                                	gEx('tblPersona').setActiveTab(0);
                                                                    
                                                                    buscarPartesAsociar();
                                                                     
                                                                   	if((tipoProceso=='6')&&(tipoParticipante=='7'))
                                                                    {

                                                                        gEx('lblDireccion').setText('Direcci&oacute;n del domicilio del accionante:',false);
                                                                        gEx('txtCalleCParticipante').setPosition(225,5);
                                                                        gEx('txtCalleCParticipante').setWidth(400);
                                                                    }
                                                                    else
                                                                    {
                                                                    	gEx('lblDireccion').setText('Direcci&oacute;n:',false);
                                                                        gEx('txtCalleCParticipante').setPosition(105,5);
                                                                        gEx('txtCalleCParticipante').setWidth(410);
                                                                    }
																}
															}
												},
										buttons:	[
														{
															
															text: '<?php echo $etj["lblBtnAceptar"]?>',                                                            
															handler: function()
																	{

                                                                    	if(esBusquedaPersona)
                                                                        {
                                                                        	
                                                                            function funcAjax()
                                                                            {
                                                                                var resp=peticion_http.responseText;
                                                                                arrResp=resp.split('|');
                                                                                if(arrResp[0]=='1')
                                                                                {
                                                                                    recargarGridParticipantes();
                                                                                    ventanaAM.close();
                                                                                }
                                                                                else
                                                                                {
                                                                                    msgBox('<?php echo $etj["errOperacion"]?>'+' <br />'+arrResp[0]);
                                                                                }
                                                                            }
                                                                            obtenerDatosWeb('../modulosEspeciales_SIUGJ/paginasFunciones/funcionesModuloRegistroPartes.php',funcAjax, 'POST','funcion=3&iF='+cmbFiguraJuridica.getValue()+'&iA='+objConf.idActividad+'&iP='+idPersonaEncontrada,true);
                                                                        	
                                                                        	return;
                                                                        }

                                                                    	var campoComp='';
                                                                        if(objConf && objConf.idParticipante)
                                                                        {
                                                                        	campoComp=',"idPersona":"'+objConf.idParticipante+'"';
                                                                        }
                                                                    	if(cmbDetalle.getStore().getCount()>0)
                                                                        {
                                                                        	if(cmbDetalle.getValue()=='')
                                                                            {
                                                                                function resp301()
                                                                                {
                                                                                    cmbDetalle.focus();
                                                                                }
                                                                                msgBox('Debe indicar el "tipo" del participante a agregar',resp301);
                                                                                return;
                                                                            }
                                                                            
                                                                        }
                                                                    	var listaRelacion='';
                                                                        var arrNodos=obtenerNodoChecados(gEx('arbolSujetosRelacion').getRootNode());
                                                                        var x;
                                                                        for(x=0;x<arrNodos.length;x++)
                                                                        {
                                                                        	if(listaRelacion=='')
                                                                            {
                                                                            	listaRelacion=arrNodos[x].attributes.idPersona;
                                                                            }
                                                                            else
                                                                            {
                                                                            	listaRelacion+=','+arrNodos[x].attributes.idPersona;
                                                                            }
                                                                        }
                                                                    	var personaMoral=gEx('tipoPersona_2').getValue();

																		var cadObj='';
                                                                        if(personaMoral)
                                                                        {
                                                                        	
                                                                            
                                                                        	if(gEx('txtRazonSocial').getValue()=='')
                                                                            {
                                                                                function resp30()
                                                                                {
                                                                                    gEx('txtRazonSocial').focus();
                                                                                }
                                                                                msgBox('Debe indicar la raz&oacute;n social de la persona moral',resp30);
                                                                                return;
                                                                            }
                                                                            
                                                                            var aceptaNotificacionMail='0';
                                                                            if(gEx('aceptaNotificacion_1').getValue())
                                                                            {
                                                                            	aceptaNotificacionMail='1';
                                                                            }
                                                                            
                                                                            
                                                                           cadObj='{"grupoEtnico":"'+cmbGrupoEtnico.getValue()+'","discapacidad":"'+cmbDiscapacidad.getValue()+
                                                                           			'","aceptaNotificacionMail":"'+aceptaNotificacionMail+'","rfc":"'+cv(gEx('txtNIT').getValue())+
                                                                                    '","datosContacto":@datosContacto,"detallePersona":"'+cmbDetalle.getValue()+
                                                                            		'","tipoPersona":"2","nombre":"'+cv(gEx('txtRazonSocial').getValue())+
                                                                                    '","apPaterno":"","apMaterno":"","genero":"2","otraNacionalidad":"","nacionalidadMexicana":"3",'+
                                                                                    '"nacionalidad":"","alias":[],"tipoFigura":"'+cmbFiguraJuridica.getValue()+
                                                                                    '","curp":"","cedulaProfesional":"","fechaNacimiento":"'+
                                                                                    (gEx('fechaNacimiento').getValue()==''?'':gEx('fechaNacimiento').getValue().format('Y-m-d'))+
                                                                                    '","edad":"'+gEx('txtEdad').getValue()+'","estadoCivil":"'+gEx('cmbEstadoCivil').getValue()+
                                                                                    '","identificacionPresentada":"'+gEx('cmbIdentificacion').getValue()+'","otraIdentificacion":"'+
                                                                                    cv(gEx('txtEspecifique').getValue())+'","relacionadoCon":"'+listaRelacion+'"'+
                                                                                    ',"idActividad":"'+objConf.idActividad+'","idCarpeta":"'+objConf.idCarpeta+'"'+campoComp+'}';
                                                                        }
                                                                        else
                                                                        {
                                                                            if(gEx('nacionalidad_0').getValue() || gEx('nacionalidad_2').getValue())
                                                                            {
                                                                            	if(gEx('cmbNacionalidad').getValue()=='')
                                                                                {
                                                                                	function resp1()
                                                                                    {
                                                                                    	gEx('cmbNacionalidad').focus();
                                                                                    }
                                                                                    msgBox('Debe indicar la nacionalidad de la persona f&iacute;sica',resp1);
                                                                                	return;
                                                                                }
                                                                                
                                                                                if(gEx('cmbNacionalidad').getValue()=='77777')
                                                                                {
                                                                                	if(gEx('txtOtraNacionalidad').getValue()=='')
                                                                                    {
                                                                                    	function resp2()
                                                                                        {
                                                                                            gEx('txtOtraNacionalidad').focus();
                                                                                        }
                                                                                        msgBox('Debe indicar la nacionalidad de la persona f&iacute;sica',resp2);
                                                                                        return;
                                                                                    }
                                                                                }
                                                                            }
                                                                            
                                                                            if(gEx('txtEspecifique').getValue()=='')
                                                                            {
                                                                                function resp300()
                                                                                {
                                                                                    gEx('txtEspecifique').focus();
                                                                                }
                                                                                msgBox('Debe indicar el n&uacute;mero de identificaci&oacute;n',resp300);
                                                                                return;
                                                                            }
                                                                            
                                                                            if(gEx('txtNombre').getValue()=='')
                                                                            {
                                                                                function resp3()
                                                                                {
                                                                                    gEx('txtNombre').focus();
                                                                                }
                                                                                msgBox('Debe indicar el nombre de la persona f&iacute;sica',resp3);
                                                                                return;
                                                                            }
                                                                            
                                                                            if(gEx('txtApPaterno').getValue()=='')
                                                                            {
                                                                                function resp3AP()
                                                                                {
                                                                                    gEx('txtApPaterno').focus();
                                                                                }
                                                                                msgBox('Debe indicar el primer apellido de la persona f&iacute;sica',resp3AP);
                                                                                return;
                                                                            }
                                                                            
                                                                            if(gEx('cmbGenero').getValue()=='')
                                                                            {
                                                                                function resp4()
                                                                                {
                                                                                    gEx('cmbGenero').focus();
                                                                                }
                                                                                msgBox('Debe indicar el g&eacute;nero de la persona f&iacute;sica',resp4);
                                                                                return;
                                                                            }
                                                                            
                                                                            
                                                                            
                                                                            var fila;
                                                                            var gAlias=gEx('gAlias');
                                                                            var arrAlias='';
                                                                            var x=0;
                                                                            var o;
                                                                           
                                                                            var nacionalidadMexicana='';
                                                                            
                                                                            if(gEx('nacionalidad_0').getValue())
                                                                            {
                                                                            	nacionalidadMexicana=0;
                                                                            }
                                                                            
                                                                            if(gEx('nacionalidad_1').getValue())
                                                                            {
                                                                            	nacionalidadMexicana=1;
                                                                            }
                                                                            
                                                                            if(gEx('nacionalidad_2').getValue())
                                                                            {
                                                                            	nacionalidadMexicana=2;
                                                                            }
                                                                            
                                                                            if(gEx('nacionalidad_3').getValue())
                                                                            {
                                                                            	nacionalidadMexicana=3;
                                                                            }
                                                                            
                                                                            var aceptaNotificacionMail='0';
                                                                            if(gEx('aceptaNotificacion_1').getValue())
                                                                            {
                                                                            	aceptaNotificacionMail='1';
                                                                            }
                                                                            
                                                                           
                                                                            
                                                                        	cadObj='{"grupoEtnico":"'+cmbGrupoEtnico.getValue()+'","discapacidad":"'+cmbDiscapacidad.getValue()+
                                                                           			'","aceptaNotificacionMail":"'+aceptaNotificacionMail+'","rfc":"'+cv(gEx('txtNIT').getValue())+
                                                                                    '","datosContacto":@datosContacto,"tipoPersona":"1","nombre":"'+cv(gEx('txtNombre').getValue())+'","apPaterno":"'+cv(gEx('txtApPaterno').getValue())+
                                                                            		'","apMaterno":"'+cv(gEx('txtApMaterno').getValue())+'","nacionalidadMexicana":"'+nacionalidadMexicana+
                                                                                    '","nacionalidad":"'+gEx('cmbNacionalidad').getValue()+'","otraNacionalidad":"'+cv(gEx('txtOtraNacionalidad').getValue())+
                                                                                    '","genero":"'+gEx('cmbGenero').getValue()+'","alias":[],"detallePersona":"'+cmbDetalle.getValue()+
                                                                                    '","tipoFigura":"'+cmbFiguraJuridica.getValue()+
                                                                                    '","curp":"","cedulaProfesional":"","fechaNacimiento":"'+
                                                                                    (gEx('fechaNacimiento').getValue()==''?'':gEx('fechaNacimiento').getValue().format('Y-m-d'))+
                                                                                    '","edad":"'+gEx('txtEdad').getValue()+'","estadoCivil":"'+gEx('cmbEstadoCivil').getValue()+
                                                                                    '","identificacionPresentada":"'+gEx('cmbIdentificacion').getValue()+'","otraIdentificacion":"'+
                                                                                    cv(gEx('txtEspecifique').getValue())+'","relacionadoCon":"'+listaRelacion+'"'+
                                                                                    ',"idActividad":"'+objConf.idActividad+'","idCarpeta":"'+objConf.idCarpeta+'"'+campoComp+'}';
                                                                        }
                                                                        
                                                                        var txtMail1=gEx('txtMail1');
                                                                        var txtMail2=gEx('txtMail2');
                                                                        
                                                                        
                                                                        if(txtMail1.getValue()=='')
                                                                        {
                                                                        	function resp101()
                                                                            {
                                                                            	txtMail1.focus();
                                                                            }
                                                                            msgBox('Debe ingresar la direcci&oacute;n de correo electr&oacute;nico de contacto',resp101);
                                                                            return;
                                                                        }
                                                                        
                                                                        if(!validarCorreo(txtMail1.getValue()))
                                                                        {
                                                                        	function resp103()
                                                                            {
                                                                            	txtMail1.focus();
                                                                            }
                                                                            msgBox('La direcci&oacute;n de correo electr&oacute;nico de contacto ingresada NO es v&aacute;lida',resp103);
                                                                            return;
                                                                        }
                                                                        
                                                                        
                                                                        if(txtMail2.getValue()=='')
                                                                        {
                                                                        	function resp1012()
                                                                            {
                                                                            	txtMail2.focus();
                                                                            }
                                                                            msgBox('Debe ingresar la direcci&oacute;n de correo electr&oacute;nico de contacto (confirmaci&oacute;n)',resp1012);
                                                                            return;
                                                                        }
                                                                        
                                                                        if(!validarCorreo(txtMail2.getValue()))
                                                                        {
                                                                        	function resp1030()
                                                                            {
                                                                            	txtMail2.focus();
                                                                            }
                                                                            msgBox('La direcci&oacute;n de correo electr&oacute;nico de contacto ingresada NO es v&aacute;lida (confirmaci&oacute;n)',resp1030);
                                                                            return;
                                                                        }
                                                                        
                                                                        if(txtMail1.getValue()!=txtMail2.getValue())
                                                                        {
                                                                        	function resp102()
                                                                            {
                                                                            	txtMail2.focus();
                                                                            }
                                                                            msgBox('Las direcciones de correo electr&oacute;nico de contacto NO coinciden',resp102);
                                                                            return;
                                                                        }
                                                                        
                                                                        var txtCalle=gEx('txtCalleCParticipante');
                                                                        var txtNoExt=gEx('txtNoExtCParticipante');
                                                                        var txtNoInt=gEx('txtNoIntCParticipante');
                                                                        var txtColonia=gEx('txtColoniaCParticipante');
                                                                        var txtCP=gEx('txtCPCParticipante');
                                                                        var txtLocalidad=gEx('txtLocalidadCParticipante');
                                                                        var txtEntreCalle=gEx('txtEntreCalleCParticipante');
                                                                        var txtYCalle=gEx('txtYCalleCParticipante');
                                                                        var txtReferencias=gEx('txtReferenciasCParticipante');
                                                                        var cmbEstado=gEx('cmbEstadoCParticipante');
                                                                        var cmbMunicipio=gEx('cmbMunicipioCParticipante');
                                                                        
                                                                        var arrTelefonos='';
                                                                        
                                                                        var x;
                                                                        var fila;
                                                                        var o;
                                                                        for(x=0;x<gEx('gTelefonosCParticipante').getStore().getCount();x++)
                                                                        {
                                                                            fila=gEx('gTelefonosCParticipante').getStore().getAt(x);
                                                                            
                                                                            if(fila.data.numero=='')
                                                                            {
                                                                                function respTel()
                                                                                {
                                                                                	gEx('panelContactoCParticipante').setActiveTab(1);
                                                                                    gEx('gTelefonosCParticipante').startEditing(x,3);
                                                                                }
                                                                                msgBox('Debe ingresar el n&uacute;mero telef&oacute;nico a agregar',respTel);
                                                                                return;
                                                                            }
                                                                            
                                                                            o='{"tipoTelefono":"'+fila.data.tipoTelefono+'","lada":"'+fila.data.lada+
                                                                                '","numero":"'+fila.data.numero+'","extension":"'+fila.data.extension+'"}';
                                                                            if(arrTelefonos=='')
                                                                                arrTelefonos=o;
                                                                            else
                                                                                arrTelefonos+=','+o;
                                                                        }
                                                                        
                                                                        var cadObjAux='{"calle":"'+cv(txtCalle.getValue())+'","noExt":"'+cv(txtNoExt.getValue())+
                                                                                    '","noInt":"'+cv(txtNoInt.getValue())+'","colonia":"'+cv(txtColonia.getValue())+
                                                                                    '","cp":"'+cv(txtCP.getValue())+'","estado":"'+cmbEstado.getValue()+
                                                                                    '","municipio":"'+cmbMunicipio.getValue()+'","localidad":"'+cv(txtLocalidad.getValue())+
                                                                                    '","entreCalle":"'+cv(txtEntreCalle.getValue())+'","yCalle":"'+cv(txtYCalle.getValue())+
                                                                                    '","referencias":"'+cv(txtReferencias.getValue())+'","arrTelefonos":['+arrTelefonos+
                                                                                    '],"mail":[{"mail":"'+txtMail1.getValue()+'"}],"idRegistro":"-1","idFormulario":"-47"}';
                                                                        
                                                                        cadObj=cadObj.replace('@datosContacto',cadObjAux);
                                                                       
                                                                        var nFuncion='';
                                                                        if(objConf && objConf.idParticipante)
                                                                        {
                                                                        	nFuncion=32;
                                                                        }
                                                                        else
                                                                        {
                                                                            nFuncion=20;
                                                                        }
                                                                        
                                                                        
                                                                        function funcAjax()
                                                                        {
                                                                            var resp=peticion_http.responseText;
                                                                            arrResp=resp.split('|');
                                                                            if(arrResp[0]=='1')
                                                                            {
																				
                                                                                if(objConf && objConf.afterRegister)
                                                                                    objConf.afterRegister(arrResp[1],arrResp[2],tipoParticipante,arrResp[3]);
                                                                                ventanaAM.close();
                                                                            }
                                                                            else
                                                                            {
                                                                                msgBox('<?php echo $etj["errOperacion"]?>'+' <br />'+arrResp[0]);
                                                                            }
                                                                        }
                                                                        obtenerDatosWeb('../paginasFunciones/funcionesModulosEspeciales_Notificaciones.php',funcAjax, 'POST','funcion='+nFuncion+'&cadObj='+cadObj,true);
                                                                        
																	}
                                                                    
                                                                    
                                                                    
														},
														{
															text: '<?php echo $etj["lblBtnCancelar"]?>',
															handler:function()
																	{
																		ventanaAM.close();
																	}
														}
													]
									}
								);
                                
	ventanaAM.objConf=objConf;     
    ventanaAM.listPartes=listPartes;  
    ventanaAM.tipoParticipante=tipoParticipante;                         
    
    
    if(!objConf || !objConf.idParticipante)
    {
    	ventanaAM.show();	
    	
    }
    else
    {
    	
    	obtenerDatosIdentificacionVentana(objConf.idParticipante,tipoParticipante,ventanaAM,objConf);	
    }
}


function buscarPartesAsociar()
{
	listPartes='';
    var parteProcesal=gEx('cmbFiguraJuridica').getValue();
    pos=existeValorMatriz(arrParteProcesalCP,parteProcesal);
    
    var x;
    if(arrParteProcesalCP[pos][3]!='')
    {
        var aFiguras=arrParteProcesalCP[pos][3].split(',');
        for(x=0;x<aFiguras.length;x++)
        {
            if(listPartes=='')
                listPartes=aFiguras[x];
            else   
                listPartes+=','+aFiguras[x];
        }
    }
    if(listPartes=='')
    {
        listPartes='-1';
    }
    
   
    
    gEx('cmbDetalle').getStore().loadData(arrParteProcesalCP[pos][2]);
    if(gEx('cmbDetalle').getStore().getCount()==0)
        gEx('cmbDetalle').hide();
    else
        gEx('cmbDetalle').show();
    
    
}

function crearGridTelefonoCParticipante()
{
	var cmbTipoTelefonoCParticipante=crearComboExt('cmbTipoTelefonoCParticipante',arrTelefonosCParticipante);
	var dsDatos=[];
    var alDatos=	new Ext.data.SimpleStore	(
                                                    {
                                                        fields:	[
                                                                    {name: 'tipoTelefono'},
                                                                    {name: 'lada'},
                                                                    {name: 'numero'},
                                                                    {name: 'extension'}
                                                                ]
                                                    }
                                                );

    alDatos.loadData(dsDatos);
	var chkRow=new Ext.grid.CheckboxSelectionModel();
	
	var cModelo= new Ext.grid.ColumnModel   	(
												 	[
													 	
														chkRow,
														{
															header:'Tipo',
															width:100,
															sortable:true,
															dataIndex:'tipoTelefono',
                                                            editor:cmbTipoTelefonoCParticipante,
                                                            renderer:function(val)
                                                            		{
                                                                    	return formatearValorRenderer(arrTelefonosCParticipante,val);
                                                                    }
														},
														{
															header:'Lada',
															width:45,
                                                            hidden:true,
															sortable:true,
															dataIndex:'lada',
                                                            editor:	{
                                                            			xtype:'textfield'
                                                            		}
														},
                                                        {
															header:'N&uacute;mero',
															width:130,
															sortable:true,
															dataIndex:'numero',
                                                            editor:	{
                                                            			xtype:'numberfield',
                                                                        allowDecimals:false,
                                                                        allowNegative:false
                                                            		}
														},
                                                        {
															header:'Extensi&oacute;n',
															width:80,
															sortable:true,
															dataIndex:'extension',
                                                            editor:	{
                                                            			xtype:'numberfield',
                                                                        allowDecimals:false,
                                                                        allowNegative:false
                                                            		}
														}
													]
												);
                                                
	var tblGrid=	new Ext.grid.EditorGridPanel	(
                                                        {
                                                            id:'gTelefonosCParticipante',
                                                            store:alDatos,
                                                            frame:false,
                                                            border:true,
                                                            x:130,
                                                            y:175,
                                                            cm: cModelo,
                                                            stripeRows :true,
                                                            loadMask:true,
                                                            stripeRows :true,                                                            
                                                            columnLines : true,
                                                            height:145,
                                                            width:420,
                                                            sm:chkRow,
                                                            tbar:	[
                                                            			{
                                                                        	icon:'../images/add.png',
                                                                            cls:'x-btn-text-icon',
                                                                            text:'Agregar tel&eacute;fono',
                                                                            handler:function()
                                                                            		{
                                                                                    	var reg=crearRegistro	(
                                                                                        							[
                                                                                                                    	{name: 'tipoTelefono'},
                                                                                                                        {name: 'lada'},
                                                                                                                        {name: 'numero'},
                                                                                                                        {name: 'extension'}
                                                                                                                    ]
                                                                                        						)
                                                                                   		var r=new reg	(
                                                                                        					{
                                                                                                            	tipoTelefono:'1',
                                                                                                                lada:'',
                                                                                                                numero:'',
                                                                                                                extension:''
                                                                                                            }
                                                                                        				)
                                                                                   
                                                                                    	gEx('gTelefonosCParticipante').getStore().add(r);
                                                                                        gEx('gTelefonosCParticipante').startEditing(gEx('gTelefonosCParticipante').getStore().getCount()-1,1);
                                                                                    }
                                                                            
                                                                        },'-',
                                                                        {
                                                                        	icon:'../images/delete.png',
                                                                            cls:'x-btn-text-icon',
                                                                            text:'Remover tel&eacute;fono',
                                                                            handler:function()
                                                                            		{
                                                                                    	var fila=gEx('gTelefonosCParticipante').getSelectionModel().getSelected();
                                                                                        if(!fila)
                                                                                        {
                                                                                        	msgBox('Debe seleccionar el tel&eacute;fono a remover');
                                                                                        	return;
                                                                                        }
                                                                                        function resp(btn)
                                                                                        {
                                                                                        	if(btn=='yes')
                                                                                            {
                                                                                            	gEx('gTelefonosCParticipante').getStore().remove(fila);
                                                                                            }
                                                                                        }
                                                                                        msgConfirm('Est&aacute; seguro de querer remover el tel&eacute;fono seleccionado?',resp);
                                                                                       
                                                                                        
                                                                                    }
                                                                            
                                                                        }
                                                                        
                                                            		]
                                                        }
                                                    );
	return 	tblGrid;	
}

function crearGridMailCParticipante()
{
	
	var dsDatos=[];
    var alDatos=	new Ext.data.SimpleStore	(
                                                    {
                                                        fields:	[
                                                                    {name: 'mail'}
                                                                ]
                                                    }
                                                );

    alDatos.loadData(dsDatos);
	var chkRow=new Ext.grid.CheckboxSelectionModel();
	
	var cModelo= new Ext.grid.ColumnModel   	(
												 	[
													 	chkRow,
                                                        {
															header:'E-Mail',
															width:250,
															sortable:true,
															dataIndex:'mail',
                                                            editor:	{
                                                            			xtype:'textfield'
                                                            		}
														}
													]
												);
                                                
	var tblGrid=	new Ext.grid.EditorGridPanel	(
                                                        {
                                                            id:'gMailCParticipante',
                                                            store:alDatos,
                                                            frame:false,
                                                            border:true,
                                                            x:10,
                                                            y:150,
                                                            cm: cModelo,
                                                            stripeRows :true,
                                                            loadMask:true,
                                                            stripeRows :true,                                                            
                                                            columnLines : true,
                                                            height:145,
                                                            width:300,
                                                            sm:chkRow,
                                                            tbar:	[
                                                            			{
                                                                        	icon:'../images/add.png',
                                                                            cls:'x-btn-text-icon',
                                                                            text:'Agregar E-Mail',
                                                                            handler:function()
                                                                            		{
                                                                                    	var reg=crearRegistro	(
                                                                                        							[
                                                                                                                    	{name: 'mail'}
                                                                                                                    ]
                                                                                        						)
                                                                                   		var r=new reg	(
                                                                                        					{
                                                                                                            	mail:''
                                                                                                            }
                                                                                        				)
                                                                                   
                                                                                    	gEx('gMailCParticipante').getStore().add(r);
                                                                                        gEx('gMailCParticipante').startEditing(gEx('gMailCParticipante').getStore().getCount()-1,1);
                                                                                    }
                                                                            
                                                                        },'-',
                                                                        {
                                                                        	icon:'../images/delete.png',
                                                                            cls:'x-btn-text-icon',
                                                                            text:'Remover E-Mail',
                                                                            handler:function()
                                                                            		{
                                                                                    	var fila=gEx('gMailCParticipante').getSelectionModel().getSelected();
                                                                                        if(!fila)
                                                                                        {
                                                                                        	msgBox('Debe seleccionar la direcci&oacute;n de e-mail a remover');
                                                                                        	return;
                                                                                        }
                                                                                        
                                                                                        function resp(btn)
                                                                                        {
                                                                                        	if(btn=='yes')
                                                                                            {
                                                                                            	gEx('gMailCParticipante').getStore().remove(fila);
                                                                                            }
                                                                                        }
                                                                                        msgConfirm('Est&aacute; seguro de querer remover el e-mail seleccionado?',resp);
                                                                                       
                                                                                        
                                                                                    }
                                                                            
                                                                        }
                                                                        
                                                            		]
                                                        }
                                                    );
	return 	tblGrid;	
}

function crearGridAliasCP()
{
	var dsDatos=[];
    var alDatos=	new Ext.data.SimpleStore	(
                                                    {
                                                        fields:	[
                                                                    {name: 'nombre'},
                                                                    {name: 'apPaterno'},
                                                                    {name: 'apMaterno'}
                                                                ]
                                                    }
                                                );

    alDatos.loadData(dsDatos);
	var chkRow=new Ext.grid.CheckboxSelectionModel();
	
	var cModelo= new Ext.grid.ColumnModel   	(
												 	[
													 	chkRow,
														{
															header:'Nombre',
															width:220,
															sortable:true,
                                                            editor:	{xtype:'textfield'},
															dataIndex:'nombre'
														},
														{
															header:'Ap. Paterno',
															width:130,
															sortable:true,
                                                            editor:	{xtype:'textfield'},
															dataIndex:'apPaterno'
														},
														{
															header:'Ap. Materno',
															width:130,
															sortable:true,
                                                            editor:	{xtype:'textfield'},
															dataIndex:'apMaterno'
														}
													]
												);
                                                
	var tblGrid=	new Ext.grid.EditorGridPanel	(
                                                        {
                                                        	id:'gAlias',
                                                            store:alDatos,
                                                            frame:false,
                                                            title:'Registro de alias',
                                                            x:10,
                                                            y:190,
                                                            cm: cModelo,
                                                            stripeRows :true,
                                                            loadMask:true,
                                                            stripeRows :true,                                                            
                                                            columnLines : true,
                                                            height:150,
                                                            width:680,
                                                            sm:chkRow,
                                                            tbar:	[
                                                            			{
                                                                        	icon:'../images/add.png',
                                                                            cls:'x-btn-text-icon',
                                                                            text:'Agregar alias',
                                                                            handler:function()
                                                                            		{
                                                                                    	var reg=crearRegistro(	[
                                                                                        							{name: 'nombre'},
                                                                                                                    {name: 'apPaterno'},
                                                                                                                    {name: 'apMaterno'}
                                                                                        						]);
                                                                                    
                                                                                    	var r=new reg	(
                                                                                        					{
                                                                                                                nombre:'',
                                                                                                                apPaterno:'',
                                                                                                                apMaterno:''
                                                                                                            }
                                                                                        				)
                                                                                    
                                                                                    	gEx('gAlias').getStore().add(r);
                                                                                        gEx('gAlias').startEditing(gEx('gAlias').getStore().getCount()-1,1);
                                                                                        
                                                                                    }
                                                                            
                                                                        },'-',
                                                                        {
                                                                        	icon:'../images/delete.png',
                                                                            cls:'x-btn-text-icon',
                                                                            text:'Remover alias',
                                                                            handler:function()
                                                                            		{
                                                                                    	var fila=gEx('gAlias').getSelectionModel().getSelected();
                                                                                        if(!fila)
                                                                                        {
                                                                                        	msgBox('Debe seleccionar el alias que desea remover');
                                                                                            return;
                                                                                        }
                                                                                        
                                                                                       gEx('gAlias').getStore().remove(fila); 
                                                                                    }
                                                                            
                                                                        }
                                                                        
                                                            		]
                                                        }
                                                    );
	return 	tblGrid;		
}

function tipoPersonaCheckCP(rdo,value)
{
	var objConf=gEx('vParticipante').objConf;
	if(value)
    {
		switch(rdo.id)
        {
        	case 'tipoPersona_1':
            
            	gEx('lblGrupoEtnico').show();
                gEx('cmbGrupoEtnico').show();
                
                gEx('lblDiscapacidad').show();
                gEx('cmbDiscapacidad').show();
                
                
            	gEx('lblNacionalidadIndique').hide();
                gEx('cmbNacionalidad').hide();
                gEx('cmbNacionalidad').setValue('');
                gEx('lblNacionalidadEspecifique').hide();
                gEx('txtOtraNacionalidad').hide();
                gEx('txtOtraNacionalidad').setValue('');
            	gEx('lblNombre').show();
            	gEx('lblRazonSocial').hide();

                gEx('txtRazonSocial').setValue('');
                gEx('txtRazonSocial').hide();

            	gEx('lblNacionalidad').show();
                gEx('nacionalidad_0').show();
                gEx('nacionalidad_1').show();
                gEx('nacionalidad_2').show();
                gEx('nacionalidad_3').show();
                gEx('txtNombre').show();
                gEx('txtApPaterno').show();
                gEx('txtApMaterno').show();
                gEx('lblApPaterno').show();
                gEx('lblApMaterno').show();
                gEx('lblGenero').show();
                gEx('cmbGenero').show();
                
               
                    gEx('lblFechaNac').show();
                    gEx('fechaNacimiento').show();
                    gEx('lblEdad').show();
                    gEx('txtEdad').show();
//                    gEx('lblEdoCivil').show();
                    //gEx('cmbEstadoCivil').show();
                    gEx('cmbIdentificacion').setValue(arrTipoIdentificacionCP[0][0]);
                    gEx('cmbIdentificacion').show();
                    gEx('txtEspecifique').show();
                    gEx('lblIdentificacion').setText('No. de Identificaci&oacute;n: <span style="color:#F00">*</span>',false);
                    gEx('lblNoIdentificacion').show();
                    gEx('txtNIT').hide();
				    gEx('txtNIT').setValue('');  
                    
                    gEx('lblCorreoElectronico').setPosition(10,260);
                    gEx('txtMail1').setPosition(200,255);
                    gEx('lblCorreoElectronico2').setPosition(10,290);
                    gEx('txtMail2').setPosition(200,285);
                    gEx('lblAceptaNotificacion').setPosition(10,320);
                    gEx('aceptaNotificacion_1').setPosition(300,315);
                    gEx('aceptaNotificacion_0').setPosition(380,315);
                    gEx('lblCorreoLeyenda').setPosition(10,345);
                    
                    
                    
                    
                        
            break;
            case 'tipoPersona_2':
            	
            	gEx('lblGrupoEtnico').hide();
                gEx('cmbGrupoEtnico').hide();
                gEx('cmbGrupoEtnico').setValue('');
                gEx('lblDiscapacidad').hide();
                gEx('cmbDiscapacidad').hide();
            	gEx('cmbDiscapacidad').setValue('');
            	gEx('lblNacionalidadIndique').hide();
                gEx('cmbNacionalidad').hide();
                gEx('cmbNacionalidad').setValue('');
                gEx('lblNacionalidadEspecifique').hide();
                gEx('txtOtraNacionalidad').hide();
                gEx('txtOtraNacionalidad').setValue('');

	            gEx('txtRazonSocial').show();
                gEx('txtRazonSocial').focus();
            	gEx('lblNombre').hide();
				gEx('lblRazonSocial').show();
            	gEx('lblNacionalidad').hide();
                gEx('nacionalidad_0').hide();
                gEx('nacionalidad_1').hide();
                gEx('nacionalidad_2').hide();
                gEx('nacionalidad_3').hide();
                
                gEx('txtNombre').hide();
                gEx('txtApPaterno').hide();
                gEx('txtApMaterno').hide();
                
                gEx('txtNombre').setValue('');
                gEx('txtApPaterno').setValue('');
                gEx('txtApMaterno').setValue('');
                gEx('cmbGenero').setValue('');
                
                gEx('lblApPaterno').hide();
                gEx('lblApMaterno').hide();
                gEx('lblGenero').hide();
                gEx('cmbGenero').hide();
                
                gEx('lblFechaNac').hide();
                gEx('fechaNacimiento').hide();
                gEx('fechaNacimiento').setValue('');
                gEx('lblEdad').hide();
                gEx('txtEdad').hide();
                gEx('txtEdad').setValue('');
                gEx('lblEdoCivil').hide();
                gEx('cmbEstadoCivil').hide();
                gEx('cmbEstadoCivil').setValue('');
                gEx('cmbIdentificacion').hide();
                gEx('cmbIdentificacion').setValue('');
                gEx('txtEspecifique').hide();
                gEx('txtEspecifique').setValue('');
                gEx('lblIdentificacion').setText('No. de Identificaci&oacute;n Tributaria (NIT): <span style="color:#F00">*</span>',false);
                gEx('lblNoIdentificacion').hide();
                gEx('txtNIT').show();
                
                
                gEx('lblCorreoElectronico').setPosition(10,140);
                gEx('txtMail1').setPosition(200,135);
                gEx('lblCorreoElectronico2').setPosition(10,170);
                gEx('txtMail2').setPosition(200,165);
                gEx('lblAceptaNotificacion').setPosition(10,200);
                gEx('aceptaNotificacion_1').setPosition(300,195);
                gEx('aceptaNotificacion_0').setPosition(380,195);
                gEx('lblCorreoLeyenda').setPosition(10,225);
                
                
            break;
            
        }
    }
}

function tipoNacionalidadCheckCP(rdo,value)
{
	if(value)
    {
    	switch(rdo.id)
        {
        	case 'nacionalidad_0':
            case 'nacionalidad_2':
            	gEx('lblNacionalidadIndique').show();
                gEx('cmbNacionalidad').show();
            break;
            case 'nacionalidad_1':
            case 'nacionalidad_3':
            	gEx('lblNacionalidadIndique').hide();
                gEx('cmbNacionalidad').hide();
                gEx('lblNacionalidadEspecifique').hide();
                gEx('txtOtraNacionalidad').hide();
                gEx('txtOtraNacionalidad').setValue('');
                gEx('cmbNacionalidad').setValue('');
            break;
            
           
        }
    }
}

function crearArbolSujetosProcesalesRelacion(iA,iP)
{
	var iActividad=iA?iA:-1;
    var idPersona=iP?iP:-1;
	var raiz=new  Ext.tree.AsyncTreeNode(
											{
												id:'-1',
												text:'Raiz',
												draggable:false,
												expanded :false,
												cls:'-1'
											}
										)
										
	var cargadorArbol=new Ext.tree.TreeLoader(
                                                {
                                                    baseParams:{
                                                                    funcion:'19',
                                                                    iC:gE('idCarpetaAdministrativa')?gE('idCarpetaAdministrativa').value:-1,
                                                                    cA:gE('carpetaAdministrativa')?gE('carpetaAdministrativa').value:-1,
                                                                    iA:iActividad,
                                                                    check:1,
                                                                    iP:idPersona
                                                                },
                                                    dataUrl:'../paginasFunciones/funcionesModulosEspeciales_Notificaciones.php'
                                                }
                                            )		
										
	cargadorArbol.on('beforeload',function(c)
    						{
                            	buscarPartesAsociar();
                            	c.baseParams.sujetosProcesales=listPartes;
                                if(listPartes=='-1')
                                	gEx('arbolSujetosRelacion').disable();
                                else
                                	gEx('arbolSujetosRelacion').enable();

                            }
    				)	
    										
	cargadorArbol.on('load',function(c,nodoCarga)
    						{
                            	
                            }
    				)										
	var arbolSujetosJuridicos=new Ext.tree.TreePanel	(
                                                            {
                                                                id:'arbolSujetosRelacion',
                                                                useArrows:true,
                                                                animate:true,
                                                                enableDD:false,
                                                                ddScroll:true,
                                                                title:'Relacionado con:',
                                                                containerScroll: true,
                                                                autoScroll:true,
                                                                border:true,
                                                                x:670,
                                                                y:0,
                                                                height:350,
                                                                width:230,
                                                                root:raiz,
                                                                loader: cargadorArbol,
                                                                rootVisible:false
                                                            }
                                                        )
         
         
                                                    
	return  arbolSujetosJuridicos;
}


function buscarParticipante(valor,tipoBusqueda,campo)
{
	function funcAjax(peticion_http)
    {
        var resp=peticion_http.responseText;
        arrResp=resp.split('|');
        if(arrResp[0]=='1')
        {
           if(arrResp[1]!='0')
           {
           		mostrarVentanaExisteParticipante(arrResp[1],arrResp[2],campo,tipoBusqueda);
           }
            
        }
        else
        {
            msgBox('<?php echo $etj["errOperacion"]?>'+' <br />'+arrResp[0]);
        }
    }
    obtenerDatosWebV2('../paginasFunciones/funcionesModulosEspeciales_SGP.php',funcAjax, 'POST','funcion=208&tipoBusqueda='+tipoBusqueda+'&valor='+valor,true);
}

function mostrarVentanaExisteParticipante(valor,nombre,campo,tipoBusqueda)
{
	function respExiste(btn)
    {
    	if(btn=='yes')
        {
        	var vParticipante=gEx('vParticipante');
            var objConf=vParticipante.objConf;
            var listPartes=vParticipante.listPartes;
            var tipoParticipante=vParticipante.tipoParticipante;
            if(listPartes=='-1')
            {
            	var cadObj='{"idActividad":"'+objConf.idActividad+'","idCarpeta":"'+objConf.idCarpeta+'","idFiguraJuridica":"'+tipoParticipante+
                			'","relacion":"","idParticipante":"'+valor+'"}';
                
                
                function respEx(btn)
                {
                	if(btn=='yes')
                    {
                    	guardarRelacionFiguraExistente(cadObj,valor,nombre,tipoParticipante);
                    }
                }
                msgConfirm('Est&aacute; seguro de querer agregar a la persona: <b>'+nombre+'</b>?',respEx);
                
            }
            else
            {
            	mostrarVentanaSeleccionRelacion(valor,nombre,listPartes,tipoBusqueda);
            }
            
            
        
        }
        else
        {
        	var nombreCampo='';
        	switch(tipoBusqueda)
            {
            	case 1:
                	nombreCampo='txtCedula';
                break;
                case 2:
                	nombreCampo='txtCURP';
                break;
                case 3:
                	nombreCampo='txtRFC';
                break;
            }
        	gEx(nombreCampo).setValue('');
            gEx(nombreCampo).focus();
        }
    }
	msgConfirm('Se ha detectado que existe una persona con '+campo+', con el nombre de: <b>'+nombre+'</b>, es la persona que desea agregar?',respExiste)
}

function mostrarVentanaSeleccionRelacion(valor,nombre,listPartes,tipoBusqueda)
{
	
	var form = new Ext.form.FormPanel(	
										{
											baseCls: 'x-plain',
											layout:'absolute',
											defaultType: 'label',
											items: 	[
                                            			crearArbolSujetosProcesalesRelacionSeleccion(listPartes)
													]
										}
									);
	
	var ventanaAM = new Ext.Window(
									{
										title: 'Personas que se relacionan con: '+nombre,
                                        id:'vAddRelacion',
										width: 610,
										height:450,
										layout: 'fit',
										plain:true,
										modal:true,
										bodyStyle:'padding:5px;',
										buttonAlign:'center',
										items: form,
										listeners : {
													show : {
																buffer : 10,
																fn : function() 
																{
																}
															}
												},
										buttons:	[
														{
															
															text: '<?php echo $etj["lblBtnAceptar"]?>',
															handler: function()
																	{
																		var listaRelacion='';
                                                                        var arrNodos=obtenerNodoChecados(gEx('arbolSujetosRelacionSeleccion').getRootNode());
                                                                        var x;
                                                                        for(x=0;x<arrNodos.length;x++)
                                                                        {
                                                                        	if(listaRelacion=='')
                                                                            {
                                                                            	listaRelacion=arrNodos[x].attributes.idPersona;
                                                                            }
                                                                            else
                                                                            {
                                                                            	listaRelacion+=','+arrNodos[x].attributes.idPersona;
                                                                            }
                                                                        }
                                                                        
                                                                        var vParticipante=gEx('vParticipante');
                                                                        var objConf=vParticipante.objConf;
                                                                        var listPartes=vParticipante.listPartes;
                                                                        var tipoParticipante=vParticipante.tipoParticipante;
                                                                        
                                                                        var cadObj='{"idActividad":"'+objConf.idActividad+'","idCarpeta":"'+objConf.idCarpeta+
                                                                        			'","idFiguraJuridica":"'+tipoParticipante+'","relacion":"'+listaRelacion+
                                                                                    '","idParticipante":"'+valor+'"}';
                                                                        guardarRelacionFiguraExistente(cadObj,valor,nombre,tipoParticipante);
                                                                        
																	}
														},
														{
															text: '<?php echo $etj["lblBtnCancelar"]?>',
															handler:function()
																	{
                                                                    	var nombreCampo='';
                                                                        switch(tipoBusqueda)
                                                                        {
                                                                            case 1:
                                                                                nombreCampo='txtCedula';
                                                                            break;
                                                                            case 2:
                                                                                nombreCampo='txtCURP';
                                                                            break;
                                                                            case 3:
                                                                                nombreCampo='txtRFC';
                                                                            break;
                                                                        }
                                                                        gEx(nombreCampo).setValue('');
																		ventanaAM.close();
																	}
														}
													]
									}
								);
	ventanaAM.show();
}

function crearArbolSujetosProcesalesRelacionSeleccion(listPartes)
{
	var vParticipante=gEx('vParticipante');
    var objConf=vParticipante.objConf;
    var listPartes=vParticipante.listPartes;
    var tipoParticipante=vParticipante.tipoParticipante;
	var raiz=new  Ext.tree.AsyncTreeNode(
											{
												id:'-1',
												text:'Raiz',
												draggable:false,
												expanded :false,
												cls:'-1'
											}
										)
										
	var cargadorArbol=new Ext.tree.TreeLoader(
                                                {
                                                    baseParams:{
                                                                    funcion:'19',
                                                                    iC:objConf.idCarpeta,
                                                                    cA:objConf.carpetaAdministrativa,
                                                                    check:1,
                                                                    sujetosProcesales:listPartes
                                                                },
                                                    dataUrl:'../paginasFunciones/funcionesModulosEspeciales_Notificaciones.php'
                                                }
                                            )		
										
	cargadorArbol.on('beforeload',function(c)
    						{
                            }
    				)	
    										
	cargadorArbol.on('load',function(c,nodoCarga)
    						{
                            	setTimeout(	function()
                                			{
                                            
                                                var listaRelacion='';
                                                var arrNodos=obtenerNodoChecados(gEx('arbolSujetosRelacion').getRootNode());
                                                var x;
                                                var nodoSelParticipante;
                                                for(x=0;x<arrNodos.length;x++)
                                                {
                                                	nodoSelParticipante=gEx('arbolSujetosRelacionSeleccion').getNodeById(arrNodos[x].id);
                                                	nodoSelParticipante.getUI().toggleCheck(true);
                                                }
                                             },200
                                           )
                            }
    				)										
	var arbolSujetosRelacionSeleccion=new Ext.tree.TreePanel	(
                                                                    {
                                                                        id:'arbolSujetosRelacionSeleccion',
                                                                        useArrows:true,
                                                                        animate:true,
                                                                        enableDD:false,
                                                                        ddScroll:true,
                                                                        title:'Relacionado con:',
                                                                        containerScroll: true,
                                                                        autoScroll:true,
                                                                        border:true,
                                                                        x:10,
                                                                        y:0,
                                                                        disabled:listPartes=='-1',
                                                                        height:350,
                                                                        width:550,
                                                                        root:raiz,
                                                                        loader: cargadorArbol,
                                                                        rootVisible:false
                                                                    }
                                                                )
         
         
                                                    
	return  arbolSujetosRelacionSeleccion;
}

function guardarRelacionFiguraExistente(cadObj,idFigura,nombre,tipoParticipante)
{
	var vParticipante=gEx('vParticipante');
	var objConf=vParticipante.objConf;
    
    function funcAjax()
    {
        var resp=peticion_http.responseText;
        arrResp=resp.split('|');
        if(arrResp[0]=='1')
        {
            if(gEx('vAddRelacion'))
            	gEx('vAddRelacion').close();
            if(gEx('vParticipante'))
                gEx('vParticipante').close();
                
            if(objConf && objConf.afterRegister)
            	objConf.afterRegister(idFigura,nombre,tipoParticipante);
        }
        else
        {
            msgBox('<?php echo $etj["errOperacion"]?>'+' <br />'+arrResp[0]);
        }
    }
    obtenerDatosWeb('../paginasFunciones/funcionesModulosEspeciales_SGP.php',funcAjax, 'POST','funcion=209&cadObj='+cadObj,true);
}

function calcularEdadParticipante(fechaNacimiento)
{
	
    var edad=0;
    
    var fechaActual=Date.parseDate('<?php echo date("Y-m-d")?>','Y-m-d');
    
    
    fechaCumpleados=Date.parseDate(fechaActual.format("Y")+'-'+fechaNacimiento.format('m-d'),'Y-m-d');
    
    edad=parseInt(fechaActual.format('Y'))-parseInt(fechaNacimiento.format('Y'));
    if(fechaCumpleados>fechaActual)
    {
    	edad--;
    }
    
    
    
    return edad;
}


function obtenerDatosIdentificacionVentana(idParticipanteContacto,personaJuridica,ventanaAM,objConf)
{
	function funcAjax(peticion_http)
    {
        var resp=peticion_http.responseText;
        arrResp=resp.split('|');
        if(arrResp[0]=='1')
        {
        	
        	var oDatos=eval(arrResp[1])[0];
            
            console.log(oDatos);
           
			if(oDatos.tipoPersona=='')
            	oDatos.tipoPersona='1';
            //gE('lblNombreTipo').innerHTML=formatearValorRenderer(arrParteProcesal,personaJuridica);
            
            var pos=existeValorMatriz(arrParteProcesal,personaJuridica);
            var cmbDetalle_P=gEx('cmbDetalle');
            cmbDetalle_P.getStore().loadData(arrParteProcesal[pos][2]);
            cmbDetalle_P.setValue(oDatos.detalleTipo);
            if(cmbDetalle_P.getStore().getCount()==0)
                cmbDetalle_P.hide();
            else
            	cmbDetalle_P.show();
            
            
            gEx('tipoPersona_'+oDatos.tipoPersona).setValue(true);
            tipoPersonaCheckCP(gEx('tipoPersona_'+oDatos.tipoPersona),true);
            gEx('nacionalidad_'+oDatos.esMexicano).setValue(true);
            tipoNacionalidadCheckCP(gEx('nacionalidad_'+oDatos.esMexicano),true);
            gEx('cmbNacionalidad').setValue(oDatos.nacionalidad);
            dispararEventoSelectCombo('cmbNacionalidad');
            gEx('txtOtraNacionalidad').setValue(oDatos.otraNacionalidad);
            
            
            
            gEx('txtNombre').setValue(oDatos.nombre);
            gEx('txtRazonSocial').setValue(oDatos.nombre);
            gEx('txtApPaterno').setValue(oDatos.apellidoPaterno);
            gEx('txtApMaterno').setValue(oDatos.apellidoMaterno);
            
            
            gEx('cmbGenero').setValue(oDatos.genero);
            gEx('fechaNacimiento').setValue(oDatos.fechaNacimiento);
            gEx('txtEdad').setValue(oDatos.edad);
            gEx('cmbEstadoCivil').setValue(oDatos.estadoCivil);
            gEx('cmbIdentificacion').setValue(oDatos.tipoIdentificacion);
            dispararEventoSelectCombo('cmbIdentificacion');
            gEx('txtEspecifique').setValue(oDatos.otraIdentificacion);
          
          	
            
            
            var txtCalle=gEx('txtCalleCParticipante');
            txtCalle.setValue(oDatos.datosContacto.calle);
            var txtNoExt=gEx('txtNoExtCParticipante');
            txtNoExt.setValue(oDatos.datosContacto.noExt);
            var txtNoInt=gEx('txtNoIntCParticipante');
            txtNoInt.setValue(oDatos.datosContacto.noInt);
            var txtColonia=gEx('txtColoniaCParticipante');
            txtColonia.setValue(oDatos.datosContacto.colonia);
            var txtCP=gEx('txtCPCParticipante');
            txtCP.setValue(oDatos.datosContacto.cp);
            var txtLocalidad=gEx('txtLocalidadCParticipante');
            txtLocalidad.setValue(oDatos.datosContacto.localidad);
            var txtEntreCalle=gEx('txtEntreCalleCParticipante');
            txtEntreCalle.setValue(oDatos.datosContacto.entreCalle);
            var txtYCalle=gEx('txtYCalleCParticipante');
            txtYCalle.setValue(oDatos.datosContacto.yCalle);
            var txtReferencias=gEx('txtReferenciasCParticipante');
            txtReferencias.setValue(oDatos.datosContacto.referencias);
            var cmbEstado=gEx('cmbEstadoCParticipante');
            cmbEstado.setValue(oDatos.datosContacto.estado);
            var cmbMunicipio=gEx('cmbMunicipioCParticipante');
            
            gEx('txtNIT').setValue(oDatos.rfcEmpresa);
            gEx('cmbGrupoEtnico').setValue(oDatos.grupoEtnico);
            gEx('cmbDiscapacidad').setValue(oDatos.discapacidad);
            
            
            var posFila=obtenerPosFila(cmbEstado.getStore(),'id',oDatos.datosContacto.estado);
            if(posFila!=-1)
            {
                var registro=cmbEstado.getStore().getAt(posFila);
                obtenerMunicipiosCParticipante(cmbEstado,registro,function()
                                                                    {
                                                                        cmbMunicipio.setValue(oDatos.datosContacto.municipio);
                                                                    }
                                            )
			}            
            
            var regTel=crearRegistro	(
            								[
                                            	{name: 'tipoTelefono'},
                                                {name: 'lada'},
                                                {name: 'numero'},
                                                {name: 'extension'}
                                            
                                            ]
            							)
            
            
            
            for(x=0;x<oDatos.datosContacto.telefonos.length;x++)
            {
            	var r=new regTel(oDatos.datosContacto.telefonos[x]);
                gEx('gTelefonosCParticipante').getStore().add(r);
            }
            
            gEx('txtMail1').setValue(oDatos.datosContacto.correos[0].mail);
            gEx('txtMail2').setValue(oDatos.datosContacto.correos[0].mail);
            
            
            
            
        	ventanaAM.show();
            gEx('aceptaNotificacion_1').setValue(oDatos.aceptaNotificacionMail=='1');
            gEx('aceptaNotificacion_0').setValue(oDatos.aceptaNotificacionMail=='0');
            
        }
        else
        {
            msgBox('<?php echo $etj["errOperacion"]?>'+' <br />'+arrResp[0]);
        }
    }
    obtenerDatosWebV2('../paginasFunciones/funcionesModulosEspeciales_SGP.php',funcAjax, 'POST','funcion=210&idActividad='+
    				((objConf  && objConf.idActividad)?objConf.idActividad:idActividad)+'&idParticipante='+idParticipanteContacto,true);

}

function obtenerMunicipiosCParticipante(cmb,registro,funcAfterLoad)
{
	function funcAjax()
    {
        var resp=peticion_http.responseText;
        arrResp=resp.split('|');
        if(arrResp[0]=='1')
        {
            var arrDatos=eval(arrResp[1]);
            gEx('cmbMunicipioCParticipante').setValue('');
            gEx('cmbMunicipioCParticipante').getStore().loadData(arrDatos);
            if(funcAfterLoad)
            	funcAfterLoad();
        }
        else
        {
            msgBox('<?php echo $etj["errOperacion"]?>'+' <br />'+arrResp[0]);
        }
    }
    obtenerDatosWeb('../paginasFunciones/funcionesModulosEspeciales_SGP.php',funcAjax, 'POST','funcion=89&cveEstado='+registro.data.id,true);
    
}

function buscarPersona(nPersona,tB)
{
	function funcAjax()
    {
        var resp=peticion_http.responseText;
        arrResp=resp.split('|');
        if(arrResp[0]=='1')
        {
        	
            if(arrResp[1]=='1')
            {
            	esBusquedaPersona=true;
            	var cObjeto=eval('['+bD(arrResp[2])+']')[0];
                idPersonaEncontrada=cObjeto.datosParticipante.idParticipante;
                gEx('cmbIdentificacion').disable();
                gEx('txtEspecifique').disable();
                gEx('txtMail1').setValue(cObjeto.datosContacto.correos[0].mail);
              	gEx('txtMail1').disable();
                gEx('txtMail2').setValue(cObjeto.datosContacto.correos[0].mail);
               	gEx('txtMail2').disable();
                gEx('txtNombre').setValue(cObjeto.datosParticipante.nombre);
                gEx('txtNombre').disable();
                gEx('txtApPaterno').setValue(cObjeto.datosParticipante.apellidoPaterno);
                gEx('txtApPaterno').disable();
                gEx('txtApMaterno').setValue(cObjeto.datosParticipante.apellidoMaterno);
                gEx('txtApMaterno').disable();
                gEx('fechaNacimiento').setValue(cObjeto.datosParticipante.fechaNacimiento);
                gEx('fechaNacimiento').disable();
                
                if(cObjeto.datosParticipante.fechaNacimiento!='')
                {
                	gEx('fechaNacimiento').fireEvent('change',gEx('fechaNacimiento'),gEx('fechaNacimiento').getValue());
                }
                
                
                
                gEx('cmbEstadoCivil').setValue(cObjeto.datosParticipante.estadoCivil);
                gEx('cmbEstadoCivil').disable();
                gEx('cmbGenero').setValue(cObjeto.datosParticipante.genero);
                gEx('cmbGenero').disable();
                gEx('txtEdad').disable();
                
                
                gEx('cmbGrupoEtnico').disable();
                gEx('cmbDiscapacidad').disable();
                
                gEx('cmbGrupoEtnico').setValue(cObjeto.datosParticipante.grupoEtnico);
                gEx('cmbDiscapacidad').setValue(cObjeto.datosParticipante.discapacidad);

                var txtCalle=gEx('txtCalleCParticipante');
                txtCalle.setValue(cObjeto.datosContacto.calle);
                var txtNoExt=gEx('txtNoExtCParticipante');
                txtNoExt.setValue(cObjeto.datosContacto.noExt);
                var txtNoInt=gEx('txtNoIntCParticipante');
                txtNoInt.setValue(cObjeto.datosContacto.noInt);
                var txtColonia=gEx('txtColoniaCParticipante');
                txtColonia.setValue(cObjeto.datosContacto.colonia);
                var txtCP=gEx('txtCPCParticipante');
                txtCP.setValue(cObjeto.datosContacto.cp);
                var txtLocalidad=gEx('txtLocalidadCParticipante');
                txtLocalidad.setValue(cObjeto.datosContacto.localidad);
                var txtEntreCalle=gEx('txtEntreCalleCParticipante');
                txtEntreCalle.setValue(cObjeto.datosContacto.entreCalle);
                var txtYCalle=gEx('txtYCalleCParticipante');
                txtYCalle.setValue(cObjeto.datosContacto.yCalle);
                var txtReferencias=gEx('txtReferenciasCParticipante');
                txtReferencias.setValue(cObjeto.datosContacto.referencias);
                var cmbEstado=gEx('cmbEstadoCParticipante');
                cmbEstado.setValue(cObjeto.datosContacto.estado);
                var cmbMunicipio=gEx('cmbMunicipioCParticipante');
                
                
                
                 var posFila=obtenerPosFila(cmbEstado.getStore(),'id',cObjeto.datosContacto.estado);
                if(posFila!=-1)
                {
                    var registro=cmbEstado.getStore().getAt(posFila);
                    obtenerMunicipiosCParticipante(cmbEstado,registro,function()
                                                                        {
                                                                            cmbMunicipio.setValue(cObjeto.datosContacto.municipio);
                                                                        }
                                                )
                }            
                
                txtCalle.disable();
                txtNoExt.disable();
                txtNoInt.disable();
                txtColonia.disable();
                txtCP.disable();
                txtLocalidad.disable();
                txtEntreCalle.disable();
                txtYCalle.disable();
                txtReferencias.disable();
                cmbEstado.disable();
                cmbMunicipio.disable();
                
                var arrDatosTelefono=[];
                var x;
                var f;
                for(x=0;x<cObjeto.datosContacto.telefonos.length;x++)
                {
                	f=cObjeto.datosContacto.telefonos[x];
                    arrDatosTelefono.push([f.tipoTelefono,f.lada,f.numero,f.extension]);
                }
                
                
                gEx('gTelefonosCParticipante').getStore().loadData(arrDatosTelefono);
                gEx('gTelefonosCParticipante').disable();
                
                gEx('tipoPersona_'+cObjeto.datosParticipante.tipoPersona).setValue(true);
                gEx('tipoPersona_1').disable();
                gEx('tipoPersona_2').disable();
                tipoPersonaCheckCP(gEx('tipoPersona_'+cObjeto.datosParticipante.tipoPersona),true);
                if(cObjeto.datosParticipante.tipoPersona!='1')
                {
                	gEx('txtRazonSocial').setValue(cObjeto.datosParticipante.nombre);
                    gEx('txtRazonSocial').disable();
                }
                
                gEx('nacionalidad_'+cObjeto.datosParticipante.esMexicano).setValue(true);
                tipoNacionalidadCheckCP( gEx('nacionalidad_'+cObjeto.datosParticipante.esMexicano),true);
                gEx('nacionalidad_0').disable();
                gEx('nacionalidad_1').disable();
                gEx('nacionalidad_2').disable();
                gEx('nacionalidad_3').disable();
                gEx('cmbNacionalidad').setValue(cObjeto.datosParticipante.nacionalidad);
                gEx('cmbNacionalidad').disable();
                
                
                    
                     
                      
                
                
               
            }
        }
        else
        {
            msgBox('<?php echo $etj["errOperacion"]?>'+' <br />'+arrResp[0]);
        }
    }
    obtenerDatosWeb('../modulosEspeciales_SIUGJ/paginasFunciones/funcionesModuloRegistroPartes.php',funcAjax, 'POST','funcion=2&tB='+tB+'&vB='+nPersona,true);
    
}

