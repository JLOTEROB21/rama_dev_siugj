<?php
	session_start();
	include("configurarIdiomaJS.php");
	include("conexionBD.php"); 
	$idConfiguracion=$_GET["idConfiguracion"];
	$idFormulario=$_GET["iF"];
	
	
	$consulta="	select cg.titulo,tamanoColumna as 'tamColumna' 
				from 907_camposGrid cg where cg.idIdioma=".$_SESSION["leng"]." and cg.idConfGrid=".$idConfiguracion." order by cg.orden";
	
	$res=$con->obtenerFilas($consulta);
	$campos="{name: 'idRegistro' }";
	$columnModel='new  Ext.grid.RowNumberer()';
	$ct=1;
	while($filas=mysql_fetch_row($res))
	{
		
		$campos.=",{name: 'campo_".$ct."' }";
		$columnModel.="	,{
							header:'".uEJ($filas[0])."',
							width:".$filas[1].",
							sortable:true,
							dataIndex:'campo_".$ct."',
							align:'left',
							resizable:false
						}";
		
		$ct++;
	}
	
	$consulta="select codigoUnidad,unidad from 817_organigrama where institucion=1 order by unidad";
	$arrInstituciones=$con->obtenerFilasArreglo($consulta);
	
	if($arrInstituciones=="[]")
		$arrInstituciones="[['@instUsuario','".$etj["lblInstUsuario"]."']]";
	else
		$arrInstituciones="[['@instUsuario','".$etj["lblInstUsuario"]."'],".substr($arrInstituciones,1);	
	$consulta="select codigoUnidad,unidad from 817_organigrama where institucion=0 order by unidad";
	$arrUnidades=$con->obtenerFilasArreglo($consulta);
	if($arrUnidades=="[]")
		$arrUnidades="[['@UnidadUsuario','".$etj["lblUnidadUsuario"]."']]";
	else
		$arrUnidades="[['@UnidadUsuario','".$etj["lblUnidadUsuario"]."'],".substr($arrUnidades,1);	
		
	$consulta="select * from (
				
				(
				SELECT idGrupoElemento,concat(nombreCampo,' [',t.tipoElemento,']') as campo,e.tipoElemento,t.tipoValor
				FROM 901_elementosFormulario e,901_tipoElementosFormulario t WHERE idFormulario=".$idFormulario." AND e.tipoElemento 
				IN (2,3,4,5,6,7,8,9,11,14,15,16,17,18,19,22,24,31) and t.idTipoElemento=e.tipoElemento 
				)
				union
				(
					SELECT tipoElemento AS idGrupoElemento,CONCAT(etiquetaUsuario,' (Campo de control)') AS campo,tipoElemento,tipoValor FROM 9017_camposControlFormulario where tipoElemento not in (-14,-15)
				)
				
				
				)as tmp ORDER BY campo	";
	$arrControles=$con->obtenerFilasArreglo($consulta);
	
	$consulta="select * from (
				SELECT idTipoElemento,tipoElemento FROM 901_tipoElementosFormulario
				union
				SELECT tipoElemento as idTipoElemento,'Campo de control' as tipoElemento FROM 9017_camposControlFormulario
				) as tmp ORDER BY idTipoElemento";
	$arrTiposElementos=$con->obtenerFilasArreglo($consulta);	
	
	
	$arrFiltros="";
	$consulta="SELECT * FROM 907_filtrosGlobalesGrid WHERE idConfiguracionGrid=".$idConfiguracion;
	$rConfiguracion=$con->obtenerFilas($consulta);
	while($fConfiguracion=mysql_fetch_row($rConfiguracion))
	{
		$control="";
		switch($fConfiguracion[3])
		{
			case 1://
				$control='crearComboExt("op1_'.$fConfiguracion[2].'",arrCondicionales,0,0,40,{valor:"="}),new Ext.form.NumberField({id:"txt1_'.$fConfiguracion[2].'",width:"40",allowDecimals:true,allowNegative:true}),'.
						'{"xtype":"label",html:"&nbsp;&nbsp;<span style=\"color:#000\"><b>y</b></span>&nbsp;&nbsp;"},crearComboExt("op2_'.$fConfiguracion[2].'",arrCondicionales,0,0,40,{valor:"="}),new Ext.form.NumberField({id:"txt2_'.
							$fConfiguracion[2].'",width:"40",allowDecimals:true,allowNegative:true})';
			break;	
			/*case 2:
				$control='new Ext.form.TextField({"id":"txt_'.$fConfiguracion[2].'",width:"'.$fConfiguracion[4].'"})';
			break;*/
			case 3://
				$control='crearComboExt("cmb_'.$fConfiguracion[2].'",[],0,0,'.$fConfiguracion[4].')';
			break;
			case 4://
				$control='crearComboExt("cmb_'.$fConfiguracion[2].'",[],0,0,'.$fConfiguracion[4].')';
			break;
			case 5:
				$control='crearComboExt("op1_'.$fConfiguracion[2].'",arrCondicionalesTexto,0,0,80,{valor:arrCondicionalesTexto[0][0]}),new Ext.form.TextField({"id":"txt1_'.$fConfiguracion[2].'",width:"'.$fConfiguracion[4].'"})';
			break;	
			case 6://
				$control='crearComboExt("op1_'.$fConfiguracion[2].'",arrCondicionales,0,0,40,{valor:"="}),new Ext.form.DateField({"id":"txt1_'.$fConfiguracion[2].'"}),'.
						'{"xtype":"label",html:"&nbsp;&nbsp;<span style=\"color:#000\"><b>y</b></span>&nbsp;&nbsp;"},crearComboExt("op2_'.$fConfiguracion[2].'",arrCondicionales,0,0,40,{valor:"="}),new Ext.form.DateField({"id":"txt2_'.$fConfiguracion[2].'"})';
				
			break;
			/*case 7:
				$control='new Ext.form.DateField({"id":"txt1_'.$fConfiguracion[2].'"})';
			break;	*/	
		}
		$filtro='{"xtype":"label",html:"<span style=\"color:#000\"><b>'.$fConfiguracion[1].':</b></span>&nbsp;&nbsp;"},'.$control.',"-"';
		if($arrFiltros=="")
			$arrFiltros=$filtro;
		else
			$arrFiltros.=",".$filtro;
	}
	
	
	$consulta="SELECT idFuncion,nombreFuncion FROM 9033_funcionesScriptsSistema WHERE idCategoria=1";
	$arrFunciones=$con->obtenerFilasArreglo($consulta);
	
	$consulta="SELECT valor,texto FROM 1004_siNo";
	$arrSiNo=$con->obtenerFilasArreglo($consulta);
?>	
var arrSiNo=<?php echo $arrSiNo?>;

var rCampoIndice=crearRegistro(	[
									{name: 'idCampo'},
                                    {name: 'campo'},
                                    {name: 'orden',type:'int'}
								]
                               );
var rCampoTabla=crearRegistro(
								[
									{name: 'idCampo'},
                                    {name: 'campo'}
                                 
								]
							);

var arrFuncionesRenderer=<?php echo $arrFunciones?>;


var arrCondicionales=[['>','>'],['>=','>='],['=','='],['<','<'],['<=','<=']];
var arrCondicionalesTexto=[["like '@valor%'",'Inicia con'],["like '%@valor%'",'Contiene']];


var arrTiposElementos=<?php echo $arrTiposElementos?>;
var arrControles=<?php echo $arrControles?>;
var ventanaAM =null;
var ventanaAC=null;
var ventanaEtiquetas=null;
var idElemento='-1';
var idConfiguracion='-1';

var rgIdiomas = Ext.data.Record.create	
(
	[
			{name: 'idioma'},
			{name: 'idIdioma'},
			{name: 'etiqueta'},
            {name: 'idCamposGrid'}
	  ]
);

var rColumna= Ext.data.Record.create	(
											[
                                            	{name: 'idGrupoCampo'},
												{name: 'etFormulario'},
												{name: 'titulo'},
												{name: 'tamColumna'},
                                                {name: 'alineacion'},
                                                {name: 'orden'},
                                                {name: 'funcionRenderer'}
                                            ]
										)

Ext.onReady(inicializar);
var tipoProceso;
var formPrincipal;
function inicializar()
{
	arrFuncionesRenderer.splice(0,0,['0','Ninguno']);
	idConfiguracion=gE('idConfiguracion').value;
    tipoProceso=parseInt(gE('tipoProceso').value);
    formPrincipal=gE('formPrincipal').value;
    if((tipoProceso<2)||(formPrincipal=='0'))
    {
    	
		crearTablaRegistros();
    }
    else
    {
    	
    	redibujarTblComplementario();
    }
    /*var tabs = new Ext.TabPanel({
                                renderTo: 'divConfiguracion',
                                activeTab: 0,
                                width:900,
                                height:500,
                                items:	[	 
                                            {
                                                contentEl:'tdTblRegistro', 
                                                tbar:	[
                                                			
                                                		],
                                                title:'Configuraci&oacute;n de Grid'
                                            }
                                        ]
                                
                                });*/
	/*new Ext.Panel	(
    					{
                        	width:250,
                            height:500,
                            border:true,
                            renderTo:'divPanel',
                            layout:'border',
                            items:	[
                            			
                            		]
                        }
    				)*/
    
}

function cambiarColor(val)
{
	 return '<img src="../images/banderas/'+val+'" />';
}

function configurarGrid()
{
	mostrarVentanaConfiguracion();

}

function mostrarVentanaConfiguracion()
{
	var tblGrid=crearGridConfiguracion();
    var comboOrden=crearComboOrden();
    comboOrden.on('select',cambiarOrden);
    var comboCampos=crearComboCampos();
    comboCampos.on('select',cambiarCampoOrden);
    var arrAgrupacion=[['0','No agrupar']];
    var comboAgrupacion=crearComboExt('cmbAgrupacion',arrAgrupacion,150,350);
    comboAgrupacion.setValue('0');
    var formPrincipal=gE('formPrincipal').value;
    comboAgrupacion.on('select',cambiarCampoAgrupacion);
    var form = new Ext.form.FormPanel(	
												{
													baseCls: 'x-plain',
													layout:'absolute',
													defaultType: 'label',
													items: 	[
																tblGrid,
                                                                {
                                                                	id:'lblAgrupar',
                                                                	x:10,
                                                                    y:355,
                                                                    text:'Agrupar por:'
                                                                },
                                                                comboAgrupacion,
                                                                {
                                                                	id:'lblOrdenar',
                                                                	x:10,
                                                                    y:385,
                                                                    text:'<?php echo $etj["lblOrdernarPor"]?>:'
                                                                },
                                                                comboCampos,
                                                                {
                                                                	id:'lblOrden',
                                                                	x:10,
                                                                    y:415,
                                                                    text:'<?php echo $etj["lblOrden"]?>:'
                                                                },
                                                                comboOrden,
                                                                {
                                                                	id:'lblRegPagina',
                                                                	x:10,
                                                                    y:445,
                                                                    text:'<?php  echo $etj["lblRegPag"]?>:'
                                                                },
                                                                {
                                                                	xtype:'numberfield',
                                                                    x:150,
                                                                    y:440,
                                                                    id:'txtNumRegPag',
                                                                    allowDecimals:false,
                                                                    width:80
                                                                }
															]
												}
											);
                                            
	Ext.getCmp('txtNumRegPag').on('change',cambiarNumRegPaginas);                                            
                                            
	ventanaAM = new Ext.Window(
									{
										title: '<?php echo $etj["lblConfGrid"]?>',
										width: 800,
										height:560,
										minWidth: 690,
										minHeight: 520,
										layout: 'fit',
										plain:true,
										modal:true,
										bodyStyle:'padding:5px;',
										buttonAlign:'center',
										items: form,
										listeners : {
													show : {
																buffer : 10,
																fn : function() 
																{
																	
																	
																}
															}
												},
										buttons:	[
														{
                                                        	id:'btnAceptarConf',
															text: '<?php echo $etj["lblBtnAceptar"]?>',
															handler:function()
																	{
                                                                    
                                                                    	if((comboCampos.getValue()=='')&&(tblGrid.getStore().getCount()>0))
                                                                        {
                                                                        	function resp()
                                                                            {
                                                                            	comboCampos.focus();
                                                                            }
                                                                            Ext.MessageBox.alert('<?php echo $etj["lblAplicacion"]?>','<?php echo $etj["lblDebeSelCampoO"]?>',resp);
                                                                        	return;
                                                                        }	
                                                                    
																		destruirVentanas();
																	}
														}
													]
									}
								);
    if((tipoProceso>1)&&(formPrincipal=='1'))
    {
    	comboAgrupacion.hide();
        Ext.getCmp('lblAgrupar').hide();
        //Ext.getCmp('lblRegPagina').hide();
        //Ext.getCmp('txtNumRegPag').hide();
        //Ext.getCmp('lblOrdenar').setPosition(10,355);
        //comboCampos.setPosition(150,350);
        //Ext.getCmp('lblOrden').setPosition(10,385);
        //comboOrden.setPosition(150,380);
    }
	cargarDatosConfiguracion(alNameDTD,ventanaAM);
}

function cambiarCampoAgrupacion(combo,registro,indice)
{
	var txtNumReg=Ext.getCmp('txtNumRegPag');
    if(indice!=0)
        txtNumReg.disable();
    else
        txtNumReg.enable();
	function funcResp()
    {
        arrResp=peticion_http.responseText.split('|');
        if(arrResp[0]=='1')
        {
        	
        }
        else
        {
            msgBox('<?php echo $etj["errOperacion"]?>'+' <br />'+arrResp[0]);
        }
    }
    obtenerDatosWeb('../paginasFunciones/funcionesTblFormularios.php',funcResp, 'POST','funcion=5&idConfiguracion='+idConfiguracion+'&campoAgrupacion='+registro.get('id'),true);
}

function cambiarOrden(combo,registro,indice)
{
	function funcResp()
    {
        arrResp=peticion_http.responseText.split('|');
        if(arrResp[0]=='1')
        {
        	
        }
        else
        {
            msgBox('<?php echo $etj["errOperacion"]?>'+' <br />'+arrResp[0]);
        }
    }
    obtenerDatosWeb('../paginasFunciones/funcionesTblFormularios.php',funcResp, 'POST','funcion=2&idConfiguracion='+idConfiguracion+'&orden='+registro.get('id'),true);
}

function cambiarCampoOrden(combo,registro,indice)
{
	function funcResp()
    {
        arrResp=peticion_http.responseText.split('|');
        if(arrResp[0]=='1')
        {
        	
        }
        else
        {
            msgBox('<?php echo $etj["errOperacion"]?>'+' <br />'+arrResp[0]);
        }
    }
    obtenerDatosWeb('../paginasFunciones/funcionesTblFormularios.php',funcResp, 'POST','funcion=3&idConfiguracion='+idConfiguracion+'&campoOrden='+registro.get('etFormulario'),true);
}

function cambiarNumRegPaginas(campo,nValor,vValor)
{
	Ext.getCmp('btnAceptarConf').disable();
	function funcResp()
    {
        arrResp=peticion_http.responseText.split('|');
        if(arrResp[0]=='1')
        {
       		Ext.getCmp('btnAceptarConf').enable();
        }
        else
        {
        	function funcResp()
            {
        		Ext.getCmp('btnAceptarConf').enable();
            }
            msgBox('<?php echo $etj["errOperacion"]?>'+' <br />'+arrResp[0],funcResp);
        }
    }
    obtenerDatosWeb('../paginasFunciones/funcionesTblFormularios.php',funcResp, 'POST','funcion=4&idConfiguracion='+idConfiguracion+'&numReg='+nValor,true);
}

function crearComboOrden()
{
	var tEntradas=[['ASC','<?php echo $etj["lblAscendente"]?>'],['DESC','<?php echo $etj["lblDescendente"]?>']];
	var dsDatos= new Ext.data.SimpleStore	(
													{
														fields:	[
																	{name:'id'},
																	{name:'tipo'}
																]
													}
												);
	dsDatos.loadData(tEntradas);
	var comboDatos=document.createElement('select');
	var cmbDatos=new Ext.form.ComboBox	(
													{
														x:150,
														y:410,
														id:'idCmbOrden',
														mode:'local',
														emptyText:'<?php echo $etj["lblElijaOpcion"] ?>',
														store:dsDatos,
														displayField:'tipo',
														valueField:'id',
														transform:comboDatos,
														editable:false,
														typeAhead: true,
														triggerAction: 'all',
														lazyRender:true,
														minListWidth:200
													}
												)
	return cmbDatos;	
}

function crearComboCampos()
{
	var dsDatos=Ext.getCmp('gridConfiguracion').getStore();
	var comboDatos=document.createElement('select');
	var cmbDatos=new Ext.form.ComboBox	(
													{
														x:150,
														y:380,
														id:'idCmbCampos',
														mode:'local',
														emptyText:'<?php echo $etj["lblElijaOpcion"] ?>',
														store:dsDatos,
														displayField:'titulo',
														valueField:'etFormulario',
														transform:comboDatos,
														editable:false,
														typeAhead: true,
														triggerAction: 'all',
														lazyRender:true,
														minListWidth:200
													}
												)
	return cmbDatos;	
}

function crearGridConfiguracion()
{
	dsNameDTD=[];
    var ocultoCampo=false;
    if(tipoProceso)
    	ocultoCampo=true;
	alNameDTD=	new Ext.data.SimpleStore(
    											{
    												fields:	[
    															{name: 'idGrupoCampo'},
																{name: 'etFormulario'},
																{name: 'titulo'},
																{name: 'tamColumna'},
                                                                {name: 'alineacion'},
                                                                {name: 'orden', type:'int'},
                                                                {name: 'funcionRenderer'}
    														]
    											}
    										);

    
	var cmGrid= new Ext.grid.ColumnModel   	(
												 	[
													 	new  Ext.grid.RowNumberer(),
														{
															header:'<?php echo $etj["lblEtFormulario"] ?>',
															width:150,
															sortable:true,
															dataIndex:'etFormulario'
														},
														{
															header:'<?php echo $etj["lblTituloC"] ?>',
															width:200,
															sortable:true,
															dataIndex:'titulo'
														},
                                                        {
															header:'<?php echo $etj["lblTamCol"] ?>',
															width:120,
															sortable:true,
															dataIndex:'tamColumna',
                                                            hidden:ocultoCampo
														},
                                                         {
															header:'<?php echo $etj["lblAlineacion"] ?>',
															width:130,
															sortable:true,
															dataIndex:'alineacion'
														},
                                                         {
															header:'Orden',
															width:60,
															sortable:true,
															dataIndex:'orden'
														},
                                                         {
															header:'Funci&oacute;n renderer',
															width:150,
															sortable:true,
															dataIndex:'funcionRenderer',
                                                            renderer:function(val)
                                                            		{
                                                                    	return mostrarValorDescripcion(formatearValorRenderer(arrFuncionesRenderer,val));
                                                                    }
														}
													]
												);
	var tblGrid=	new Ext.grid.GridPanel	(
                                                        {
                                                        	id:'gridConfiguracion',
                                                            store:alNameDTD,
                                                            frame:false,
                                                            border:true,
                                                            y:10,
                                                            stripeRows :true,
                                                            columnLines : true,
                                                            cm: cmGrid,
                                                            height:320,
                                                            width:750,
                                                            tbar:	[
                                                            				{
                                                                            	text:'<?php echo $etj["lblAddColum"] ?>',
                                                                                icon:'../images/add.png',
                                                                                cls:'x-btn-text-icon',
                                                                                handler:function()
                                                                                		{
                                                                                        	mostrarVentanaAgregarCampo();
                                                                                        }	
                                                                            },'-',
                                                                            {
                                                                            	text:'<?php echo $etj["lblModColum"] ?>',
                                                                                icon:'../images/pencil.png',
                                                                                cls:'x-btn-text-icon',
                                                                                handler:function()
                                                                                		{
                                                                                        	var sm=tblGrid.getSelectionModel();
                                                                                            var filaSel=sm.getSelected();
                                                                                            if(filaSel==null)
                                                                                            {
                                                                                                Ext.MessageBox.alert('<?php echo $etj["lblAplicacion"]?>','<?php echo $etj["msgDebeSelElem"]?>');
                                                                                                return;
                                                                                            }
                                                                                            mostrarVentanaConfiguracionCampo(filaSel,1);
                                                                                            

                                                                                            
                                                                                        	
                                                                                        }	
                                                                            },'-',
                                                                            {
                                                                            	text:'<?php echo $etj["lblDelColum"] ?>',
                                                                                icon:'../images/delete.png',
                                                                                cls:'x-btn-text-icon',
                                                                                handler:function()
                                                                                		{
                                                                                        	var sm=tblGrid.getSelectionModel();
                                                                                            var filaSel=sm.getSelected();
                                                                                            if(filaSel==null)
                                                                                            {
                                                                                                Ext.MessageBox.alert('<?php echo $etj["lblAplicacion"]?>','<?php echo $etj["msgDebeSelElem"]?>');
                                                                                                return;
                                                                                            }
                                                                                            var idGrupoCampo=filaSel.get('idGrupoCampo');
                                                                                            function resp(btn)
                                                                                            {
                                                                                            	if(btn=='yes')
                                                                                                {
                                                                                                	var arrResp=peticion_http.responseText.split('|');
                                                                                                    if(arrResp[0]=='1')
                                                                                                    {
                                                                                                        cmbAgrupacion=Ext.getCmp('cmbAgrupacion');
                                                                                                        var dSetAgrupacion=cmbAgrupacion.getStore();
                                                                                                        var pos=obtenerPosFila(dSetAgrupacion,'id',filaSel.get('etFormulario'));
                                                                                                        dSetAgrupacion.removeAt(pos);
                                                                                                        tblGrid.getStore().remove(filaSel);
                                                                                                        generarTabla();
                                                                                                        
                                                                                                    }
                                                                                                    else
                                                                                                    {
                                                                                                        msgBox('<?php echo $etj["errOperacion"]?>'+' <br />'+arrResp[0]);
                                                                                                    }
                                                                                                    obtenerDatosWeb('../paginasFunciones/funcionesFormulario.php',resp, 'POST','funcion=7&idGrupoCampo='+idGrupoCampo,true);
                                                                                                }
                                                                                            	
                                                                                            }
                                                                                            Ext.MessageBox.confirm('<?php echo $etj["lblAplicacion"]?>','<?php echo $etj["msgConfirmDel"] ?>',resp);
                                                                                        }	
                                                                            }
                                                            		]
                                                            
                                                        }
                                                    );
											
	return 	tblGrid;									
}

function cargarDatosConfiguracion(almacen,ventanaAM)
{
	function funcResp()
    {
        arrResp=peticion_http.responseText.split('|');
        if(arrResp[0]=='1')
        {
        	var datos=eval(arrResp[1]);
            var arrConf=eval(arrResp[2]);
            confGrid=arrConf[0];
            Ext.getCmp('txtNumRegPag').setValue(confGrid.numReg);
            Ext.getCmp('idCmbOrden').setValue(confGrid.direccion);
            Ext.getCmp('cmbAgrupacion').setValue(confGrid.campoAgrupacion);
            Ext.getCmp('idCmbCampos').setValue(confGrid.campo);
            
            almacen.loadData(datos);
            almacen.sort('orden','ASC');
            var cmbAgrupacion=Ext.getCmp('cmbAgrupacion');
            var almacenCmb=cmbAgrupacion.getStore();
            var rCmb;
            for(z=0;z<almacen.getCount();z++)
            {
            	rCmb=new regCombo(
                					{
                                    	id:almacen.getAt(z).get('etFormulario'),
                                        nombre:almacen.getAt(z).get('titulo')
                                    }
                                 )
           		almacenCmb.add(rCmb); 
            }
            
            
            ventanaAM.show();
        }
        else
        {
            msgBox('<?php echo $etj["errOperacion"]?>'+' <br />'+arrResp[0]);
        }
    }
    obtenerDatosWeb('../paginasFunciones/funcionesFormulario.php',funcResp, 'POST','funcion=4&idConfiguracion='+idConfiguracion,true);
}

function mostrarVentanaAgregarCampo()
{
	var tblGrid=crearGridAgregarC();
	var form = new Ext.form.FormPanel(	
												{
													baseCls: 'x-plain',
													layout:'absolute',
													defaultType: 'textfield',
													items: 	[
																tblGrid,
                                                                {
                                                                	xtype:'label',
                                                                    y:5,
                                                                    x:10,
                                                                    html:'<font color="brown"><?php echo $etj["lblSelCampoA"]?>:</font>'
                                                                }
															]
												}
											);
	ventanaAC = new Ext.Window(
									{
										title: '<?php echo $etj["lblAddColum"]?>',
										width: 690,
										height:310,
										minWidth: 690,
										minHeight: 520,
										layout: 'fit',
										plain:true,
										modal:true,
										bodyStyle:'padding:5px;',
										buttonAlign:'center',
										items: form,
										listeners : {
													show : {
																buffer : 10,
																fn : function() 
																{
																}
															}
												},
										buttons:	[
														{
															id:'btnAceptar',
															text: '<?php echo $etj["lblSiguiente"]?> >>',
															listeners:	{
																			click:function()
																				{
                                                                                
                                                                                	var selModel=tblGrid.getSelectionModel();
                                                                                    var filaSel=selModel.getSelected();
                                                                                    
                                                                                    if(filaSel!=null)
                                                                                    {
                                                                                        ventanaAC.hide();
                                                                                        mostrarVentanaConfiguracionCampo(filaSel,0);
                                                                                        
                                                                                    }
                                                                                    else
                                                                                    {
                                                                                    	Ext.MessageBox.alert('<?php echo $etj["lblAplicacion"]?>','<?php echo $etj["msgDebeSelElem"]?>')
                                                                                    }
																				}
																		}
														},
														{
															text: '<?php echo $etj["lblBtnCancelar"]?>',
															handler:function()
																	{
																		ventanaAC.close();
																	}
														}
													]
									}
								);
	 cargarDatosAgregarC(alNameCampos,ventanaAC);                                
	                               
}

function crearGridAgregarC()
{
	dsNameCampos=[];
	alNameCampos=	new Ext.data.SimpleStore(
    											{
    												fields:	[
    															{name: 'idGrupoElemento'},
																{name: 'campo'},
                                                                {name: 'tipoCampo'},
                                                                {name: 'funcionRenderer'}
                                                                
    														]
    											}
    										);

   
	var cmGrid= new Ext.grid.ColumnModel   	(
												 	[
													 	new  Ext.grid.RowNumberer(),
														{
															header:'<?php echo $etj["lblCampo"] ?>',
															width:150,
															sortable:true,
															dataIndex:'campo'
														},
                                                        {
															header:'Tipo de campo',
															width:200,
															sortable:true,
															dataIndex:'tipoCampo',
                                                            renderer:function(val)
                                                            		{
                                                                    	
                                                                    	return mostrarValorDescripcion(formatearValorRenderer(arrTiposElementos,val));
                                                                    }
                                                            
														},
                                                        {
															header:'Funci&oacute;n renderer',
															width:200,
															sortable:true,
															dataIndex:'funcionRenderer',
                                                            renderer:function(val)
                                                            		{
                                                                    	return mostrarValorDescripcion(formatearValorRenderer(arrFuncionesRenderer,val));
                                                                    }
														}
													]
												);
	var tblGrid=	new Ext.grid.GridPanel	(
                                                        {
                                                            store:alNameCampos,
                                                           
                                                            y:25,
                                                            stripeRows :true,
                                                            frame:false,
                                                            border:true,
                                                            columnLines : true,
                                                            cm: cmGrid,
                                                            height:200,
                                                            width:650
                                                        }
                                                    );
											
	return 	tblGrid;									
}

function cargarDatosAgregarC(almacen,ventanaAC)
{
	var idFormulario=gE('idFormulario').value;
	function funcResp()
    {
        arrResp=peticion_http.responseText.split('|');
        if(arrResp[0]=='1')
        {
        	var datos=eval(arrResp[1]);
            almacen.loadData(datos);
            ventanaAC.show();
        }
        else
        {
            msgBox('<?php echo $etj["errOperacion"]?>'+' <br />'+arrResp[0]);
        }
    }
    obtenerDatosWeb('../paginasFunciones/funcionesFormulario.php',funcResp, 'POST','funcion=5&idConfiguracion='+idConfiguracion+'&idFormulario='+idFormulario,true);
}

function mostrarVentanaConfiguracionCampo(filaSel,accion)
{

	var cmbRenderer=crearComboExt('cmbRenderer',arrFuncionesRenderer,150,255,250);
	lblBtnAceptar='<?php echo $etj["lblFinalizar"] ?>';
	function obtenerIdiomas()
	{
		var resp=eval(peticion_http.responseText);
		var tblGrid=crearGridElemento(resp);
        var tEntradas=[['1','<?php echo $etj["lblIzquierda"]?>'],['2','<?php echo $etj["lblDerecha"]?>'],['3','<?php echo $etj["lblCentrado"]?>'],['4','<?php echo $etj["lblJustificado"]?>']];
        var comboAlineacion=crearComboExt('idCmbAlineacion',tEntradas,150,195);
        var arrOrden=[];
        
        var nElem=0;
        for(nElem=1;nElem<=gEx('gridConfiguracion').getStore().getCount();nElem++)
        {
        	arrOrden.push([nElem,nElem]);
        }
        if(accion=='0')
        {
        	arrOrden.push([arrOrden.length+1,arrOrden.length+1]);
        }
		
        var cmbCampoVisible=crearComboExt('cmbCampoVisible',arrSiNo,150,285,110);
        cmbCampoVisible.setValue('1');
        var cmbOrden=crearComboExt('cmbOrden',arrOrden,150,225,110);
		var form = new Ext.form.FormPanel(	
												{
													baseCls: 'x-plain',
													layout:'absolute',
													defaultType: 'textfield',
													items: 	[
																tblGrid,
                                                                {
                                                                	id:'lblAncho',
                                                                	x:10,
                                                                    y:170,
                                                                	xtype:'label',
                                                                    html:'<?php echo $etj["lblAnchoCol"]?>:<font color="red">*</font>'
                                                                },
                                                                {
                                                                	id:'txtAncho',
                                                                	x:150,
                                                                    y:165,
                                                                    xtype:'numberfield',
                                                                    allowdecimals:false,
                                                                    value:'150',
                                                                    width:80
                                                                },
                                                                {
                                                                	x:10,
                                                                    y:200,
                                                                	xtype:'label',
                                                                    html:'<?php echo $etj["lblAlineacion"]?>:<font color="red">*</font>'
                                                                },
                                                                comboAlineacion,
                                                                {
                                                                	x:10,
                                                                    y:230,
                                                                    xtype:'label',
                                                                    html:'Orden:'
                                                                },
                                                                cmbOrden,
                                                                 {
                                                                	x:10,
                                                                    y:260,
                                                                    xtype:'label',
                                                                    html:'Funcion renderer:'
                                                                },
                                                                cmbRenderer,
                                                                {
                                                                	x:10,
                                                                    y:290,
                                                                    xtype:'label',
                                                                    html:'Campo visible:'
                                                                },
                                                                cmbCampoVisible
															]
												}
											);
		
		ventanaEtiquetas = new Ext.Window(
											{
												title: '',
												width: 750,
												height:390,
												minWidth: 300,
												minHeight: 100,
												layout: 'fit',
												plain:true,
												modal:true,
												bodyStyle:'padding:5px;',
												buttonAlign:'center',
												items: form,
												listeners : {
															show : {
																		buffer : 10,
																		fn : function() 
																		{
																			pIdioma=obtenerPosFila(alNameDTD,'idIdioma',gE('hLeng').value);
																			if(pIdioma!=-1)
																			{
																				tblGrid.startEditing(pIdioma,1);
																			}
																		}
																	}
														},
												buttons:	[
																{
																	id:'btnAceptar',
																	text: lblBtnAceptar,
																	listeners:	{
																					click:function()
																						{
																							if(validarGridConf(tblGrid))
																							{
                                                                                            	if(accion==0)
                                                                                                {
                                                                                                    var idCampo=filaSel.get('idGrupoElemento');
                                                                                                    var etCampo=filaSel.get('campo');
                                                                                                }
                                                                                                else
                                                                                                {
                                                                                                	var idCampo=filaSel.get('idGrupoCampo');
                                                                                                	var etCampo=filaSel.get('etFormulario');
                                                                                                }
                                                                                                var anchoCol=Ext.getCmp('txtAncho').getValue();
                                                                                                
                                                                                                if(anchoCol=='')
                                                                                                {
                                                                                                	function resp()
                                                                                                    {
                                                                                                    	Ext.getCmp('txtAncho').focus();
                                                                                                    }
                                                                                                    Ext.MessageBox.alert('<?php echo $etj["lblAplicacion"] ?>','<?php echo $etj["lblValInv"] ?>',resp);
                                                                                                	return;
                                                                                                }
                                                                                                
                                                                                                var idAlineacion=Ext.getCmp('idCmbAlineacion').getValue();
                                                                                                if(idAlineacion=='')
                                                                                                {
                                                                                                	function respAl()
                                                                                                    {
                                                                                                    	Ext.getCmp('idCmbAlineacion').focus();
                                                                                                    }
                                                                                                    Ext.MessageBox.alert('<?php echo $etj["lblAplicacion"] ?>','Debe seleccionar la alineaci&oacute;n del elemento',respAl);
                                                                                                    return;
                                                                                                }
                                                                                                
                                                                                                

                                                                                                
                                                                                                var idIdioma=gE('hLeng').value;
                                                                                                var filaIdioma=obtenerFilaIdioma(tblGrid.getStore(),idIdioma);
                                                                                                var tCampo=filaIdioma.get('etiqueta');
                                                                                                var arrEtiqueta=obtenerValoresVentanaTitulo();
                                                                                                var objCampo='{"funcionRenderer":"'+cmbRenderer.getValue()+'","orden":"'+cmbOrden.getValue()+
                                                                                                			'","idCampo":"'+idCampo+'","etCampo":"'+etCampo+'","anchoCol":"'+anchoCol+
                                                                                                            '","tituloCampo":'+arrEtiqueta+',"accion":"'+accion+'","idAlineacion":"'+idAlineacion+
                                                                                                            '","idConfiguracion":"'+idConfiguracion+'","visible":"'+cmbCampoVisible.getValue()+'"}';
                                                                                                var txtAlineacion=Ext.getCmp('idCmbAlineacion').getRawValue();
                                                                                                
                                                                                                var gridConfiguracion=gEx('gridConfiguracion');
                                                                                                
                                                                                                function resp()
                                                                                                {
                                                                                                	var arrResp=peticion_http.responseText.split('|');
                                                                                                    if(arrResp[0]=='1')
                                                                                                    {
                                                                                                        if(idElemento=='-1')
                                                                                                        {
                                                                                                        
                                                                                                        	if(accion==0)
                                                                                                            {
                                                                                                                var nFila=new rColumna	(
                                                                                                                                            {
                                                                                                                                                idGrupoCampo:arrResp[1],
                                                                                                                                                etFormulario:etCampo,
                                                                                                                                                titulo:tCampo,
                                                                                                                                                tamColumna:anchoCol,
                                                                                                                                                alineacion:txtAlineacion,
                                                                                                                                                orden:parseInt(cmbOrden.getValue()),
                                                                                                                                                funcionRenderer:cmbRenderer.getValue()
                                                                                                                                            }
                                                                                                                                        )
                                                                                                                                        
                                                                                                                
                                                                                                                var nAux=0;
                                                                                                                var fAux;
                                                                                                                for(nAux=0;nAux<gridConfiguracion.getStore().getCount();nAux++)                        
                                                                                                                {
                                                                                                                	fAux=gridConfiguracion.getStore().getAt(nAux);
                                                                                                                    if(parseInt(fAux.data.orden)>=parseInt(cmbOrden.getValue()))
                                                                                                                    {
                                                                                                                    	fAux.set('orden',parseInt(fAux.data.orden+1));
                                                                                                                    }
                                                                                                                }
                                                                                                                                        
                                                                                                                Ext.getCmp('gridConfiguracion').getStore().add(nFila);
                                                                                                                var almacenCmb=Ext.getCmp('cmbAgrupacion').getStore();
                                                                                                                rCmb=new regCombo(
                                                                                                                                    {
                                                                                                                                        id:etCampo,
                                                                                                                                        nombre:tCampo
                                                                                                                                    }
                                                                                                                                 )
                                                                                                                almacenCmb.add(rCmb); 
                                                                                                                
                                                                                                                
                                                                                                            }
                                                                                                            else
                                                                                                            {
                                                                                                            	filaSel.set('titulo',tCampo);
                                                                                                                filaSel.set('tamColumna',anchoCol);
                                                                                                                filaSel.set('alineacion',txtAlineacion);
                                                                                                                filaSel.set('funcionRenderer',cmbRenderer.getValue());
                                                                                                                var nAux=0;
                                                                                                                var fAux;
                                                                                                                
                                                                                                                if(parseInt(filaSel.data.orden)!=parseInt(cmbOrden.getValue()))
                                                                                                                {
                                                                                                                	if(parseInt(filaSel.data.orden)>parseInt(cmbOrden.getValue()))
                                                                                                                    {
                                                                                                                        for(nAux=0;nAux<gridConfiguracion.getStore().getCount();nAux++)                        
                                                                                                                        {
                                                                                                                            fAux=gridConfiguracion.getStore().getAt(nAux);
                                                                                                                            if((parseInt(fAux.data.orden)>=parseInt(cmbOrden.getValue()))&&(parseInt(fAux.data.orden)<parseInt(filaSel.data.orden)))
                                                                                                                            {
                                                                                                                                fAux.set('orden',parseInt(fAux.data.orden+1));
                                                                                                                            }
                                                                                                                        }
                                                                                                                    }
                                                                                                                    else
                                                                                                                    {
                                                                                                                    	for(nAux=0;nAux<gridConfiguracion.getStore().getCount();nAux++)                        
                                                                                                                        {
                                                                                                                            fAux=gridConfiguracion.getStore().getAt(nAux);
                                                                                                                           	if((parseInt(fAux.data.orden)>=parseInt(filaSel.data.orden))&&(parseInt(fAux.data.orden)<=parseInt(cmbOrden.getValue())))
                                                                                                                            {
                                                                                                                                fAux.set('orden',parseInt(fAux.data.orden-1));
                                                                                                                            }
                                                                                                                        }
                                                                                                                    }
																												}                                                                                                                
                                                                                                                
                                                                                                                filaSel.set('orden',parseInt(cmbOrden.getValue()));
                                                                                                                cmbAgrupacion=Ext.getCmp('cmbAgrupacion');
                                                                                                                var dSetAgrupacion=cmbAgrupacion.getStore();
                                                                                                                var pos=obtenerPosFila(dSetAgrupacion,'id',filaSel.get('etFormulario'));
                                                                                                                
                                                                                                                var filaAgrupacion=dSetAgrupacion.getAt(pos);
                                                                                                                filaAgrupacion.set('nombre',tCampo);
                                                                                                            }
                                                                                                            
                                                                                                            gridConfiguracion.getStore().sort('orden','ASC');
                                                                                                            
                                                                                                            ventanaEtiquetas.close();
                                                                                                            generarTabla();
                                                                                                        }
                                                                                                    }
                                                                                                    else
                                                                                                    {
                                                                                                        msgBox('<?php echo $etj["errOperacion"]?>'+' <br />'+arrResp[0]);
                                                                                                    }
                                                                                                
                                                                                                }
                                                                                                obtenerDatosWeb('../paginasFunciones/funcionesFormulario.php',resp, 'POST','funcion=6&objCampo='+objCampo,true);
																							}
																						}
																				}
																},
																{
																	text: '<?php echo $etj["lblBtnCancelar"]?>',
																	handler:function()
																			{
                                                                            	ventanaEtiquetas.close();
//																				destruirVentanas();
                                                                                
																			}
																}
															]
											}
										);
                                        
                                        
        /*if((tipoProceso>1)&&(formPrincipal=='1'))
        {
        	Ext.getCmp('txtAncho').hide();
            Ext.getCmp('lblAncho').hide();
            
        }  */                              
		if(accion==0)
        {
			ventanaEtiquetas.show();
            cmbOrden.setValue(gEx('gridConfiguracion').getStore().getCount()+1);
            cmbRenderer.setValue(filaSel.data.funcionRenderer);
            
            
        }
        else
        {
        	cmbOrden.setValue(filaSel.data.orden);
            cmbRenderer.setValue(filaSel.data.funcionRenderer);
        	llenarDatosConfCampo(filaSel.get('idGrupoCampo'),ventanaEtiquetas);
        }
		
	}
	obtenerDatosWeb('../paginasFunciones/funciones.php',obtenerIdiomas, 'POST','funcion=4',true);
}

function validarGridConf(tblGrid)
{
	var res=validarCampos(tblGrid);
	switch(res)
	{
		case 0: //Sin problemas
			return true;	
		break;
		case 1: //Algun campo obligatorio del idioma original no fue ingresado
		
			function funcAceptar()
			{
				tblGrid.startEditing(filaError,celdaError);
				return false;
			}
			Ext.Msg.alert('<?php echo $etj["lblAplicacion"] ?>','<?php echo $etj["msgErrorCeldaVacia"] ?>',funcAceptar);
			
		break;
		case 2: //Algun campo obligatorio de idioma NO original fue ingresado
			function funcConfirmacion(btn)
			{
				if(btn=='yes')
				{
					var dSet=tblGrid.getStore();
					var fIdioma=obtenerFilaIdioma(dSet,gE('hLeng').value);
					var cModelo=tblGrid.getColumnModel();
					var campo='';
					var valor='';
					var col;
					for(col=0;col<cModelo.getColumnCount();col++)
					{
						campo=cModelo.getDataIndex(col);
						valor=fIdioma.get(campo);
						if(valor!='')
						{
							rellenarValoresVacios(dSet,campo,'['+valor+']');
						}
					}
					
					
					
					Ext.getCmp('btnAceptar').fireEvent('click');
				}
				else
					return false;
			}
			Ext.MessageBox.confirm('<?php echo $etj["lblAplicacion"] ?>', '<?php echo $etj["msgErrorOpcionV"] ?>', funcConfirmacion);
		break;
	}
}

function validarCampos(tblGrid)		
{
	var idIdioma=gE('hLeng').value;
	var dSet=tblGrid.getStore();
	var fila=obtenerFilaIdioma(dSet,idIdioma);
	
	if(fila!=null)
	{
		var cModelo=tblGrid.getColumnModel();
		var tituloColumna='';
		var campo;
		var valor;
		var posFila=obtenerPosFila(dSet,'idIdioma',idIdioma);
		var arrCampos='';
		
		for(x=0;x<cModelo.getColumnCount();x++)
		{
			tituloColumna=cModelo.getColumnHeader(x);
			if(tituloColumna.indexOf('*')>=0)
			{
				
				campo=cModelo.getDataIndex(x);
				valor=fila.get(campo);
				if(arrCampos=='')
					arrCampos=campo;
				else
					arrCampos+='|'+campo;
				if(valor.trim()=='')
				{
					filaError=posFila;
					celdaError=x;
					return 1;	
				}
			}
		}
		aCampo=arrCampos.split('|');
		for(x=0;x<dSet.getCount();x++)
		{
			if(x!=posFila)
			{
				fila=dSet.getAt(x);
				for(y=0;y<aCampo.length;y++)
				{
					valor=fila.get(aCampo[y]);
					if(valor.trim()=='')
					{
						filaError=posFila;
						celdaError=x;
						return 2;
					}
				}
			}
		}
	}
	return 0;
}

function crearGridElemento(datos)
{
	tituloElemento='<?php echo $etj["lblTituloC"] ?>';

	var dsNameDTD= 	[];					
    alNameDTD=		new Ext.data.SimpleStore(
    											{
    												fields:	[
    															{name: 'idioma'},
																{name: 'idIdioma'},
																{name: 'etiqueta'},
                                                                {name: 'idCamposGrid'}
    														]
    											}
    										);
    alNameDTD.loadData(dsNameDTD);
	llenarDatos(datos);
	
	var cmFrmDTD= new Ext.grid.ColumnModel   	(
												 	[
													 	{
															header:'<?php echo $etj["lblLenguaje"]?>',
															width:80,
															dataIndex:'idioma',
															renderer: cambiarColor
														},
														{
															header:tituloElemento+' *',
															width:600,
															dataIndex:'etiqueta',
															editor: new Ext.form.TextField   (
																									{
																									   style: 'text-align:left'
																									}
																								)
														}
													]
												);
											
	tblFrmDTD=	new Ext.grid.EditorGridPanel	(
                                                    {
                                                    	id:'gridEtiquetas',
                                                        store:alNameDTD,
                                                        frame:false,
                                                        stripeRows :true,
                                                        border:true,    
                                                        columnLines : true,
                                                        clicksToEdit: 1,
                                                        cm: cmFrmDTD,
                                                        height:150,
                                                        width:720
                                                    }
							                    );
	
	return tblFrmDTD;	
}	

function llenarDatos(datos)
{
	for (x=0;x<datos.length;x++)
	{
		
		var FilaRegistro = new rgIdiomas(
                                            {
                                                    idioma:datos[x].imagen,
                                                    idIdioma: datos[x].idIdioma,
                                                    etiqueta: '',
                                                    idCamposGrid:-1
                                               }
                                          );
                                                  
        alNameDTD.add(FilaRegistro); 
	}
}

function destruirVentanas()
{
	if(ventanaAM!=null)
    {
    	ventanaAM.close();
        ventanaAM.destroy();
        ventanaAM=null;
    }	
    
    if(ventanaAC!=null)
    {
    	ventanaAC.close();
        ventanaAC.destroy();
        ventanaAC=null;
    }	
    
    if(ventanaEtiquetas!=null)
    {
    	ventanaEtiquetas.close();
        ventanaEtiquetas.destroy();
        ventanaEtiquetas=null;
    }
    
}

function obtenerValoresVentanaTitulo()
{
	var dsGrid=Ext.getCmp('gridEtiquetas').getStore();
    var fila;
	var idIdioma;
	var etiqueta;
    var idCamposGrid;
   
	var arrObj="";
	var obj;
	var x;
    var arrEtiqueta;
    for(x=0;x<dsGrid.getCount();x++)
	{
		fila=dsGrid.getAt(x);
		idIdioma=fila.get('idIdioma');
		etiqueta=fila.get('etiqueta');
        idCamposGrid=fila.get('idCamposGrid');
        
		obj='{"idIdioma":"'+idIdioma+'","etiqueta":"'+cv(etiqueta)+'","idCamposGrid":'+idCamposGrid+'}';
		if(arrObj=="")
			arrObj=obj;
		else
			arrObj+=','+obj;
	}
    arrEtiqueta='['+arrObj+']';

	return arrEtiqueta;
}

function generarTabla()
{
	var almacen=Ext.getCmp('gridConfiguracion').getStore();
    var x=0;
    var numFilas=almacen.getCount();
    var filas;
    var columnas='';
    camposJava=new Array();
    columnasJava=new Array();
    var formPrincipal=gE('formPrincipal').value;
    if((tipoProceso<2)||(formPrincipal=='0'))
    {
        columnasJava[0]=new  Ext.grid.RowNumberer();
        camposJava[0]={name: 'idRegistro' };
        for(x=0;x<numFilas;x++)
        {
            filas=almacen.getAt(x);
            numCampo=x+1;
            camposJava[numCampo]={name:'campo_'+numCampo};
            
            columnasJava[numCampo]={								
                                        header:filas.get('titulo'),
                                        width:parseInt(filas.get('tamColumna')),
                                        sortable:true,
                                        dataIndex:'campo_'+numCampo,
                                        align:'left',
                                        resizable:false
                                    };
        }
        var tblRegistro=gE('tblRegistros');
        tblRegistro.parentNode.removeChild(tblRegistro);
        var tblContenedor=gE('tdTblRegistro');
        var nuevoTbl=document.createElement('div');
        nuevoTbl.id='tblRegistros';
        tblContenedor.appendChild(nuevoTbl);
        crearTablaRegistros();
	}
    else
    {
    	var span=gE('divTablaReg');
        var tabla='<table>';
        var clase='esquinaFicha';
        var filaTbl='';
        var alineacion;
    	for(x=0;x<numFilas;x++)
        {
            filas=almacen.getAt(x);
            switch(filas.get('alineacion'))
            {
            	case 'Centrado':
                	alineacion='center';
                break;
                case 'Derecha':
                	alineacion='right';
                break;
                case 'Izquierda':
                	alineacion='left';
                break;
                case 'Justificado':
                	alineacion='justify';
                break;
            }
            titulo=filas.get('titulo');
            filaTbl='<tr><td align="left" width="210" class="'+clase+'"><span class="corpo8_bold">'+titulo+'</span></td>'+
            			'<td width="440" class="valorFicha" align="'+alineacion+'" ><span class="corpo8">['+titulo+']</span></td></tr>';
            clase='etiquetaFicha';
            tabla+=filaTbl;
            
        }
        tabla+='</table><span id="tblInfoComplementario"></span>';
        span.innerHTML=tabla;
        redibujarTblComplementario();
    }

}

function llenarDatosConfCampo(idGrupoCampo)
{
	function resp()
    {
    	var arrResp=peticion_http.responseText.split('|');
        if(arrResp[0]=='1')
        {
        	var resp=eval(arrResp[1]);
            var obj=resp[0];
            var tamCol=obj.tamColumna;
            var arrTitulos=obj.arrTitulos;
            var idAlineacion=obj.idAlineacion;
            gEx('cmbCampoVisible').setValue(obj.visible);
            
            Ext.getCmp('txtAncho').setValue(tamCol);
            Ext.getCmp('gridEtiquetas').getStore().loadData(arrTitulos);
            Ext.getCmp('idCmbAlineacion').setValue(idAlineacion);
           	ventanaEtiquetas.show();
        }
        else
        {
            msgBox('<?php echo $etj["errOperacion"]?>'+' <br />'+arrResp[0]);
        }
    }
	obtenerDatosWeb('../paginasFunciones/funcionesFormulario.php',resp, 'POST','funcion=8&idGrupoCampo='+idGrupoCampo,true);
}

var camposJava=new Array( <?php echo $campos; ?>);

var columnasJava=new Array(<?php echo $columnModel; ?>);

function crearTablaRegistros()
{
	
	var datos=[['','','']];
	var dsTablaRegistros= new Ext.data.SimpleStore	(
                                                        {
                                                            fields:camposJava
                                                                    
                                                        }
                                                    );
	
    dsTablaRegistros.loadData(datos);
	
    var modelColumn= new Ext.grid.ColumnModel   	(
												 		columnasJava
													);



	
	var gridRegistros=	new Ext.grid.GridPanel	(
                                                  {
                                                  	  
                                                      store:dsTablaRegistros,
                                                      frame:false,
                                                      border:false,
                                                      cm: modelColumn,
                                                      height:330,
                                                      width:960,
                                                      stripeRows :true,
                                                      columnLines : true,
                                                      
                                                      trackMouseOver:false,
                                                      disableSelection:true,
                                                      loadMask: true,
                                                      tbar:	[
                                                      			
                                                      			{
                                                                	id:'btnAgregarLabel1',
                                                                	icon:'../images/add.png',
                                                                	text:bD(gE('btnAgregarLabel').value),
                                                                    handler:function()
                                                                    		{
                                                                            	mostrarVentanaEditarBotonAccion(1);
                                                                            }
                                                                    
                                                                },'-',
                                                                {
                                                                	id:'btnVerLabel1',
                                                                	icon:'../images/book_open.png',
                                                                	text:bD(gE('btnVerLabel').value),
                                                                    handler:function()
                                                                    		{
                                                                            	mostrarVentanaEditarBotonAccion(2);
                                                                            }
                                                                    
                                                                },
                                                                '-',
                                                      			{
                                                                	id:'btnModificarLabel1',
                                                                	icon:'../images/pencil.png',
                                                                	text:bD(gE('btnModificarLabel').value),
                                                                    handler:function()
                                                                    		{
                                                                            	mostrarVentanaEditarBotonAccion(3);
                                                                            }
                                                                    
                                                                },
                                                                '-',
                                                                {
                                                                	id:'btnEliminarLabel1',
                                                                	icon:'../images/delete.png',
                                                                	text:bD(gE('btnEliminarLabel').value),
                                                                    handler:function()
                                                                    		{
                                                                            	mostrarVentanaEditarBotonAccion(4);
                                                                            }
                                                                }
                                                      		],
                                                      
                                                      bbar: new Ext.PagingToolbar	(
                                                                                      {
                                                                                            pageSize: 2,
                                                                                            store: dsTablaRegistros,
                                                                                            displayInfo: true,
                                                                                            displayMsg: '{0} - {1} of {2}',
                                                                                            emptyMsg: "No vaco",
                                                                                            disabled:true
                                                                                    	}
                                                                                     )

                                                  }
                                              );
                                              
                                              
															                                            
                                              

	
    
                                              
	new Ext.Panel	(
    					{
                        	 height:480,
                             width:1000,
                             layout:'absolute',
                             border:true,
                             renderTo:'tblRegistros',
                             tbar:	[
                             			{
                                            icon:'../images/salir.gif',
                                            cls:'x-btn-text-icon',
                                            text:'Salir',
                                            handler:function()
                                                    {
                                                        regresarPagina()
                                                    }
                                            
                                        },'-',
                             			{
                                            icon:'../images/page_white_gear.png',
                                            cls:'x-btn-text-icon',
                                            text:'Reconfigurar el Listado de Registros',
                                            handler:function()
                                                    {
                                                        configurarGrid()
                                                    }
                                            
                                        },
                                        '-',
                                        {
                                            icon:'../images/filtro.png',
                                            cls:'x-btn-text-icon',
                                            text:'&nbsp;&nbsp;Admon. de Filtros Globales',
                                            handler:function()
                                                    {
                                                        mostrarVentanaAdmonFiltros();
                                                    }
                                            
                                        },
                                        '-',
                                        {
                                            icon:'../images/database_table.png',
                                            cls:'x-btn-text-icon',
                                            text:'&nbsp;&nbsp;Admon. de &Iacute;ndices',
                                            handler:function()
                                                    {
                                                        mostrarVentanaIndices();
                                                    }
                                            
                                        }    
                             		],
                             items:	[
                             			new Ext.Panel	(
                                        					{
                                                            	x:30,
                                                                y:35,
                                                            	width:960,
                                                                height:360,
                                                            	<?php
																	if($arrFiltros!="")
																	{
																 ?>
																 tbar:	[
																			<?php echo $arrFiltros?>
																		],
																 <?php
																	}
																 ?>
                                                            
                                                            	items:	[
                                                                			gridRegistros
                                                                		]
                                                                
                                                            }
                                        				)
                             		]
                             
                             
                            
                        }
    				)                                              
                                              
	                                            
}

///

function mostrarVentanaIndices()
{
	var gridIndices=crearGridIndices();
	var form = new Ext.form.FormPanel(	
										{
											baseCls: 'x-plain',
											layout:'absolute',
											defaultType: 'label',
											items: 	[
														gridIndices

													]
										}
									);
	
	var ventanaAM = new Ext.Window(
									{
										title: 'Administraci&oacute;n de &iacute;ndices',
										width: 700,
										height:450,
										layout: 'fit',
										plain:true,
										modal:true,
										bodyStyle:'padding:5px;',
										buttonAlign:'center',
										items: form,
										listeners : {
													show : {
																buffer : 10,
																fn : function() 
																{
																}
															}
												},
										buttons:	[
														
														{
															text: '<?php echo $etj["lblBtnAceptar"]?>',
															handler:function()
																	{
																		ventanaAM.close();
																	}
														}
													]
									}
								);
	ventanaAM.show();
}

function crearGridIndices()
{
	 var lector= new Ext.data.JsonReader({
                                            
                                            totalProperty:'numReg',
                                            fields: [
                                               			
		                                                {name: 'etiqueta'},
		                                                {name:'camposAsociadosLbl'},
                                                        {name:'camposAsociadosID'}
                                            		],
                                            root:'registros'
                                            
                                        }
                                      );
	 
                                                                                      
	var alDatos=new Ext.data.GroupingStore({
                                                            reader: lector,
                                                            proxy : new Ext.data.HttpProxy	(

                                                                                              {

                                                                                                  url: '../paginasFunciones/funcionesFormulario.php'

                                                                                              }

                                                                                          ),
                                                            sortInfo: {field: 'etiqueta', direction: 'ASC'},
                                                            groupField: 'etiqueta',
                                                            remoteGroup:false,
				                                            remoteSort: false,
                                                            autoLoad:true
                                                            
                                                        }) 
	alDatos.on('beforeload',function(proxy)
    								{
                                    	proxy.baseParams.funcion='212';
                                        proxy.baseParams.idFormulario=<?php echo $idFormulario?>;
                                    }
                        )   
       
        var cModelo= new Ext.grid.ColumnModel   	(
                                                        [
                                                            new  Ext.grid.RowNumberer(),
                                                            
                                                            {
                                                                header:'&Iacute;ndice',
                                                                width:150,
                                                                sortable:true,
                                                                dataIndex:'etiqueta',
                                                                renderer:mostrarValorDescripcion
                                                            },
                                                            
                                                            
                                                            
                                                            {
                                                                header:'Campos asociados',
                                                                width:400,
                                                                sortable:true,
                                                                dataIndex:'camposAsociadosLbl',
                                                                renderer:mostrarValorDescripcion
                                                            }
                                                        ]
                                                    );
                                                    
        var tblGrid=	new Ext.grid.GridPanel	(
                                                            {
                                                                id:'gIndices',
                                                                store:alDatos,
                                                                region:'center',
                                                                frame:false,
                                                                border:true,
                                                                width:650,
                                                                height:350,
                                                                x:10,
                                                                y:10,
                                                                tbar:	[
                                                                			{
                                                                                icon:'../images/add.png',
                                                                                cls:'x-btn-text-icon',
                                                                                text:'Crear &iacute;ndice',
                                                                                handler:function()
                                                                                        {
                                                                                            mostrarVentanaIndice();
                                                                                        }
                                                                                
                                                                            },'-',
                                                                            {
                                                                                icon:'../images/pencil.png',
                                                                                cls:'x-btn-text-icon',
                                                                                text:'Modificar &iacute;ndice',
                                                                                handler:function()
                                                                                        {
                                                                                            var fila=tblGrid.getSelectionModel().getSelected();
                                                                                            if(!fila)
                                                                                            {
                                                                                            	msgBox('Debe seleccionar el &iacute;ndice que desea modificar');
                                                                                            	return;
                                                                                            }
                                                                                            mostrarVentanaIndice(fila);
                                                                                            
                                                                                        }
                                                                                
                                                                            },'-',
                                                                            {
                                                                                icon:'../images/delete.png',
                                                                                cls:'x-btn-text-icon',
                                                                                text:'Remover &iacute;ndice',
                                                                                handler:function()
                                                                                        {
                                                                                            var fila=tblGrid.getSelectionModel().getSelected();
                                                                                            if(!fila)
                                                                                            {
                                                                                            	msgBox('Debe seleccionar el &iacute;ndice que desea remover');
                                                                                            	return;
                                                                                            }
                                                                                            
                                                                                            
                                                                                            function resp(btn)
                                                                                            {
                                                                                            	if(btn=='yes')
                                                                                                {
                                                                                                	function funcAjax()
                                                                                                    {
                                                                                                        var resp=peticion_http.responseText;
                                                                                                        arrResp=resp.split('|');
                                                                                                        if(arrResp[0]=='1')
                                                                                                        {
                                                                                                            tblGrid.getStore().remove(fila);
                                                                                                        }
                                                                                                        else
                                                                                                        {
                                                                                                            msgBox('<?php echo $etj["errOperacion"]?>'+' <br />'+arrResp[0]);
                                                                                                        }
                                                                                                    }
                                                                                                    obtenerDatosWeb('../paginasFunciones/funcionesFormulario.php',funcAjax, 'POST','funcion=213&idFormulario=<?php echo $idFormulario?>&indice='+fila.data.etiqueta,true);
                                                                                                    
                                                                                                }
                                                                                            }
                                                                                            msgConfirm('Est&aacute; seguro de querer remover el &iacute;ndice <b>'+fila.data.etiqueta+'</b>',resp);
                                                                                            
                                                                                            
                                                                                        }
                                                                                
                                                                            }
                                                                		],
                                                                cm: cModelo,
                                                                stripeRows :true,
                                                                loadMask:true,
                                                                columnLines : true,
                                                                view:new Ext.grid.GroupingView({
                                                                                                    forceFit:false,
                                                                                                    showGroupName: false,
                                                                                                    enableGrouping :false,
                                                                                                    enableNoGroups:false,
                                                                                                    enableGroupingMenu:false,
                                                                                                    hideGroupedColumn: false,
                                                                                                    startCollapsed:false
                                                                                                })
                                                            }
                                                        );
        return 	tblGrid;	
}


function mostrarVentanaIndice(fila)
{
	var gridCamposIndices=crearGridCamposIndice();
    var gridCamposTabla=crearGridCamposTabla();
	var form = new Ext.form.FormPanel(	
										{
											baseCls: 'x-plain',
											layout:'absolute',
											defaultType: 'label',
											items: 	[
														{
                                                        	x:10,
                                                            y:10,
                                                            html:'Nombre Indice:'
                                                        },
                                                        {
                                                        	x:130,
                                                            y:5,
                                                            xtype:'textfield',
                                                            value:(fila?fila.data.etiqueta:''),
                                                            id:'txtNombreIndice',
                                                            maskRe :/[0-9a-zA-Z]/,
                                                            width:350
                                                        },
                                                        {
                                                        	x:435,
                                                            y:125,
                                                            border:false,
                                                            xtype:'panel',
                                                            width:40,
                                                            layout:'absolute',
                                                            height:60,
                                                            baseCls: 'x-plain',
                                                            items:	[
                                                            			{
                                                                        	xtype:'button',
                                                                            width:40,
                                                                            height:18,
                                                                            x:0,
                                                                            y:0,
                                                                            icon:'../images/left1.png',
                                                                            cls:'x-btn-text-icon',
                                                                            handler:function()
                                                                            		{
                                                                                    	var gridCamposTabla=gEx('gridCamposTabla');
                                                                                        var gridCamposIndices=gEx('gridCamposIndices');
                                                                                    	var filas=gridCamposTabla.getSelectionModel().getSelections();
                                                                                        var x;
                                                                                        var f;
                                                                                        var nRegistros=gridCamposIndices.getStore().getCount()+1;
                                                                                        var r;
                                                                                        for(x=0;x<filas.length;x++)
                                                                                        {
                                                                                        	f=filas[x];
                                                                                        	r=new rCampoIndice	(
                                                                                            						{
                                                                                                                    	idCampo:f.data.idCampo,
                                                                                                                        campo:f.data.campo,
                                                                                                                        orden:nRegistros
                                                                                                                    }		
                                                                                            					)
                                                                                            gEx('gridCamposIndices').getStore().add(r);
                                                                                        	nRegistros++;
                                                                                        }
                                                                                        
                                                                                        
                                                                                        gridCamposIndices.getStore().sort('orden','ASC');
                                                                                        
                                                                                        gridCamposTabla.getStore().remove(filas);
                                                                                        
                                                                                        
                                                                                    }
                                                                        },
                                                                        {
                                                                        	xtype:'button',
                                                                            width:40,
                                                                            height:18,
                                                                            x:0,
                                                                            y:30,
                                                                            icon:'../images/right1.png',
                                                                            cls:'x-btn-text-icon',
                                                                            handler:function()
                                                                            		{
                                                                                    	var gridCamposIndices=gEx('gridCamposIndices');
                                                                                    	var filas=gridCamposIndices.getSelectionModel().getSelections();
                                                                                        
                                                                                        var x;
                                                                                        var f;
                                                                                        var r;
                                                                                        for(x=0;x<filas.length;x++)
                                                                                        {
                                                                                        	f=filas[x];
                                                                                        	r=new rCampoTabla	(
                                                                                            						{
                                                                                                                    	idCampo:f.data.idCampo,
                                                                                                                        campo:f.data.campo
                                                                                                                    }		
                                                                                            					)
                                                                                            gEx('gridCamposTabla').getStore().add(r);
                                                                                        	
                                                                                        }
                                                                                        
                                                                                        gridCamposIndices.getStore().remove(filas);
                                                                                        for(x=0;x<gridCamposIndices.getStore().getCount();x++)                                                                                               
                                                                                        {
                                                                                            f=gridCamposIndices.getStore().getAt(x);
                                                                                            f.set('orden',(x+1));
                                                                                        }
                                                                                    	
                                                                                    	gEx('gridCamposIndices').getStore().sort('orden','ASC');
                                                                                    
                                                                                    }
                                                                        }
                                                            		]
                                                        
                                                        },
                                                        gridCamposIndices,
                                                        gridCamposTabla

													]
										}
									);
	
	var ventanaAM = new Ext.Window(
									{
										title: fila?'Modificar &iacute;ndice':'Crear &iacute;ndice',
										width: 900,
										height:350,
										layout: 'fit',
										plain:true,
										modal:true,
										bodyStyle:'padding:5px;',
										buttonAlign:'center',
										items: form,
										listeners : {
													show : {
																buffer : 10,
																fn : function() 
																{
                                                                	gEx('txtNombreIndice').setValue((fila?fila.data.etiqueta:'idx_<?php echo $idFormulario?>_'+generarNumeroAleatorio(1,10000)));
                                                                	gEx('txtNombreIndice').focus(false,500);
																}
															}
												},
										buttons:	[
														{
															
															text: '<?php echo $etj["lblBtnAceptar"]?>',
                                                            
															handler: function()
																	{
                                                                    	var txtNombreIndice=gEx('txtNombreIndice');
                                                                        
                                                                        if(txtNombreIndice.getValue()=='')
                                                                        {
                                                                        	function resp()
                                                                            {
                                                                            	txtNombreIndice.focus();
                                                                            }
                                                                            msgBox('Debe indicar el nombre del &iacute;ndice',resp);
                                                                            return;
                                                                        }
                                                                        
                                                                        var idIndice=(fila?fila.data.idIndice:-1);
                                                                        var gIndices=gEx('gIndices').getStore();
                                                                        
                                                                        
                                                                        
																		if(gridCamposIndices.getStore().getCount()==0)
                                                                        {
                                                                        	msgBox('Almenos debe indicar un campo sobre el cual ser&aacute; creado el &iacute;ndice')
                                                                        	return;
                                                                        }
                                                                        
                                                                        var listaCampos='';
                                                                        var x;
                                                                        var f;
                                                                        for(x=0;x<gridCamposIndices.getStore().getCount();x++)
                                                                        {
                                                                        	f=gridCamposIndices.getStore().getAt(x);
                                                                            
                                                                            if(listaCampos=='')
                                                                            	listaCampos=f.data.idCampo;
                                                                            else
                                                                            	listaCampos+=','+f.data.idCampo;
                                                                            
                                                                        }
                                                                        
                                                                        var cadObj='{"idFormulario":"<?php echo $idFormulario?>","nombreIndice":"'+(fila?fila.data.etiqueta:'')+'","nombre":"'+cv(txtNombreIndice.getValue())+'","campos":"'+listaCampos+'"}';
                                                                        function funcAjax()
                                                                        {
                                                                            var resp=peticion_http.responseText;
                                                                            arrResp=resp.split('|');
                                                                            if(arrResp[0]=='1')
                                                                            {
                                                                                gEx('gIndices').getStore().reload();
                                                                                ventanaAM.close();
                                                                            }
                                                                            else
                                                                            {
                                                                                msgBox('<?php echo $etj["errOperacion"]?>'+' <br />'+arrResp[0]);
                                                                            }
                                                                        }
                                                                        obtenerDatosWeb('../paginasFunciones/funcionesFormulario.php',funcAjax, 'POST','funcion=211&cadObj='+cadObj,true);
                                                                        
                                                                        
                                                                        
																	}
														},
														{
															text: '<?php echo $etj["lblBtnCancelar"]?>',
															handler:function()
																	{
																		ventanaAM.close();
																	}
														}
													]
									}
								);
	ventanaAM.show();
    
    
    	
    var arrCamposIndice=[];
    var arrCamposDiponibles=[];
    
    var x;
    var pos;
    
    if(fila)
    {
        var aCamposIndice=fila.data.camposAsociadosID.split(',');
       	
       	for(x=0;x<aCamposIndice.length;x++) 
        {
        	pos=existeValorMatriz(arrControles,aCamposIndice[x]);
            
            if(pos==-1)
            {
            	arrCamposIndice.push([aCamposIndice[x],aCamposIndice[x],(x+1)]);
            }
            else
            {
            	arrCamposIndice.push([arrControles[pos][0],arrControles[pos][1],(x+1)]);
            }

       	}
       
    }


	var aControlesAux=[['id__<?php echo $idFormulario?>_tablaDinamica','id__<?php echo $idFormulario?>_tablaDinamica']];
	for(x=0;x<arrControles.length;x++)
    {
    	aControlesAux.push([arrControles[x][0],arrControles[x][1]]);
    }
    for(x=0;x<aControlesAux.length;x++)
    {
    	pos=existeValorMatriz(arrCamposIndice,aControlesAux[x][0]);
        if(pos==-1)
	    	arrCamposDiponibles.push([aControlesAux[x][0],aControlesAux[x][1]]);
    }
    
    gridCamposTabla.getStore().loadData(arrCamposDiponibles);
    gEx('gridCamposIndices').getStore().loadData(arrCamposIndice);
}

function crearGridCamposIndice()
{
	var dsDatos=[];
    var alDatos=	new Ext.data.SimpleStore	(
                                                    {
                                                        fields:	[
                                                        			{name: 'idCampo'},
                                                                    {name: 'campo'},
                                                                    {name: 'orden',type:'int'}
                                                                    
                                                                ]
                                                    }
                                                );

    alDatos.loadData(dsDatos);
	var chkRow=new Ext.grid.CheckboxSelectionModel();
	
	var cModelo= new Ext.grid.ColumnModel   	(
												 	[
													 	new  Ext.grid.RowNumberer(),
														chkRow,
														{
															header:'Campo',
															width:270,
															sortable:true,
															dataIndex:'campo'
														},
														{
															header:'Orden',
															width:70,
															sortable:true,
															dataIndex:'orden'
														}
													]
												);
                                                
	var tblGrid=	new Ext.grid.EditorGridPanel	(
                                                        {
                                                            id:'gridCamposIndices',
                                                            store:alDatos,
                                                            frame:false,
                                                            border:true,
                                                            y:40,
                                                            x:10,
                                                            title:'Campos del &iacute;ndice',
                                                            cm: cModelo,
                                                            stripeRows :true,
                                                            loadMask:true,
                                                            stripeRows :true,
                                                            columnLines : true,
                                                            height:230,
                                                            width:420,
                                                            sm:chkRow,
                                                            tbar:	[
                                                            			{
                                                                        	xtype:'label',
                                                                            html:'&nbsp;<b>Modificar orden:&nbsp;&nbsp;</b>'
                                                                        },'-',
                                                                        {
                                                                        	icon:'../images/SignUp.gif',
                                                                            handler:function()
                                                                            		{
                                                                                    	var fila=tblGrid.getSelectionModel().getSelected();
                                                                                        if(!fila)
                                                                                        {
                                                                                        	msgBox('Debe seleccionar el campo cuyo orden desea modificar');
                                                                                        	return;
                                                                                        }
                                                                                        if(fila.data.orden>1)
                                                                                        {
                                                                                        	var filaAux=tblGrid.getStore().getAt(fila.data.orden-2);
                                                                                            fila.data.orden-=1;
                                                                                            filaAux.data.orden+=1;
                                                                                            tblGrid.getStore().sort('orden','ASC');
                                                                                        }
                                                                                    	
                                                                                    }
                                                                            
                                                                        },'-',
                                                                        {
                                                                        	icon:'../images/SignDown.gif',
                                                                            handler:function()
                                                                            		{
                                                                                    	var fila=tblGrid.getSelectionModel().getSelected();
                                                                                        if(!fila)
                                                                                        {
                                                                                        	msgBox('Debe seleccionar el campo cuyo orden desea modificar');
                                                                                        	return;
                                                                                        }
                                                                                        if(fila.data.orden<tblGrid.getStore().getCount())
                                                                                        {
                                                                                        	var filaAux=tblGrid.getStore().getAt(fila.data.orden);
                                                                                            fila.data.orden+=1;
                                                                                            filaAux.data.orden-=1;
                                                                                            tblGrid.getStore().sort('orden','ASC');
                                                                                        }
                                                                                    	
                                                                                    }
                                                                            
                                                                        }
                                                                        
                                                            		]
                                                        }
                                                    );
	return 	tblGrid;	
}

function crearGridCamposTabla()
{
	var dsDatos=[];
    var alDatos=	new Ext.data.SimpleStore	(
                                                    {
                                                        fields:	[
                                                        			{name: 'idCampo'},
                                                                    {name: 'campo'}
                                                                    
                                                                ]
                                                    }
                                                );

    alDatos.loadData(dsDatos);
	var chkRow=new Ext.grid.CheckboxSelectionModel();
	
	var cModelo= new Ext.grid.ColumnModel   	(
												 	[
													 	new  Ext.grid.RowNumberer(),
														chkRow,
														{
															header:'Campo',
															width:320,
															sortable:true,
															dataIndex:'campo',
                                                            renderer:mostrarValorDescripcion
														}
													]
												);
                                                
	var tblGrid=	new Ext.grid.EditorGridPanel	(
                                                        {
                                                            id:'gridCamposTabla',
                                                            store:alDatos,
                                                            title:'Campos del formulario',
                                                            y:40,
                                                            x:480,
                                                            cm: cModelo,
                                                            stripeRows :true,
                                                            loadMask:true,
                                                            stripeRows :true,
                                                            frame:false,
                                                            border:true,
                                                            columnLines : true,
                                                            height:230,
                                                            width:380,
                                                            sm:chkRow,
                                                            tbar:	[
                                                            			
                                                                        
                                                            		]
                                                        }
                                                    );
	return 	tblGrid;
}

function mostrarVentanaEditarBotonAccion(a)
{
	var titulo='';
    var idEtiqueta='';
	switch(a)
    {
    	case 1:
        	idEtiqueta='btnAgregarLabel';
        break;
        case 2:
        	idEtiqueta='btnVerLabel';
        break;
        case 3:
        	idEtiqueta='btnModificarLabel';
        break;
        case 4:
        	idEtiqueta='btnEliminarLabel';
        break;
    }

	var form = new Ext.form.FormPanel(	
										{
											baseCls: 'x-plain',
											layout:'absolute',
											defaultType: 'label',
											items: 	[
														{
                                                        	x:10,
                                                            y:10,
                                                            html:'Etiqueta:'
                                                        },
                                                        {
                                                        	x:90,
                                                            y:5,
                                                            width:300,
                                                            xtype:'textfield',
                                                            id:'txtEtiqueta',
                                                            value:bD(gE(idEtiqueta).value)
                                                        }

													]
										}
									);
	
	var ventanaAM = new Ext.Window(
									{
										title: 'Modificar bot&oacute;n de acci&oacute;n',
										width: 470,
										height:130,
										layout: 'fit',
										plain:true,
										modal:true,
										bodyStyle:'padding:5px;',
										buttonAlign:'center',
										items: form,
										listeners : {
													show : {
																buffer : 10,
																fn : function() 
																{
                                                                	gEx('txtEtiqueta').focus(false,500);
																}
															}
												},
										buttons:	[
														{
															
															text: '<?php echo $etj["lblBtnAceptar"]?>',
                                                            
															handler: function()
																	{
                                                                    	var txtEtiqueta=gEx('txtEtiqueta');
                                                                        if(txtEtiqueta.getValue()=='')
                                                                        {
                                                                        	function resp()
                                                                            {
                                                                            	txtEtiqueta.focus();
                                                                            }
                                                                        	msgBox('Debe ingresar la etiqueta del bot&oacute;n',resp)
                                                                        	return;
                                                                        }
																		function funcAjax()
                                                                        {
                                                                            var resp=peticion_http.responseText;
                                                                            arrResp=resp.split('|');
                                                                            if(arrResp[0]=='1')
                                                                            {
                                                                             	gE(idEtiqueta).value=bE(txtEtiqueta.getValue());   
                                                                                gEx(idEtiqueta+'1').setText(txtEtiqueta.getValue());
                                                                                ventanaAM.close();
                                                                            }
                                                                            else
                                                                            {
                                                                                msgBox('<?php echo $etj["errOperacion"]?>'+' <br />'+arrResp[0]);
                                                                            }
                                                                        }
                                                                        obtenerDatosWeb('../paginasFunciones/funcionesFormulario.php',funcAjax, 'POST','funcion=207&c='+idEtiqueta+'&v='+cv(txtEtiqueta.getValue())+'&iC='+gE('idConfiguracion').value,true);
                                                                        
																	}
														},
														{
															text: '<?php echo $etj["lblBtnCancelar"]?>',
															handler:function()
																	{
																		ventanaAM.close();
																	}
														}
													]
									}
								);
	ventanaAM.show();	
}

/*
var tipoCampoF;

function mostrarVentanaCondicionF(idFiltro)
{
	
	var nTabla=gE('nombreTabla').value;
	arrTokensUsr=new Array();
	arrTokensSql=new Array();
	generarGrupoCheck(nTabla,idFiltro);
    
}

var arrUnidades=<?php echo $arrUnidades?>;
var arrInstituciones=<?php echo $arrInstituciones?>;
var arrUsuario=[['@usuario','<?php echo $etj["lblUsuarioAct"]?>']];

function mostrarVentanaCondFiltro(nomTabla,checkGroup,idFiltro)
{
	var cmbCampo=crearComboGeneral('cmbCampo',null,'<?php echo $etj["lblElijaOpcion"]?>');
    cmbCampo.setPosition(10,40);
    cmbCampo.setWidth(180);
    
    function setCondicionValor(combo,registro,indice)
    {
		var nTabla=nomTabla;
        var cmbCondicion=Ext.getCmp('cmbCondicion');
        var arr;
        cmbCondicion.reset();
        tipoCampoF=registro.get('comp1');
        switch(tipoCampoF)
        {
            case'optM':
            case 'optT':
                arr=arrCombo;
                mostrarCampoF('cmbValor');
                
                Ext.getCmp('cmbValor').reset();
                llenarOpciones(registro.get('id'),nTabla);
            break;
            case 'varchar':
                arr=arrVarchar;
                Ext.getCmp('txtValor').setValue('');
                mostrarCampoF('txtValor');
            break;
            case 'int':
                arr=arrInt;
                Ext.getCmp('intValor').setValue('0');
                mostrarCampoF('intValor');
            break;
            case 'decimal':
                arr=arrInt;
                Ext.getCmp('decValor').setValue('0.0');
                mostrarCampoF('decValor');
            break;
            case 'date':
                arr=arrInt;
                mostrarCampoF('dteValor');
            break;
            case 'unidad':
            	arr=arrUnidad;
                mostrarCampoF('cmbValor');
                var cmbValor=Ext.getCmp('cmbValor')
                cmbValor.reset();
                var almacen=cmbValor.getStore();
                almacen.removeAll();
                almacen.loadData(arrUnidades);
                //llenarOpciones(registro.get('id'),nTabla);
            break;
            case 'institucion':
            	arr=arrVarchar;
                mostrarCampoF('cmbValor');
                var cmbValor=Ext.getCmp('cmbValor')
                cmbValor.reset();
                var almacen=cmbValor.getStore();
                almacen.removeAll();
                almacen.loadData(arrInstituciones);
            break;
            case 'usuario':
            	arr=arrVarchar;
                mostrarCampoF('cmbValor');
                var cmbValor=Ext.getCmp('cmbValor')
                cmbValor.reset();
                var almacen=cmbValor.getStore();
                almacen.removeAll();
                almacen.loadData(arrUsuario);
                
            break;
        }
        cmbCondicion.getStore().loadData(arr);
        cmbCondicion.focus(false,10);
    }
    
    
    cmbCampo.on('select',setCondicionValor);
    var condicion=crearComboGeneral('cmbCondicion',null,'<?php echo $etj["lblElijaOpcion"]?>');
    condicion.setPosition(200,40);
    condicion.setWidth(125);
    
    function setFocoValor(combo,registro,indice)
    {
    	switch(tipoCampoF)
        {
            case'optM':
            case 'optT':
                Ext.getCmp('cmbValor').focus(false,10);
            break;
            case 'varchar':
            	Ext.getCmp('txtValor').focus(false,10);
            break;
            case 'int':
                Ext.getCmp('intValor').focus(false,10);
            break;
            case 'decimal':
                Ext.getCmp('decValor').focus(false,10);
            break;
            case 'date':
                Ext.getCmp('dteValor').focus(false,10);
            break;
        }
    	
    }
    
    condicion.on('select',setFocoValor);
    var valor=crearComboGeneral('cmbValor',null,'<?php echo $etj["lblElijaOpcion"]?>');
    valor.setPosition(335,40);
    valor.setWidth(185);
    
    var valorTxt=new Ext.form.TextField	(
    										{
                                            	id:'txtValor',
                                                width:130,
                                                x:335,
                                                y:40,
                                                hidden:true
                                                
                                            }	
    									)
    
    var valorDte=new Ext.form.DateField	(
    										{
                                            	id:'dteValor',
                                                width:100,
                                                x:335,
                                                y:40,
                                                hidden:true
                                            }
    									)
                                        
    var valorInt= new Ext.form.NumberField	(
                                                {
                                                    id:'intValor',
                                                    width:100,
                                                    x:335,
	                                                y:40,
                                                    hidden:true,
                                                    allowDecimals:false
                                                    
                                                }	
                                            )
                                            
	var valorDec= new Ext.form.TextField	(
                                                {
                                                    id:'decValor',
                                                    width:100,
                                                    x:335,
	                                                y:40,
                                                    hidden:true,
                                                    allowDecimals:true
                                                    
                                                }	
                                            )                                                                            
    
    var fieldS=new Ext.form.FieldSet	(
    										{
	                                           	x:10,
                                                y:290,
                                            	title:'<?php echo $etj["lblAsociarFiltro"] ?>:',
                                               	autoHeight : true,
                                            	items:[	checkGroup]
                                            }
    									)
    
	var form = new Ext.form.FormPanel(	
                                        {
                                            baseCls: 'x-plain',
                                            layout:'absolute',
                                            defaultType: 'textfield',
                                            items: 	[
                                                        {
                                                            x:50,
                                                            y:15,
                                                            xtype:'label',
                                                            text:'<?php echo $etj["lblCampoF"]?>:'
                                                        },
                                                        cmbCampo,
                                                        {
                                                            x:225,
                                                            y:15,
                                                            xtype:'label',
                                                            text:'<?php echo $etj["lblCondicion"]?>:'
                                                        },
                                                        condicion,
                                                        {
                                                            x:375,
                                                            y:15,
                                                            xtype:'label',
                                                            text:'<?php echo $etj["lblValor"]?>:'
                                                        },
                                                        valor,
                                                        valorTxt,
                                                        valorDte,
                                                        valorInt,
                                                        valorDec,
                                                        {
                                                            xtype:'panel',
                                                            x:10,
                                                            y:80,
                                                            items:	[
                                                                         {
                                                                            xtype:'button',
                                                                            text:'Agregar',
                                                                            icon:'../images/mas.gif',
                                                                            cls:'x-btn-text-icon',
                                                                            handler:function()
                                                                                    {
                                                                                        if(cmbCampo.getValue()=='')
                                                                                        {
                                                                                            function resp()
                                                                                            {
                                                                                                cmbCampo.focus(false,10);
                                                                                            }
                                                                                            Ext.MessageBox.alert('<?php echo $etj["lblAplicacion"]?>','<?php echo $etj["lblDebeSelCampo"]?>',resp);
                                                                                            return;
                                                                                        }
                                                                                        var campoU=cmbCampo.getRawValue();
                                                                                        var campoM=cmbCampo.getValue();
                                                                                        var condicionU;
                                                                                        var condicionM;
                                                                                        if(condicion.getValue()=='')
                                                                                        {
                                                                                            function resp()
                                                                                            {
                                                                                                condicion.focus(false,10);
                                                                                            }
                                                                                            Ext.MessageBox.alert('<?php echo $etj["lblAplicacion"]?>','<?php echo $etj["lblDebeSelCond"]?>',resp);
                                                                                            return;
                                                                                        }
                                                                                        condicionU=condicion.getRawValue();
                                                                                        condicionM=condicion.getValue();
                                                                                        var valorU='';
                                                                                        var valorM='';
                                                                                        switch(tipoCampoF)
                                                                                        {
                                                                                        	case 'optM':
                                                                                            case 'optT':
                                                                                        	case 'unidad':
                                                                                            case 'institucion':
                                                                                            case 'usuario':
                                                                                            	if(valor.getValue()=='')
                                                                                                {
                                                                                                    function resp()
                                                                                                    {
                                                                                                        valor.focus(false,10);
                                                                                                    }
                                                                                                    Ext.MessageBox.alert('<?php echo $etj["lblAplicacion"]?>','<?php echo $etj["lblDebeSelVal"]?>',resp);
                                                                                                    return;
                                                                                                }
                                                                                                var comodin='';
                                                                                                if(condicionM.trim()=='like')
                                                                                                    comodin='%';
                                                                                                valorM="'"+valor.getValue()+comodin+"'";
                                                                                                valorU="'"+valor.getRawValue()+"'";
                                                                                            break;
                                                                                            case 'varchar':
                                                                                                valorU="'"+valorTxt.getValue()+"'";
                                                                                                valorM="'"+valorTxt.getValue()+"'";
                                                                                            break;
                                                                                            case 'int':
                                                                                                if(valorInt.getValue()=='')
                                                                                                {
                                                                                                    function resp()
                                                                                                    {
                                                                                                        valorInt.focus(false,10);
                                                                                                    }
                                                                                                    Ext.MessageBox.alert('<?php echo $etj["lblAplicacion"]?>','<?php echo $etj["lblDebeSelVal"]?>',resp);
                                                                                                    return;
                                                                                                }
                                                                                                valorU=valorInt.getValue();
                                                                                                valorM=valorInt.getValue();
                                                                                                
                                                                                            break;
                                                                                            case 'decimal':
                                                                                                if(valorDec.getValue()=='')
                                                                                                {
                                                                                                    function resp()
                                                                                                    {
                                                                                                        valorDec.focus(false,10);
                                                                                                    }
                                                                                                    Ext.MessageBox.alert('<?php echo $etj["lblAplicacion"]?>','<?php echo $etj["lblDebeSelVal"]?>',resp);
                                                                                                    return;
                                                                                                }
                                                                                                valorU=valorDec.getValue();
                                                                                                valorM=valorDec.getValue();
                                                                                            break;
                                                                                            case 'date':
                                                                                                if(valorDte.getValue()=='')
                                                                                                {
                                                                                                    function resp()
                                                                                                    {
                                                                                                        valorDte.focus(false,10);
                                                                                                    }
                                                                                                    Ext.MessageBox.alert('<?php echo $etj["lblAplicacion"]?>','<?php echo $etj["lblDebeSelVal"]?>',resp);
                                                                                                    return;
                                                                                                }
                                                                                                valorU="'"+valorDte.getValue().format('d/m/Y')+"'";
                                                                                                valorM="'"+valorDte.getValue().format('Y-m-d')+"'";
                                                                                                
                                                                                            break;
                                                                                            
                                                                                        }
                                                                                        
                                                                                        var cadM=campoM+' '+condicionM+' '+valorM;
                                                                                        var cadU=campoU+' '+condicionU+' '+valorU;
                                                                                        arrTokensUsr[arrTokensUsr.length]=cadU;
                                                                                        arrTokensSql[arrTokensSql.length]=cadM;
                                                                                        generarSentencia();
                                                                                    }
                                                                         }
                                                                    ]
                                                            
                                                        
                                                               
                                                        },
                                                        {
                                                            xtype:'panel',
                                                            x:100,
                                                            y:80,
                                                            items:	[
                                                                         {
                                                                             xtype:'button',
                                                                             text:'Remover',
                                                                             icon:'../images/menos.gif',
                                                                             cls:'x-btn-text-icon',
                                                                             handler:function()
                                                                                    {
                                                                                        if(arrTokensUsr.length>0)
                                                                                        {
                                                                                            arrTokensUsr.splice(arrTokensUsr.length-1,1);
                                                                                            arrTokensSql.splice(arrTokensSql.length-1,1);
                                                                                            generarSentencia();
                                                                                        }
                                                                                    }
                                                                         }
                                                                    ]
                                                        },
                                                        {
                                                            xtype:'panel',
                                                            x:195,
                                                            y:80,
                                                            items:	[
                                                                         {
                                                                             xtype:'button',
                                                                             text:'(',
                                                                             handler:function()
                                                                                    {
                                                                                        arrTokensUsr[arrTokensUsr.length]='(';
                                                                                        arrTokensSql[arrTokensSql.length]='(';
                                                                                        generarSentencia();
                                                                                    }
                                                                         }
                                                                    ]
                                                        },
                                                        {
                                                            xtype:'panel',
                                                            x:230,
                                                            y:80,
                                                            items:	[
                                                                         {
                                                                             xtype:'button',
                                                                             text:')',
                                                                          	 handler:function()
                                                                                    {
                                                                                        arrTokensUsr[arrTokensUsr.length]=')';
                                                                                        arrTokensSql[arrTokensSql.length]=')';
                                                                                        generarSentencia();
                                                                                    }
                                                                         }
                                                                    ]
                                                        },
                                                        
                                                        {
                                                            xtype:'panel',
                                                            x:265,
                                                            y:80,
                                                            items:	[
                                                                         {
                                                                             xtype:'button',
                                                                             text:'Y',
                                                                            handler:function()
                                                                                    {
                                                                                        arrTokensUsr[arrTokensUsr.length]='<?php echo $etj["lblY"]?>';
                                                                                        arrTokensSql[arrTokensSql.length]='AND';
                                                                                        generarSentencia();
                                                                                    }
                                                                         }
                                                                    ]
                                                        },
                                                        {
                                                            xtype:'panel',
                                                            x:300,
                                                            y:80,
                                                            items:	[
                                                                         {
                                                                             xtype:'button',
                                                                             text:'O',
                                                                             handler:function()
                                                                                    {
                                                                                        arrTokensUsr[arrTokensUsr.length]='<?php echo $etj["lblO"]?>';
                                                                                        arrTokensSql[arrTokensSql.length]='OR';
                                                                                        generarSentencia();
                                                                                    }
                                                                         }
                                                                    ]
                                                        },
                                                        {
                                                            id:'txtConsulta',
                                                            xtype:'textarea',
                                                            x:10,
                                                            y:125,
                                                            width:500,
                                                            height:150,
                                                            readOnly:true
                                                        },
                                                        fieldS
                                                    ]
                                        }
                                    );
		
	var ventanaOrigenDatosSel = new Ext.Window(
                                                {
                                                    title: '<?php echo $etj["lblTitCondF"]?>',
                                                    width: 560,
                                                    height:500,
                                                    minWidth: 300,
                                                    minHeight: 100,
                                                    layout: 'fit',
                                                    plain:true,
                                                    modal:true,
                                                    bodyStyle:'padding:5px;',
                                                    buttonAlign:'center',
                                                    items: form,
                                                    buttons:	[
                                                                    {
                                                                        id:'btnAceptar',
                                                                        text: '<?php echo $etj["lblFinalizar"] ?>',
                                                                        listeners:	{
                                                                                        click:function()
                                                                                            {
                                                                                                function funcAjax()
                                                                                                {
                                                                                                	var arrGroup=Ext.getCmp('chkGrupo');
                                                                                                    var rolesSel;
                                                                                                    if(arrGroup!=undefined)
	                                                                                                	rolesSel=arrGroup.getValues();
                                                                                                    else
                                                                                                    	rolesSel='';
                                                                                                    if(rolesSel=='')
                                                                                                    {
                                                                                                    	Ext.MessageBox.alert('<?php echo $etj["lblAplicacion"]?>','<?php echo $etj["msgDebeSelRolF"]?>');
                                                                                                        return;
                                                                                                    }
                                                                                                    var resp=peticion_http.responseText;
                                                                                                    arrResp=resp.split('|');
                                                                                                    if(arrResp[0]=='1')
                                                                                                    {
                                                                                                        var x;
                                                                                                        var token;
                                                                                                        var arrTokens='';
                                                                                                        for(x=0;x<arrTokensUsr.length;x++)
                                                                                                        {
                                                                                                            token='{"tokenUsuario":"'+cv(arrTokensUsr[x])+'","tokenMysql":"'+cv(arrTokensSql[x])+'"}';
                                                                                                            if(arrTokens=='')
                                                                                                                arrTokens=token;
                                                                                                            else
                                                                                                                arrTokens+=','+token;
                                                                                                       }
                                                                                                        arrTokens='{"arrTokens":['+arrTokens+']}';
                                                                                                            
                                                                                                        function funcAjax()
                                                                                                        {
                                                                                                            var resp=peticion_http.responseText;
                                                                                                            arrResp=resp.split('|');
                                                                                                            if(arrResp[0]=='1')
                                                                                                            {
                                                                                                                 var txtConsulta=Ext.getCmp('txtConsulta');
                                                                                                                 var  chkGrupo=Ext.getCmp('chkGrupo');
                                                                                                                 var etiquetas=chkGrupo.getLabels();
                                                                                                                 var x;
                                                                                                                 var cadEtiqueta='';
                                                                                                                 for(x=0;x<etiquetas.length;x++)
                                                                                                                 {
                                                                                                                 	cadEtiqueta+=etiquetas[x]+"<br>";
                                                                                                                 }
                                                                                                                 
                                                                                                                 if((idFiltro!='-1')&&(idFiltro!=-1))
                                                                                                                 {
                                                                                                                 	reemplazarEtiqueta('lblSentencia_'+idFiltro,txtConsulta.getValue());		
                                                                                                                    gE('lblRoles_'+idFiltro).innerHTML=cadEtiqueta;
                                                                                                                 }
                                                                                                                 else
                                                                                                                 {
                                                                                                                 	idFiltro=arrResp[1];
                                                                                                                 	var tblFiltro=gE('tblFiltros');
                                                                                                                    var fila=tblFiltro.insertRow(tblFiltro.rows.length);
                                                                                                                    var hrefM=document.createElement('a');
                                                                                                                    hrefM.href='javascript:mostrarVentanaCondicionF('+idFiltro+')';
                                                                                                                    var hrefE=document.createElement('a');
                                                                                                                    hrefE.href='javascript:eliminarFiltro('+idFiltro+')';
                                                                                                                    var modificar=document.createElement('img');
                                                                                                                    modificar.src='../images/update_nw.gif';
                                                                                                                    modificar.alt='<?php echo $etj["lblModFiltro"]?>';
                                                                                                                    modificar.title='<?php echo $etj["lblModFiltro"]?>';
                                                                                                                    hrefM.appendChild(modificar);
                                                                                                                    var eliminar=document.createElement('img');
                                                                                                                    eliminar.src='../images/cancel_round.png';
                                                                                                                    eliminar.alt='<?php echo $etj["lblEliminarF"]?>';
                                                                                                                    eliminar.title='<?php echo $etj["lblEliminarF"]?>';
                                                                                                                    hrefE.appendChild(eliminar);
                                                                                                                   	var espacio=document.createTextNode('  ');
                                                                                                                    var espacio2=document.createTextNode('  ');
                                                                                                                   	fila.id="fila_"+idFiltro;
                                                                                                                    var td1=document.createElement('td');
                                                                                                                    td1.id='celdaSentencia_'+idFiltro;
                                                                                                                    var td2=document.createElement('td');
                                                                                                                    td2.id="celdaRoles_"+idFiltro;
                                                                                                                    var td3=document.createElement('td');
                                                                                                                    var td4=document.createElement('td');
                                                                                                                    
                                                                                                                    td1.innerHTML=txtConsulta.getValue();
                                                                                                                    fila.appendChild(td1);
                                                                                                                    fila.appendChild(td4);
                                                                                                                    td2.innerHTML=cadEtiqueta;
                                                                                                                    fila.appendChild(td2);
                                                                                                                    fila.appendChild(td3);
                                                                                                                   	if(Ext.isIE)
                                                                                                                  	{
                                                                                                                    	fila.className=ultimaClaseFiltro;
                                                                                                                      	td1.className=ultimaClaseFiltro;
                                                                                                                      	td2.className=ultimaClaseFiltro;
                                                                                                                      	td3.className=ultimaClaseFiltro;
                                                                                                                    }
                                                                                                                  	else 
                                                                                                                  	{
                                                                                                                    	fila.setAttribute('class',ultimaClaseFiltro);
                                                                                                                      	td1.setAttribute('class',ultimaClaseFiltro);
                                                                                                                      	td2.setAttribute('class',ultimaClaseFiltro);
                                                                                                                      	td3.setAttribute('class',ultimaClaseFiltro);
                                                                                                                  	}
                                                                                                                    td3.appendChild(hrefM);
                                                                                                                    td3.appendChild(espacio);  
                                                                                                                    td3.appendChild(espacio2);  
                                                                                                                    td3.appendChild(hrefE);
                                                                                                                    td3.align='center';
                                                                                                                    if(ultimaClaseFiltro=='filaBlanca10')    
                                                                                                                    	ultimaClaseFiltro='filaRosa10';
                                                                                                                    else
                                                                                                                    	ultimaClaseFiltro='filaBlanca10';
                                                                                                                    

                                                                                                                 }
                                                                                                                 
                                                                                                                
                                                                                                                 ventanaOrigenDatosSel.close();
                                                                                                                 
                                                                                                            }
                                                                                                            else
                                                                                                            {
                                                                                                                msgBox('<?php echo $etj["errOperacion"]?>'+' <br />'+arrResp[0]);
                                                                                                            }
                                                                                                        }
                                                                                                        obtenerDatosWeb('../paginasFunciones/funcionesFormulario.php',funcAjax, 'POST','funcion=32&idConfiguracion='+idConfiguracion+'&objTokens='+arrTokens+'&idFiltro='+idFiltro+'&idRoles='+rolesSel,true);
                                                                                                    }
                                                                                                    else
                                                                                                    {
                                                                                                        Ext.MessageBox.alert('<?php echo $etj["lblAplicacion"]?>','<?php echo $etj["lblErrorSintaxis"]?>');
                                                                                                        return;
                                                                                                    }
                                                                                                }
                                                                                                obtenerDatosWeb('../paginasFunciones/funcionesFormulario.php',funcAjax, 'POST','funcion=27&tb='+nomTabla+'&qry='+sentenciaMysql,true);
                                                                                                
                                                                                            }
                                                                                    }
                                                                    },
                                                                    {
                                                                        text: '<?php echo $etj["lblBtnCancelar"]?>',
                                                                        handler:function()
                                                                                {
                                                                                    ventanaOrigenDatosSel.close();
                                                                                }
                                                                    }
                                                                ]
                                                }
                                            );
	cargarCamposTabla(ventanaOrigenDatosSel,nomTabla,idFiltro);
}

function generarGrupoCheck(nomTabla,idFiltro)
{
	var idConf=gE('idConfiguracion').value;
    var arrCheck;
	function funcAjax()
    {
        var resp=peticion_http.responseText;
        arrResp=resp.split('|');
        if(arrResp[0]=='1')
        {
        	arrCheck=eval(arrResp[1]);
            var numCol=3;
            if(arrCheck.length<3)
            	numCol=arrCheck.length;
            if(arrCheck.length>0)
            {
            	var checkGroup=new 	Ext.form.CheckboxGroup	(
                                                              {
                                                                      id:'chkGrupo',
                                                                      xtype:'checkboxgroup',
                                                                      hideLabel : true,
                                                                      width:500,
                                                                      columns: numCol,
                                                                      items: arrCheck
                                                              }
                                                          )
			}
            else
            {
            	var checkGroup=new Ext.form.Label	(
                										{
                                                        	html:'<?php echo $etj["lblSinRolesD"]?>'
                                                        }
                									)
            }
			mostrarVentanaCondFiltro(nomTabla,checkGroup,idFiltro);                                                               
        }
        else
        {
            msgBox('<?php echo $etj["errOperacion"]?>'+' <br />'+arrResp[0]);
        }
    }
    obtenerDatosWeb('../paginasFunciones/funcionesFormulario.php',funcAjax, 'POST','funcion=36&idConfiguracion='+idConf+'&idFiltro='+idFiltro,true);
	                          
}

function cargarCamposTabla(ventana,nombreTabla,idFiltro)
{
	var nTabla=nombreTabla;
    function funcAjax()
    {
        var resp=peticion_http.responseText;
        arrResp=resp.split('|');
        if(arrResp[0]=='1')
        {
        	 var arr=arrResp[2];
             var objArr=eval(arr);
             var cmbCampo=Ext.getCmp('cmbCampo');
             var dSet=cmbCampo.getStore();
             dSet.loadData(objArr);
             if(idFiltro!='-1')
               	cargarSentenciaFiltro(idFiltro,ventana);
             else
             	ventana.show();
             
        }
        else
        {
            msgBox('<?php echo $etj["errOperacion"]?>'+' <br />'+arrResp[0]);
            
        }
    }
    obtenerDatosWeb('../paginasFunciones/funcionesFormulario.php',funcAjax, 'POST','funcion=25&nomTabla='+nTabla+"&mCamposSistema=true",true);
	
}

var arrTokensUsr;
var arrTokensSql;

function cargarSentenciaFiltro(idFiltro,ventana)
{
    function funcAjax()
    {
        var resp=peticion_http.responseText;
        arrResp=resp.split('|');
        if(arrResp[0]=='1')
        {
        	var arrTokens=eval(arrResp[1]);
            var x;
            for(x=0;x<arrTokens.length;x++)
            {
            	arrTokensUsr[x]=arrTokens[x][0];
                arrTokensSql[x]=arrTokens[x][1];
            }
         	var sentencia=generarSentencia();
		    ventana.show();
        }
        else
        {
            msgBox('<?php echo $etj["errOperacion"]?>'+' <br />'+arrResp[0]);
        }
    }
    obtenerDatosWeb('../paginasFunciones/funcionesFormulario.php',funcAjax, 'POST','funcion=37&idFiltro='+idFiltro,true);
}

var arrVarchar=[['<>','<?php echo $etj["lblDistintoA"]?>'],['=','<?php echo $etj["lblIgualA"]?>']];
var arrInt=[['>','<?php echo $etj["lblMayor"]?>'],['>=','<?php echo $etj["lblMayorIgualQ"]?>'],['<','<?php echo $etj["lblMenorA"]?>'],['<=','<?php echo $etj["lblMenorIgualQ"]?>'],['<>','<?php echo $etj["lblDistintoA"]?>'],['=','<?php echo $etj["lblIgualA"]?>']];
var arrCombo=[['<>','<?php echo $etj["lblDistintoA"]?>'],['=','<?php echo $etj["lblIgualA"]?>']];
var arrUnidad=[['=','<?php echo $etj["lblIgualA"]?>'],['<>','<?php echo $etj["lblDistintoA"]?>'],['like','Igual a (incluyendo dependencias)']];

function mostrarCampoF(idCampo)
{
	Ext.getCmp('cmbValor').hide();
	Ext.getCmp('txtValor').hide();
    Ext.getCmp('dteValor').hide();
    Ext.getCmp('intValor').hide();
    Ext.getCmp('decValor').hide();
    Ext.getCmp(idCampo).show();
}

function llenarOpciones(campo,tabla)
{
	function funcAjax()
    {
        var resp=peticion_http.responseText;
        arrResp=resp.split('|');
        if(arrResp[0]=='1')
        {
        	var datos=eval(arrResp[1]);
     		Ext.getCmp('cmbValor').getStore().loadData(datos);		   	  
        }
        else
        {
            msgBox('<?php echo $etj["errOperacion"]?>'+' <br />'+arrResp[0]);
        }
    }
    obtenerDatosWeb('../paginasFunciones/funcionesFormulario.php',funcAjax, 'POST','funcion=26&tb='+tabla+'&campo='+campo,true);
}

var sentenciaMysql;

function generarSentencia()
{
	var x;
    var txtConsulta='';
    sentenciaMysql='';
    
	for(x=0;x<arrTokensUsr.length;x++)
    {
    	txtConsulta+=arrTokensUsr[x]+' ';
        sentenciaMysql+=arrTokensSql[x]+' ';
    }
    Ext.getCmp('txtConsulta').setValue(txtConsulta);
}
*/
function regresar()
{
	var idFormulario=gE('idFormulario').value;
    var idProceso=gE('idProceso').value;
    var arrParam=[['idFormulario',idFormulario],['idProceso',idProceso]];
	enviarFormularioDatos('../modeloPerfiles/formularios.php',arrParam);
}
/*
function eliminarFiltro(idFiltro)
{
	function resp(btn)
    {
    	if(btn=='yes')
        {
            function funcAjax()
            {
                var resp=peticion_http.responseText;
                arrResp=resp.split('|');
                if(arrResp[0]=='1')
                {
                    var fila=gE('fila_'+idFiltro);
                    fila.parentNode.removeChild(fila); 
                }
                else
                {
                    msgBox('<?php echo $etj["errOperacion"]?>'+' <br />'+arrResp[0]);
                }
            }
            obtenerDatosWeb('../paginasFunciones/funcionesFormulario.php',funcAjax, 'POST','funcion=38&idFiltro='+idFiltro,true);
		}
	}
    Ext.MessageBox.confirm('<?php echo $etj["lblAplicacion"]?>','<?php echo $etj["msgConfDelFiltro"]?>',resp);
}

function mostrarCheck(check)
{
	var chkAutores=gE('chkAutores');
    var chkPrograma=gE('chkPrograma');
    var chkDocumentos=gE('chkDocumentos');
    var chkAdemdum=gE('chkAdemdum');
    var conf='';
    if(chkAutores!=null)
        if(chkAutores.checked)
            conf+='A';
    if(chkPrograma!=null)
        if(chkPrograma.checked)
            conf+='P';
    if(chkDocumentos!=null)
        if(chkDocumentos.checked)
            conf+='D';
    if(chkAdemdum!=null)
        if(chkAdemdum.checked)
            conf+='M';
    
    var idConf=gE('idConfiguracion').value;
    function funcAjax()
    {
        var resp=peticion_http.responseText;
        arrResp=resp.split('|');
        if(arrResp[0]=='1')
        {
       		redibujarTblComplementario();
        }
        else
        {
            msgBox('<?php echo $etj["errOperacion"]?>'+' <br />'+arrResp[0]);
        }
    }
    obtenerDatosWeb('../paginasFunciones/funcionesProyectos.php',funcAjax, 'POST','funcion=107&idConf='+idConf+'&conf='+conf,true);

}

function redibujarTblComplementario()
{
	var tblInfoComplementario=gE('tblInfoComplementario');
    var tblCom='<table>';
    var chkAutores=gE('chkAutores');
    var chkPrograma=gE('chkPrograma');
    var chkDocumentos=gE('chkDocumentos');
    var chkAdemdum=gE('chkAdemdum');
    var fila='';
    if(chkAutores!=null)
        if(chkAutores.checked)
        {
        	var unidadParticipante=gE('unidadParticipante').value;
            fila='<tr><td class="etiquetaFicha" width="210" align="left" ><span class="corpo8_bold">'+unidadParticipante+' participantes:</span></td><td width="440" class="valorFicha" align="left"><span class="corpo8">['+unidadParticipante+':]</span></td></tr>';
            tblCom+=fila;
        }
    if(chkPrograma!=null)
        if(chkPrograma.checked)
        {
            fila='<tr><td class="etiquetaFicha" width="210" align="left"><span class="corpo8_bold">Programa de trabajo:</span></td><td width="440" class="valorFicha" align="left"><img src="../images/gantt.png" alt="Ver programa de trabajo" title="Ver programa de trabajo"></td></tr>';
            tblCom+=fila;
        }
    if(chkDocumentos!=null) 
        if(chkDocumentos.checked)
        {
            fila='<tr><td class="etiquetaFicha" width="210" align="left"><span class="corpo8_bold">Anexos:</span></td><td width="440" class="valorFicha" align="left"><span class="corpo8">[Anexos:]</span></td></tr>';
            tblCom+=fila;
        }
    if(chkAdemdum!=null)
        if(chkAdemdum.checked)
        {
            fila='<tr><td class="etiquetaFicha" width="210" align="left"><span class="corpo8_bold">Ademdum de:</span></td><td width="440" class="valorFicha" align="left"><span class="corpo8">[Ademdums]</span></td></tr>';
            tblCom+=fila;
        }
    tblCom+='</table>';
    tblInfoComplementario.innerHTML=tblCom;
}*/

function mostrarVentanaAdmonFiltros()
{
	var gridFiltrosGlobales=crearGridFiltrosGlobales();
	var form = new Ext.form.FormPanel(	
    
										{
											baseCls: 'x-plain',
											layout:'absolute',
											defaultType: 'label',
											items: 	[
														gridFiltrosGlobales

													]
										}
									);
	
	var ventanaAM = new Ext.Window(
									{
                                    	id:'vFiltro',
										title: 'Administraci&oacute;n de Filtros Globales',
										width: 700,
										height:400,
										layout: 'fit',
										plain:true,
										modal:true,
										bodyStyle:'padding:5px;',
										buttonAlign:'center',
										items: form,
										listeners : {
													show : {
																buffer : 10,
																fn : function() 
																{
																}
															}
												},
										buttons:	[
														{
															
															text: '<?php echo $etj["lblBtnAceptar"]?>',
                                                            
															handler: function()
																	{
																		ventanaAM.close();
																	}
														}
													]
									}
								);
	ventanaAM.show();	
}

function crearGridFiltrosGlobales()
{
	 var lector= new Ext.data.JsonReader({
                                            
                                            totalProperty:'numReg',
                                            fields: [
                                               			{name:'idFiltro'},
		                                                {name: 'etiqueta'},
		                                                {name:'campoAsociado'},
		                                                {name:'tamano'},
                                                        {name:'tipo'},
                                                        {name: 'funcionOrigenOpciones'},
                                                        {name: 'lblFuncionOrigen'},
                                                        {name: 'funcionValorDefault'},
                                                        {name: 'lblFuncionDefault'}
                                            		],
                                            root:'registros'
                                            
                                        }
                                      );
	 
                                                                                      
	var alDatos=new Ext.data.GroupingStore({
                                                reader: lector,
                                                proxy : new Ext.data.HttpProxy	(

                                                                                  {

                                                                                      url: '../paginasFunciones/funcionesFormulario.php'

                                                                                  }

                                                                              ),
                                                sortInfo: {field: 'idFiltro', direction: 'ASC'},
                                                groupField: 'etiqueta',
                                                remoteGroup:false,
                                                remoteSort: false,
                                                autoLoad:true
                                                
                                            }) 
	alDatos.on('beforeload',function(proxy)
    								{
                                    	proxy.baseParams.funcion='209';
                                        proxy.baseParams.iConf='<?php echo $idConfiguracion?>';
                                        
                                        
                                    }
                        )   
       
        var cModelo= new Ext.grid.ColumnModel   	(
                                                        [
                                                            {
                                                                header:'Etiqueta',
                                                                width:200,
                                                                sortable:true,
                                                                dataIndex:'etiqueta'
                                                                
                                                            },
                                                            {
                                                                header:'Campo asociado',
                                                                width:150,
                                                                sortable:true,
                                                                css:'text-align:right;',
                                                                dataIndex:'campoAsociado',
                                                                renderer:function(val)
                                                                		{
                                                                        	return mostrarValorDescripcion(formatearValorRenderer(arrControles,val));
                                                                        }
                                                            },
                                                            {
                                                                header:'Tama&ntilde;o',
                                                                width:100,
                                                                sortable:true,
                                                                dataIndex:'tamano'
                                                            },
                                                            {
                                                                header:'Tipo campo',
                                                                width:130,
                                                                 css:'text-align:right;',
                                                                sortable:true,
                                                                dataIndex:'tipo',
                                                                renderer:function(val)
                                                                		{
                                                                        	return mostrarValorDescripcion(formatearValorRenderer(arrTiposElementos,val));
                                                                        }
                                                            }
                                                        ]
                                                    );
                                                    
        var tblGrid=	new Ext.grid.GridPanel	(
                                                            {
                                                                id:'gFiltros',
                                                                store:alDatos,
                                                                region:'center',
                                                                frame:false,
                                                                border:true,
                                                                cm: cModelo,
                                                                stripeRows :true,
                                                                loadMask:true,
                                                                columnLines : true,
                                                                width:650,
                                                                x:10,
                                                                y:20,
                                                                height:280,
                                                                tbar:	[
                                                                			{
                                                                                icon:'../images/add.png',
                                                                                cls:'x-btn-text-icon',
                                                                                text:'Agregar filtro',
                                                                                handler:function()
                                                                                        {
                                                                                            mostrarVentanaConfiguracionFiltro();
                                                                                        }
                                                                                
                                                                            },'-',
                                                                            {
                                                                                icon:'../images/pencil.png',
                                                                                cls:'x-btn-text-icon',
                                                                                text:'Modificar filtro',
                                                                                handler:function()
                                                                                        {
                                                                                            var fila=tblGrid.getSelectionModel().getSelected();
                                                                                            if(!fila)
                                                                                            {
                                                                                            	msgBox('Debe seleccionar el filtro que desea modificar');
                                                                                            	return;
                                                                                            }
                                                                                            
                                                                                             mostrarVentanaConfiguracionFiltro(fila);
                                                                                        }
                                                                                
                                                                            },
                                                                            
                                                                            '-',
                                                                            {
                                                                                icon:'../images/delete.png',
                                                                                cls:'x-btn-text-icon',
                                                                                text:'Remover filtro',
                                                                                handler:function()
                                                                                        {
                                                                                            var fila=tblGrid.getSelectionModel().getSelected();
                                                                                            if(!fila)
                                                                                            {
                                                                                            	msgBox('Debe seleccionar el filtro que desea remover');
                                                                                            	return;
                                                                                            }
                                                                                            
                                                                                            
                                                                                            function resp(btn)
                                                                                            {
                                                                                            	if(btn=='yes')
                                                                                                {
                                                                                                	
                                                                                                    function funcAjax()
                                                                                                    {
                                                                                                        var resp=peticion_http.responseText;
                                                                                                        arrResp=resp.split('|');
                                                                                                        if(arrResp[0]=='1')
                                                                                                        {
                                                                                                        	gEx('vFiltro').close();
                                                                                                            recargarPagina();
                                                                                                        }
                                                                                                        else
                                                                                                        {
                                                                                                            msgBox('<?php echo $etj["errOperacion"]?>'+' <br />'+arrResp[0]);
                                                                                                        }
                                                                                                    }
                                                                                                    obtenerDatosWeb('../paginasFunciones/funcionesFormulario.php',funcAjax, 'POST','funcion=210&idFiltro='+fila.data.idFiltro,true);
                                                                                                    
                                                                                                    
                                                                                                }
                                                                                            }
                                                                                            msgConfirm('Est&aacute; seguro de querer remover el filtro seleccionado?',resp);
                                                                                            
                                                                                        }
                                                                                
                                                                            }
                                                                		],
                                                                view:new Ext.grid.GroupingView({
                                                                                                    forceFit:false,
                                                                                                    showGroupName: false,
                                                                                                    enableGrouping :false,
                                                                                                    enableNoGroups:false,
                                                                                                    enableGroupingMenu:false,
                                                                                                    hideGroupedColumn: false,
                                                                                                    startCollapsed:false
                                                                                                })
                                                            }
                                                        );
        return 	tblGrid;	
}

function mostrarVentanaConfiguracionFiltro(fila)
{
	var cmbTipoFiltro=crearComboExt('cmbTipoFiltro',[],150,65,200);
    cmbTipoFiltro.on('select',function(cmb,registro)
    							{
                                	if((registro.data.id=='1')||(registro.data.id=='6'))
                                    {
                                    	gEx('lblTamano').hide();
                                        gEx('txtTamano').hide();
                                    }
                                    else
                                    {
                                    	gEx('lblTamano').show();
                                        gEx('txtTamano').show();
                                    }
                                }
    				)
    
    
	var cmbCampoAsocido=crearComboExt('cmbCampoAsocido',arrControles,150,35,400);
    
    cmbCampoAsocido.on('select',function(cmb,registro)
    							{
                                	gEx('lblTamano').hide();
                                    gEx('txtTamano').hide();
                                	var arrValores=[];
                                    
                                	var pos=existeValorMatriz(arrControles,registro.data.id);
                                    var f=arrControles[pos];
                                    
                                    var aTipo=obtenerValoresTipoFiltro(f[3]);
                                    cmbTipoFiltro.setValue('');
                                    cmbTipoFiltro.getStore().loadData(aTipo);
                                    if(aTipo.length=='1')
                                    {
                                    	cmbTipoFiltro.setValue(aTipo[0][0]);
                                    }
                                }
    					)
    
	var form = new Ext.form.FormPanel(	
										{
											baseCls: 'x-plain',
											layout:'absolute',
											defaultType: 'label',
											items: 	[
														{
                                                        	x:10,
                                                            y:10,
                                                            html:'Etiqueta del filtro:'
                                                        },
                                                        {
                                                        	x:150,
                                                            y:5,
                                                            xtype:'textfield',
                                                            id:'txtEtiqueta',
                                                            width:300
                                                        },
                                                        {
                                                        	x:10,
                                                            y:40,
                                                            html:'Campo asociado:'
                                                        },
                                                        cmbCampoAsocido,
                                                        {
                                                        	x:10,
                                                            y:70,
                                                            html:'Tipo de filtro:'
                                                        },
                                                        cmbTipoFiltro,
                                                        {
                                                        	x:370,
                                                            y:70,
                                                            id:'lblTamano',
                                                            hidden:true,
                                                            html:'Tama&ntilde;o del control:'
                                                        },
                                                        {
                                                        	x:490,
                                                            y:65,
                                                            xtype:'numberfield',
                                                            id:'txtTamano',
                                                            hidden:true,
                                                            allowDecimals:false,
                                                            allowNegative:false,
                                                            width:60,
                                                            value:200
                                                        },
                                                        {
                                                        	x:10,
                                                            y:100,
                                                            html:'Funci&oacute;n origen opciones:'
                                                        },
                                                        {
                                                        	x:150,
                                                            y:95,
                                                            width:320,
                                                             xtype:'textfield',
                                                            id:'txtOrigenOpciones',
                                                            readOnly:true
                                                        },
                                                        {
                                                        	x:480,
                                                            y:100,
                                                            html:'<a href="javascript:definirFuncionOrigenValores()"><img src="../images/pencil.png" title="Agregar funci&oacute;n" alt="Agregar funci&oacute;n"></a>&nbsp;&nbsp;<a href="javascript:removerFuncion(1)"><img src="../images/delete.png" title="Remover funci&oacute;n" alt="Remover funci&oacute;n"></a>'
                                                        },
                                                        
                                                        {
                                                        	x:10,
                                                            y:130,
                                                            html:'Funci&oacute;n valor default:'
                                                        },
                                                        {
                                                        	x:150,
                                                            y:125,
                                                            width:320,
                                                             xtype:'textfield',
                                                            id:'txtValorDefault',
                                                            readOnly:true
                                                        },
                                                        {
                                                        	x:480,
                                                            y:130,
                                                            html:'<a href="javascript:definirValorDefault()"><img src="../images/pencil.png" title="Agregar funci&oacute;n" alt="Agregar funci&oacute;n"></a>&nbsp;&nbsp;<a href="javascript:removerFuncion(2)"><img src="../images/delete.png" title="Remover funci&oacute;n" alt="Remover funci&oacute;n"></a>'
                                                        },

													]
										}
									);
	
	var ventanaAM = new Ext.Window(
									{
										title: fila?'Modificar filtro':'Agregar filtro',
										width: 600,
										height:250,
										layout: 'fit',
										plain:true,
										modal:true,
										bodyStyle:'padding:5px;',
										buttonAlign:'center',
										items: form,
										listeners : {
													show : {
																buffer : 10,
																fn : function() 
																{
                                                                	gEx('txtEtiqueta').focus(false,500);
																}
															}
												},
										buttons:	[
														{
															
															text: '<?php echo $etj["lblBtnAceptar"]?>',
                                                            
															handler: function()
																	{
                                                                    	var txtEtiqueta=gEx('txtEtiqueta');
                                                                        var txtTamano=gEx('txtTamano');
                                                                        var txtOrigenOpciones=gEx('txtOrigenOpciones');
                                                                        var txtValorDefault=gEx('txtValorDefault');
                                                                        if(txtEtiqueta.getValue()=='')
                                                                        {
                                                                        	
                                                                            function resp()
                                                                            {
                                                                            	txtEtiqueta.focus();
                                                                            }
                                                                            msgBox('Debe especificar la etiqueta del filtro',resp);
                                                                            return;
                                                                        }
                                                                        
                                                                        if(cmbCampoAsocido.getValue()=='')
                                                                        {
                                                                        	function resp3()
                                                                            {
                                                                            	cmbCampoAsocido.focus();
                                                                            }
                                                                            msgBox('Debe especificar el campo con el cual ser&aacute; asociado el filtro',resp3);
                                                                            return;
                                                                        }
                                                                        
                                                                        if(cmbTipoFiltro.getValue()=='')
                                                                        {
                                                                        	function resp2()
                                                                            {
                                                                            	cmbTipoFiltro.focus();
                                                                            }
                                                                            msgBox('Debe especificar el tipo de filtro a aplicar',resp2);
                                                                            return;
                                                                        }
                                                                        
                                                                        if(cmbTipoFiltro.getValue()!='1')
                                                                        {
                                                                        	 if(txtTamano.getValue()=='')
                                                                            {
                                                                                function resp4()
                                                                                {
                                                                                    txtTamano.focus();
                                                                                }
                                                                                msgBox('Debe especificar el tama&ntilde;o del control de filtro',resp4);
                                                                                return;
                                                                            }
                                                                        
                                                                        }
                                                                        
                                                                        var idFuncionOrigenOpciones=-1;
                                                                        if(txtOrigenOpciones.idConsulta)
                                                                        	idFuncionOrigenOpciones=txtOrigenOpciones.idConsulta;
                                                                        
                                                                        var idFuncionOrigenDefault=-1;
                                                                        if(txtValorDefault.idConsulta)
                                                                        	idFuncionOrigenDefault=txtValorDefault.idConsulta;
                                                                        var idFiltro=-1;
                                                                        if(fila)
                                                                        	idFiltro=fila.data.idFiltro;
                                                                            
																		var cadObj='{"idConfiguracionGrid":"<?php echo $idConfiguracion?>","idFiltro":"'+idFiltro+'","etiqueta":"'+cv(gEx('txtEtiqueta').getValue())+'","campo":"'+cmbCampoAsocido.getValue()+'","tipoFiltro":"'+cmbTipoFiltro.getValue()+
                                                                        			'","tamano":"'+txtTamano.getValue()+'","idFuncionOrigenOpciones":"'+idFuncionOrigenOpciones+'","idFuncionOrigenDefault":"'+idFuncionOrigenDefault+'"}';
                                                                        
                                                                        
                                                                        
                                                                        function funcAjax()
                                                                        {
                                                                            var resp=peticion_http.responseText;
                                                                            arrResp=resp.split('|');
                                                                            if(arrResp[0]=='1')
                                                                            {
                                                                                ventanaAM.close();
                                                                                recargarPagina();
                                                                            }
                                                                            else
                                                                            {
                                                                                msgBox('<?php echo $etj["errOperacion"]?>'+' <br />'+arrResp[0]);
                                                                            }
                                                                        }
                                                                        obtenerDatosWeb('../paginasFunciones/funcionesFormulario.php',funcAjax, 'POST','funcion=208&cadObj='+cadObj,true);
                                                                        
                                                                        
                                                                        
                                                                        
                                                                        
																	}
														},
														{
															text: '<?php echo $etj["lblBtnCancelar"]?>',
															handler:function()
																	{
																		ventanaAM.close();
																	}
														}
													]
									}
								);
	ventanaAM.show();
    
    if(fila)
    {
    	var txtEtiqueta=gEx('txtEtiqueta');
        txtEtiqueta.setValue(fila.data.etiqueta);
        var txtTamano=gEx('txtTamano');
        txtTamano.setValue(fila.data.tamano);
        var txtOrigenOpciones=gEx('txtOrigenOpciones');
        txtOrigenOpciones.setValue(fila.data.lblFuncionOrigen);
        txtOrigenOpciones.idConsulta=fila.data.funcionOrigenOpciones;
        
        var txtValorDefault=gEx('txtValorDefault');
        txtValorDefault.setValue(fila.data.lblFuncionDefault);
        txtValorDefault.idConsulta=fila.data.funcionValorDefault;
        
        cmbCampoAsocido.setValue(fila.data.campoAsociado);
        dispararEventoSelectCombo('cmbCampoAsocido');
        
        
        cmbTipoFiltro.setValue(fila.data.tipo);
    	dispararEventoSelectCombo('cmbTipoFiltro');
    }
    	
}

function definirFuncionOrigenValores()
{
	asignarFuncionNuevoConceptoInyeccion=function(idConsulta,nombre)
                                            {
                                            	gEx('txtOrigenOpciones').setValue(nombre);
                                                gEx('txtOrigenOpciones').idConsulta=idConsulta;
                                               
                                                 gEx('vAgregarExp').close();
                                                 
                                                 var idAux=gEx('cmbTipoFiltro').getValue();
        
                                                 
                                                 dispararEventoSelectCombo('cmbCampoAsocido');
                                                 var pos=obtenerPosFila(gEx('cmbTipoFiltro').getStore(),'id',idAux);
                                                 if(pos!=-1)
	                                                 gEx('cmbTipoFiltro').setValue(idAux);
                                                
                                            }
	mostrarVentanaExpresion(function(fila,ventana)
    						{
                            	gEx('txtOrigenOpciones').setValue(fila.data.nombreConsulta);
                                gEx('txtOrigenOpciones').idConsulta=fila.data.idConsulta;
                            	ventana.close();
                                var idAux=gEx('cmbTipoFiltro').getValue();
        
                                                 
                               dispararEventoSelectCombo('cmbCampoAsocido');
                               var pos=obtenerPosFila(gEx('cmbTipoFiltro').getStore(),'id',idAux);
                               if(pos!=-1)
                                   gEx('cmbTipoFiltro').setValue(idAux);
                                

                            }
    						,
    						true);
}

function definirValorDefault()
{
	asignarFuncionNuevoConceptoInyeccion=function(idConsulta,nombre)
                                            {
                                            	gEx('txtValorDefault').setValue(nombre);
                                                gEx('txtValorDefault').idConsulta=idConsulta;
                                               
                                                gEx('vAgregarExp').close();
                                                
                                            }
	mostrarVentanaExpresion(function(fila,ventana)
    						{
                            	gEx('txtValorDefault').setValue(fila.data.nombreConsulta);
                                gEx('txtValorDefault').idConsulta=fila.data.idConsulta;
                            	ventana.close();

                            }
    						,
    						true);
}

function removerFuncion(t)
{
	if(t=='1')
    {
    	gEx('txtOrigenOpciones').setValue('');
       	gEx('txtOrigenOpciones').idConsulta=-1;
        var idAux=gEx('cmbTipoFiltro').getValue();
        dispararEventoSelectCombo('cmbCampoAsocido');
        gEx('cmbTipoFiltro').setValue(idAux);
    }
    else
    {
    	gEx('txtValorDefault').setValue('');
        gEx('txtValorDefault').idConsulta=-1;
    }
}

function obtenerValoresTipoFiltro(tValor)
{
	var arrTipos=[];
    
    if((!gEx('txtOrigenOpciones').idConsulta)||(gEx('txtOrigenOpciones').idConsulta=='-1'))
    {
        switch(tValor)//1 numerico,2 fecha,3 texto, 4 lista  
        {
            case '1':
            	arrTipos.push(['1','Rango de valores']);
            break;
            case '2':
                arrTipos.push(['6','Rango de valores']);
                
            break;
            case '3':
                arrTipos.push(['5','Escritura de valor']);  
            break;
            case '4':
                arrTipos.push(['5','Escritura de valor']);  
                arrTipos.push(['3','Lista de valores selecci\xF3n \xFAnica']);  
                arrTipos.push(['4','Lista de valores selecci\xF3n m\xFAltiple']);  
            break;
        }
  	}
    else
    {
    	 arrTipos.push(['3','Lista de valores selecci\xF3n \xFAnica']);  
         arrTipos.push(['4','Lista de valores selecci\xF3n m\xFAltiple']);  
    }      
    return arrTipos;
}